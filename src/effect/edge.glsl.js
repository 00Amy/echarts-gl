module.exports = "@export ecgl.edge\n\n\nuniform sampler2D texture;\n\nuniform sampler2D normalTexture;\nuniform sampler2D depthTexture;\n\nuniform vec2 textureSize;\n\nuniform vec4 edgeColor: [0,0,0,0.6];\n\nvarying vec2 v_Texcoord;\n\nvec3 packColor(vec2 coord) {\n    return vec3(\n        texture2D(normalTexture, coord).rg,\n        log(texture2D(depthTexture, coord).a)\n    );\n}\n\nvoid main() {\n    float dx = 0.5 / textureSize.x;\n    float dy = 0.5 / textureSize.y;\n\n    vec2 coord;\n    vec2 cc = v_Texcoord;\n        vec3 topLeft = packColor(cc+vec2(-dx, -dy));\n        vec3 top = packColor(cc+vec2(0.0, -dy));\n        vec3 topRight = packColor(cc+vec2(dx, -dy));\n        vec3 left = packColor(cc+vec2(-dx, 0.0));\n        vec3 center = packColor(cc);\n        vec3 right = packColor(cc+vec2(dx, 0.0));\n        vec3 bottomLeft = packColor(cc+vec2(-dx, dy));\n        vec3 bottom = packColor(cc+vec2(0.0, dy));\n        vec3 bottomRight = packColor(cc+vec2(dx, dy));\n\n    vec3 h = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;\n    vec3 v = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;\n\n    float edge = sqrt(dot(h, h) + dot(v, v));\n\n    edge = smoothstep(0.0, 0.01, edge);\n\n    gl_FragColor = mix(texture2D(texture, v_Texcoord), vec4(edgeColor.rgb, 1.0), edgeColor.a * edge);\n}\n@end";
