!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("echarts")):"function"==typeof define&&define.amd?define(["echarts"],r):"object"==typeof exports?exports["echarts-gl"]=r(require("echarts")):t["echarts-gl"]=r(t.echarts)}(this,function(t){return function(t){function r(n){if(e[n])return e[n].exports;var i=e[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}var e={};return r.m=t,r.c=e,r.p="",r(0)}([function(t,r,e){e(56),e(48),e(49),e(37),e(47),e(42)},function(t,r,e){!function(t){"use strict";var e={};e.exports=r,function(t){if(!r)var r=1e-6;if(!e)var e="undefined"!=typeof Float32Array?Float32Array:Array;if(!n)var n=Math.random;var i={};i.setMatrixArrayType=function(t){e=t},"undefined"!=typeof t&&(t.glMatrix=i);var a=Math.PI/180;i.toRadian=function(t){return t*a};var o={};o.create=function(){var t=new e(2);return t[0]=0,t[1]=0,t},o.clone=function(t){var r=new e(2);return r[0]=t[0],r[1]=t[1],r},o.fromValues=function(t,r){var n=new e(2);return n[0]=t,n[1]=r,n},o.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t},o.set=function(t,r,e){return t[0]=r,t[1]=e,t},o.add=function(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t},o.subtract=function(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t},o.sub=o.subtract,o.multiply=function(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t},o.mul=o.multiply,o.divide=function(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t},o.div=o.divide,o.min=function(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t},o.max=function(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t},o.scale=function(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t},o.scaleAndAdd=function(t,r,e,n){return t[0]=r[0]+e[0]*n,t[1]=r[1]+e[1]*n,t},o.distance=function(t,r){var e=r[0]-t[0],n=r[1]-t[1];return Math.sqrt(e*e+n*n)},o.dist=o.distance,o.squaredDistance=function(t,r){var e=r[0]-t[0],n=r[1]-t[1];return e*e+n*n},o.sqrDist=o.squaredDistance,o.length=function(t){var r=t[0],e=t[1];return Math.sqrt(r*r+e*e)},o.len=o.length,o.squaredLength=function(t){var r=t[0],e=t[1];return r*r+e*e},o.sqrLen=o.squaredLength,o.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t},o.inverse=function(t,r){return t[0]=1/r[0],t[1]=1/r[1],t},o.normalize=function(t,r){var e=r[0],n=r[1],i=e*e+n*n;return i>0&&(i=1/Math.sqrt(i),t[0]=r[0]*i,t[1]=r[1]*i),t},o.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]},o.cross=function(t,r,e){var n=r[0]*e[1]-r[1]*e[0];return t[0]=t[1]=0,t[2]=n,t},o.lerp=function(t,r,e,n){var i=r[0],a=r[1];return t[0]=i+n*(e[0]-i),t[1]=a+n*(e[1]-a),t},o.random=function(t,r){r=r||1;var e=2*n()*Math.PI;return t[0]=Math.cos(e)*r,t[1]=Math.sin(e)*r,t},o.transformMat2=function(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[2]*i,t[1]=e[1]*n+e[3]*i,t},o.transformMat2d=function(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[2]*i+e[4],t[1]=e[1]*n+e[3]*i+e[5],t},o.transformMat3=function(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[3]*i+e[6],t[1]=e[1]*n+e[4]*i+e[7],t},o.transformMat4=function(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[4]*i+e[12],t[1]=e[1]*n+e[5]*i+e[13],t},o.forEach=function(){var t=o.create();return function(r,e,n,i,a,o){var s,u;for(e||(e=2),n||(n=0),u=i?Math.min(i*e+n,r.length):r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],a(t,t,o),r[s]=t[0],r[s+1]=t[1];return r}}(),o.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},"undefined"!=typeof t&&(t.vec2=o);var s={};s.create=function(){var t=new e(3);return t[0]=0,t[1]=0,t[2]=0,t},s.clone=function(t){var r=new e(3);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r},s.fromValues=function(t,r,n){var i=new e(3);return i[0]=t,i[1]=r,i[2]=n,i},s.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},s.set=function(t,r,e,n){return t[0]=r,t[1]=e,t[2]=n,t},s.add=function(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t},s.subtract=function(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t},s.sub=s.subtract,s.multiply=function(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t[2]=r[2]*e[2],t},s.mul=s.multiply,s.divide=function(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t[2]=r[2]/e[2],t},s.div=s.divide,s.min=function(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t[2]=Math.min(r[2],e[2]),t},s.max=function(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t[2]=Math.max(r[2],e[2]),t},s.scale=function(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t},s.scaleAndAdd=function(t,r,e,n){return t[0]=r[0]+e[0]*n,t[1]=r[1]+e[1]*n,t[2]=r[2]+e[2]*n,t},s.distance=function(t,r){var e=r[0]-t[0],n=r[1]-t[1],i=r[2]-t[2];return Math.sqrt(e*e+n*n+i*i)},s.dist=s.distance,s.squaredDistance=function(t,r){var e=r[0]-t[0],n=r[1]-t[1],i=r[2]-t[2];return e*e+n*n+i*i},s.sqrDist=s.squaredDistance,s.length=function(t){var r=t[0],e=t[1],n=t[2];return Math.sqrt(r*r+e*e+n*n)},s.len=s.length,s.squaredLength=function(t){var r=t[0],e=t[1],n=t[2];return r*r+e*e+n*n},s.sqrLen=s.squaredLength,s.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t},s.inverse=function(t,r){return t[0]=1/r[0],t[1]=1/r[1],t[2]=1/r[2],t},s.normalize=function(t,r){var e=r[0],n=r[1],i=r[2],a=e*e+n*n+i*i;return a>0&&(a=1/Math.sqrt(a),t[0]=r[0]*a,t[1]=r[1]*a,t[2]=r[2]*a),t},s.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]},s.cross=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[0],s=e[1],u=e[2];return t[0]=i*u-a*s,t[1]=a*o-n*u,t[2]=n*s-i*o,t},s.lerp=function(t,r,e,n){var i=r[0],a=r[1],o=r[2];return t[0]=i+n*(e[0]-i),t[1]=a+n*(e[1]-a),t[2]=o+n*(e[2]-o),t},s.random=function(t,r){r=r||1;var e=2*n()*Math.PI,i=2*n()-1,a=Math.sqrt(1-i*i)*r;return t[0]=Math.cos(e)*a,t[1]=Math.sin(e)*a,t[2]=i*r,t},s.transformMat4=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[3]*n+e[7]*i+e[11]*a+e[15];return o=o||1,t[0]=(e[0]*n+e[4]*i+e[8]*a+e[12])/o,t[1]=(e[1]*n+e[5]*i+e[9]*a+e[13])/o,t[2]=(e[2]*n+e[6]*i+e[10]*a+e[14])/o,t},s.transformMat3=function(t,r,e){var n=r[0],i=r[1],a=r[2];return t[0]=n*e[0]+i*e[3]+a*e[6],t[1]=n*e[1]+i*e[4]+a*e[7],t[2]=n*e[2]+i*e[5]+a*e[8],t},s.transformQuat=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[0],s=e[1],u=e[2],c=e[3],h=c*n+s*a-u*i,f=c*i+u*n-o*a,l=c*a+o*i-s*n,_=-o*n-s*i-u*a;return t[0]=h*c+_*-o+f*-u-l*-s,t[1]=f*c+_*-s+l*-o-h*-u,t[2]=l*c+_*-u+h*-s-f*-o,t},s.rotateX=function(t,r,e,n){var i=[],a=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t},s.rotateY=function(t,r,e,n){var i=[],a=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t},s.rotateZ=function(t,r,e,n){var i=[],a=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t},s.forEach=function(){var t=s.create();return function(r,e,n,i,a,o){var s,u;for(e||(e=3),n||(n=0),u=i?Math.min(i*e+n,r.length):r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2];return r}}(),s.angle=function(t,r){var e=s.fromValues(t[0],t[1],t[2]),n=s.fromValues(r[0],r[1],r[2]);s.normalize(e,e),s.normalize(n,n);var i=s.dot(e,n);return i>1?0:Math.acos(i)},s.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},"undefined"!=typeof t&&(t.vec3=s);var u={};u.create=function(){var t=new e(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},u.clone=function(t){var r=new e(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},u.fromValues=function(t,r,n,i){var a=new e(4);return a[0]=t,a[1]=r,a[2]=n,a[3]=i,a},u.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},u.set=function(t,r,e,n,i){return t[0]=r,t[1]=e,t[2]=n,t[3]=i,t},u.add=function(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t[3]=r[3]+e[3],t},u.subtract=function(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t[3]=r[3]-e[3],t},u.sub=u.subtract,u.multiply=function(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t[2]=r[2]*e[2],t[3]=r[3]*e[3],t},u.mul=u.multiply,u.divide=function(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t[2]=r[2]/e[2],t[3]=r[3]/e[3],t},u.div=u.divide,u.min=function(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t[2]=Math.min(r[2],e[2]),t[3]=Math.min(r[3],e[3]),t},u.max=function(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t[2]=Math.max(r[2],e[2]),t[3]=Math.max(r[3],e[3]),t},u.scale=function(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t},u.scaleAndAdd=function(t,r,e,n){return t[0]=r[0]+e[0]*n,t[1]=r[1]+e[1]*n,t[2]=r[2]+e[2]*n,t[3]=r[3]+e[3]*n,t},u.distance=function(t,r){var e=r[0]-t[0],n=r[1]-t[1],i=r[2]-t[2],a=r[3]-t[3];return Math.sqrt(e*e+n*n+i*i+a*a)},u.dist=u.distance,u.squaredDistance=function(t,r){var e=r[0]-t[0],n=r[1]-t[1],i=r[2]-t[2],a=r[3]-t[3];return e*e+n*n+i*i+a*a},u.sqrDist=u.squaredDistance,u.length=function(t){var r=t[0],e=t[1],n=t[2],i=t[3];return Math.sqrt(r*r+e*e+n*n+i*i)},u.len=u.length,u.squaredLength=function(t){var r=t[0],e=t[1],n=t[2],i=t[3];return r*r+e*e+n*n+i*i},u.sqrLen=u.squaredLength,u.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=-r[3],t},u.inverse=function(t,r){return t[0]=1/r[0],t[1]=1/r[1],t[2]=1/r[2],t[3]=1/r[3],t},u.normalize=function(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=e*e+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=r[0]*o,t[1]=r[1]*o,t[2]=r[2]*o,t[3]=r[3]*o),t},u.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]},u.lerp=function(t,r,e,n){var i=r[0],a=r[1],o=r[2],s=r[3];return t[0]=i+n*(e[0]-i),t[1]=a+n*(e[1]-a),t[2]=o+n*(e[2]-o),t[3]=s+n*(e[3]-s),t},u.random=function(t,r){return r=r||1,t[0]=n(),t[1]=n(),t[2]=n(),t[3]=n(),u.normalize(t,t),u.scale(t,t,r),t},u.transformMat4=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3];return t[0]=e[0]*n+e[4]*i+e[8]*a+e[12]*o,t[1]=e[1]*n+e[5]*i+e[9]*a+e[13]*o,t[2]=e[2]*n+e[6]*i+e[10]*a+e[14]*o,t[3]=e[3]*n+e[7]*i+e[11]*a+e[15]*o,t},u.transformQuat=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[0],s=e[1],u=e[2],c=e[3],h=c*n+s*a-u*i,f=c*i+u*n-o*a,l=c*a+o*i-s*n,_=-o*n-s*i-u*a;return t[0]=h*c+_*-o+f*-u-l*-s,t[1]=f*c+_*-s+l*-o-h*-u,t[2]=l*c+_*-u+h*-s-f*-o,t},u.forEach=function(){var t=u.create();return function(r,e,n,i,a,o){var s,u;for(e||(e=4),n||(n=0),u=i?Math.min(i*e+n,r.length):r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],t[3]=r[s+3],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2],r[s+3]=t[3];return r}}(),u.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.vec4=u);var c={};c.create=function(){var t=new e(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},c.clone=function(t){var r=new e(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},c.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},c.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},c.transpose=function(t,r){if(t===r){var e=r[1];t[1]=r[2],t[2]=e}else t[0]=r[0],t[1]=r[2],t[2]=r[1],t[3]=r[3];return t},c.invert=function(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=e*a-i*n;return o?(o=1/o,t[0]=a*o,t[1]=-n*o,t[2]=-i*o,t[3]=e*o,t):null},c.adjoint=function(t,r){var e=r[0];return t[0]=r[3],t[1]=-r[1],t[2]=-r[2],t[3]=e,t},c.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},c.multiply=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=e[0],u=e[1],c=e[2],h=e[3];return t[0]=n*s+a*u,t[1]=i*s+o*u,t[2]=n*c+a*h,t[3]=i*c+o*h,t},c.mul=c.multiply,c.rotate=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=Math.sin(e),u=Math.cos(e);return t[0]=n*u+a*s,t[1]=i*u+o*s,t[2]=n*-s+a*u,t[3]=i*-s+o*u,t},c.scale=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=e[0],u=e[1];return t[0]=n*s,t[1]=i*s,t[2]=a*u,t[3]=o*u,t},c.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},c.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},c.LDU=function(t,r,e,n){return t[2]=n[2]/n[0],e[0]=n[0],e[1]=n[1],e[3]=n[3]-t[2]*e[1],[t,r,e]},"undefined"!=typeof t&&(t.mat2=c);var h={};h.create=function(){var t=new e(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},h.clone=function(t){var r=new e(6);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r},h.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t},h.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},h.invert=function(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=e*a-n*i;return u?(u=1/u,t[0]=a*u,t[1]=-n*u,t[2]=-i*u,t[3]=e*u,t[4]=(i*s-a*o)*u,t[5]=(n*o-e*s)*u,t):null},h.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},h.multiply=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],c=e[0],h=e[1],f=e[2],l=e[3],_=e[4],d=e[5];return t[0]=n*c+a*h,t[1]=i*c+o*h,t[2]=n*f+a*l,t[3]=i*f+o*l,t[4]=n*_+a*d+s,t[5]=i*_+o*d+u,t},h.mul=h.multiply,h.rotate=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],c=Math.sin(e),h=Math.cos(e);return t[0]=n*h+a*c,t[1]=i*h+o*c,t[2]=n*-c+a*h,t[3]=i*-c+o*h,t[4]=s,t[5]=u,t},h.scale=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],c=e[0],h=e[1];return t[0]=n*c,t[1]=i*c,t[2]=a*h,t[3]=o*h,t[4]=s,t[5]=u,t},h.translate=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],c=e[0],h=e[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=n*c+a*h+s,t[5]=i*c+o*h+u,t},h.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},h.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},"undefined"!=typeof t&&(t.mat2d=h);var f={};f.create=function(){var t=new e(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},f.fromMat4=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[4],t[4]=r[5],t[5]=r[6],t[6]=r[8],t[7]=r[9],t[8]=r[10],t},f.clone=function(t){var r=new e(9);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r},f.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t},f.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},f.transpose=function(t,r){if(t===r){var e=r[1],n=r[2],i=r[5];t[1]=r[3],t[2]=r[6],t[3]=e,t[5]=r[7],t[6]=n,t[7]=i}else t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8];return t},f.invert=function(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],c=r[7],h=r[8],f=h*o-s*c,l=-h*a+s*u,_=c*a-o*u,d=e*f+n*l+i*_;return d?(d=1/d,t[0]=f*d,t[1]=(-h*n+i*c)*d,t[2]=(s*n-i*o)*d,t[3]=l*d,t[4]=(h*e-i*u)*d,t[5]=(-s*e+i*a)*d,t[6]=_*d,t[7]=(-c*e+n*u)*d,t[8]=(o*e-n*a)*d,t):null},f.adjoint=function(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],c=r[7],h=r[8];return t[0]=o*h-s*c,t[1]=i*c-n*h,t[2]=n*s-i*o,t[3]=s*u-a*h,t[4]=e*h-i*u,t[5]=i*a-e*s,t[6]=a*c-o*u,t[7]=n*u-e*c,t[8]=e*o-n*a,t},f.determinant=function(t){var r=t[0],e=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],c=t[8];return r*(c*a-o*u)+e*(-c*i+o*s)+n*(u*i-a*s)},f.multiply=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],c=r[6],h=r[7],f=r[8],l=e[0],_=e[1],d=e[2],y=e[3],m=e[4],v=e[5],p=e[6],g=e[7],E=e[8];return t[0]=l*n+_*o+d*c,t[1]=l*i+_*s+d*h,t[2]=l*a+_*u+d*f,t[3]=y*n+m*o+v*c,t[4]=y*i+m*s+v*h,t[5]=y*a+m*u+v*f,t[6]=p*n+g*o+E*c,t[7]=p*i+g*s+E*h,t[8]=p*a+g*u+E*f,t},f.mul=f.multiply,f.translate=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],c=r[6],h=r[7],f=r[8],l=e[0],_=e[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l*n+_*o+c,t[7]=l*i+_*s+h,t[8]=l*a+_*u+f,t},f.rotate=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],c=r[6],h=r[7],f=r[8],l=Math.sin(e),_=Math.cos(e);return t[0]=_*n+l*o,t[1]=_*i+l*s,t[2]=_*a+l*u,t[3]=_*o-l*n,t[4]=_*s-l*i,t[5]=_*u-l*a,t[6]=c,t[7]=h,t[8]=f,t},f.scale=function(t,r,e){var n=e[0],i=e[1];return t[0]=n*r[0],t[1]=n*r[1],t[2]=n*r[2],t[3]=i*r[3],t[4]=i*r[4],t[5]=i*r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t},f.fromMat2d=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=0,t[3]=r[2],t[4]=r[3],t[5]=0,t[6]=r[4],t[7]=r[5],t[8]=1,t},f.fromQuat=function(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=e+e,s=n+n,u=i+i,c=e*o,h=n*o,f=n*s,l=i*o,_=i*s,d=i*u,y=a*o,m=a*s,v=a*u;return t[0]=1-f-d,t[3]=h-v,t[6]=l+m,t[1]=h+v,t[4]=1-c-d,t[7]=_-y,t[2]=l-m,t[5]=_+y,t[8]=1-c-f,t},f.normalFromMat4=function(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],c=r[7],h=r[8],f=r[9],l=r[10],_=r[11],d=r[12],y=r[13],m=r[14],v=r[15],p=e*s-n*o,g=e*u-i*o,E=e*c-a*o,T=n*u-i*s,A=n*c-a*s,b=i*c-a*u,x=h*y-f*d,R=h*m-l*d,I=h*v-_*d,S=f*m-l*y,N=f*v-_*y,M=l*v-_*m,w=p*M-g*N+E*S+T*I-A*R+b*x;return w?(w=1/w,t[0]=(s*M-u*N+c*S)*w,t[1]=(u*I-o*M-c*R)*w,t[2]=(o*N-s*I+c*x)*w,t[3]=(i*N-n*M-a*S)*w,t[4]=(e*M-i*I+a*R)*w,t[5]=(n*I-e*N-a*x)*w,t[6]=(y*b-m*A+v*T)*w,t[7]=(m*E-d*b-v*g)*w,t[8]=(d*A-y*E+v*p)*w,t):null},f.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},f.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},"undefined"!=typeof t&&(t.mat3=f);var l={};l.create=function(){var t=new e(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.clone=function(t){var r=new e(16);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},l.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},l.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.transpose=function(t,r){if(t===r){var e=r[1],n=r[2],i=r[3],a=r[6],o=r[7],s=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=e,t[6]=r[9],t[7]=r[13],t[8]=n,t[9]=a,t[11]=r[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t},l.invert=function(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],c=r[7],h=r[8],f=r[9],l=r[10],_=r[11],d=r[12],y=r[13],m=r[14],v=r[15],p=e*s-n*o,g=e*u-i*o,E=e*c-a*o,T=n*u-i*s,A=n*c-a*s,b=i*c-a*u,x=h*y-f*d,R=h*m-l*d,I=h*v-_*d,S=f*m-l*y,N=f*v-_*y,M=l*v-_*m,w=p*M-g*N+E*S+T*I-A*R+b*x;return w?(w=1/w,t[0]=(s*M-u*N+c*S)*w,t[1]=(i*N-n*M-a*S)*w,t[2]=(y*b-m*A+v*T)*w,t[3]=(l*A-f*b-_*T)*w,t[4]=(u*I-o*M-c*R)*w,t[5]=(e*M-i*I+a*R)*w,t[6]=(m*E-d*b-v*g)*w,t[7]=(h*b-l*E+_*g)*w,t[8]=(o*N-s*I+c*x)*w,t[9]=(n*I-e*N-a*x)*w,t[10]=(d*A-y*E+v*p)*w,t[11]=(f*E-h*A-_*p)*w,t[12]=(s*R-o*S-u*x)*w,t[13]=(e*S-n*R+i*x)*w,t[14]=(y*g-d*T-m*p)*w,t[15]=(h*T-f*g+l*p)*w,t):null},l.adjoint=function(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],c=r[7],h=r[8],f=r[9],l=r[10],_=r[11],d=r[12],y=r[13],m=r[14],v=r[15];return t[0]=s*(l*v-_*m)-f*(u*v-c*m)+y*(u*_-c*l),t[1]=-(n*(l*v-_*m)-f*(i*v-a*m)+y*(i*_-a*l)),t[2]=n*(u*v-c*m)-s*(i*v-a*m)+y*(i*c-a*u),t[3]=-(n*(u*_-c*l)-s*(i*_-a*l)+f*(i*c-a*u)),t[4]=-(o*(l*v-_*m)-h*(u*v-c*m)+d*(u*_-c*l)),t[5]=e*(l*v-_*m)-h*(i*v-a*m)+d*(i*_-a*l),t[6]=-(e*(u*v-c*m)-o*(i*v-a*m)+d*(i*c-a*u)),t[7]=e*(u*_-c*l)-o*(i*_-a*l)+h*(i*c-a*u),t[8]=o*(f*v-_*y)-h*(s*v-c*y)+d*(s*_-c*f),t[9]=-(e*(f*v-_*y)-h*(n*v-a*y)+d*(n*_-a*f)),t[10]=e*(s*v-c*y)-o*(n*v-a*y)+d*(n*c-a*s),t[11]=-(e*(s*_-c*f)-o*(n*_-a*f)+h*(n*c-a*s)),t[12]=-(o*(f*m-l*y)-h*(s*m-u*y)+d*(s*l-u*f)),t[13]=e*(f*m-l*y)-h*(n*m-i*y)+d*(n*l-i*f),t[14]=-(e*(s*m-u*y)-o*(n*m-i*y)+d*(n*u-i*s)),t[15]=e*(s*l-u*f)-o*(n*l-i*f)+h*(n*u-i*s),t},l.determinant=function(t){var r=t[0],e=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],c=t[8],h=t[9],f=t[10],l=t[11],_=t[12],d=t[13],y=t[14],m=t[15],v=r*o-e*a,p=r*s-n*a,g=r*u-i*a,E=e*s-n*o,T=e*u-i*o,A=n*u-i*s,b=c*d-h*_,x=c*y-f*_,R=c*m-l*_,I=h*y-f*d,S=h*m-l*d,N=f*m-l*y;return v*N-p*S+g*I+E*R-T*x+A*b},l.multiply=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],c=r[6],h=r[7],f=r[8],l=r[9],_=r[10],d=r[11],y=r[12],m=r[13],v=r[14],p=r[15],g=e[0],E=e[1],T=e[2],A=e[3];return t[0]=g*n+E*s+T*f+A*y,t[1]=g*i+E*u+T*l+A*m,t[2]=g*a+E*c+T*_+A*v,t[3]=g*o+E*h+T*d+A*p,g=e[4],E=e[5],T=e[6],A=e[7],t[4]=g*n+E*s+T*f+A*y,t[5]=g*i+E*u+T*l+A*m,t[6]=g*a+E*c+T*_+A*v,t[7]=g*o+E*h+T*d+A*p,g=e[8],E=e[9],T=e[10],A=e[11],t[8]=g*n+E*s+T*f+A*y,t[9]=g*i+E*u+T*l+A*m,t[10]=g*a+E*c+T*_+A*v,t[11]=g*o+E*h+T*d+A*p,g=e[12],E=e[13],T=e[14],A=e[15],t[12]=g*n+E*s+T*f+A*y,t[13]=g*i+E*u+T*l+A*m,t[14]=g*a+E*c+T*_+A*v,t[15]=g*o+E*h+T*d+A*p,t},l.multiplyAffine=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[4],s=r[5],u=r[6],c=r[8],h=r[9],f=r[10],l=r[12],_=r[13],d=r[14],y=e[0],m=e[1],v=e[2];return t[0]=y*n+m*o+v*c,t[1]=y*i+m*s+v*h,t[2]=y*a+m*u+v*f,y=e[4],m=e[5],v=e[6],t[4]=y*n+m*o+v*c,t[5]=y*i+m*s+v*h,t[6]=y*a+m*u+v*f,y=e[8],m=e[9],v=e[10],t[8]=y*n+m*o+v*c,t[9]=y*i+m*s+v*h,t[10]=y*a+m*u+v*f,y=e[12],m=e[13],v=e[14],t[12]=y*n+m*o+v*c+l,t[13]=y*i+m*s+v*h+_,t[14]=y*a+m*u+v*f+d,t},l.mul=l.multiply,l.mulAffine=l.multiplyAffine,l.translate=function(t,r,e){var n,i,a,o,s,u,c,h,f,l,_,d,y=e[0],m=e[1],v=e[2];return r===t?(t[12]=r[0]*y+r[4]*m+r[8]*v+r[12],t[13]=r[1]*y+r[5]*m+r[9]*v+r[13],t[14]=r[2]*y+r[6]*m+r[10]*v+r[14],t[15]=r[3]*y+r[7]*m+r[11]*v+r[15]):(n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],c=r[6],h=r[7],f=r[8],l=r[9],_=r[10],d=r[11],t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=c,t[7]=h,t[8]=f,t[9]=l,t[10]=_,t[11]=d,t[12]=n*y+s*m+f*v+r[12],t[13]=i*y+u*m+l*v+r[13],t[14]=a*y+c*m+_*v+r[14],t[15]=o*y+h*m+d*v+r[15]),t},l.scale=function(t,r,e){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=r[7]*i,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=r[11]*a,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},l.rotate=function(t,e,n,i){var a,o,s,u,c,h,f,l,_,d,y,m,v,p,g,E,T,A,b,x,R,I,S,N,M=i[0],w=i[1],O=i[2],L=Math.sqrt(M*M+w*w+O*O);return Math.abs(L)<r?null:(L=1/L,M*=L,w*=L,O*=L,a=Math.sin(n),o=Math.cos(n),s=1-o,u=e[0],c=e[1],h=e[2],f=e[3],l=e[4],_=e[5],d=e[6],y=e[7],m=e[8],v=e[9],p=e[10],g=e[11],E=M*M*s+o,T=w*M*s+O*a,A=O*M*s-w*a,b=M*w*s-O*a,x=w*w*s+o,R=O*w*s+M*a,I=M*O*s+w*a,S=w*O*s-M*a,N=O*O*s+o,t[0]=u*E+l*T+m*A,t[1]=c*E+_*T+v*A,t[2]=h*E+d*T+p*A,t[3]=f*E+y*T+g*A,t[4]=u*b+l*x+m*R,t[5]=c*b+_*x+v*R,t[6]=h*b+d*x+p*R,t[7]=f*b+y*x+g*R,t[8]=u*I+l*S+m*N,t[9]=c*I+_*S+v*N,t[10]=h*I+d*S+p*N,t[11]=f*I+y*S+g*N,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},l.rotateX=function(t,r,e){var n=Math.sin(e),i=Math.cos(e),a=r[4],o=r[5],s=r[6],u=r[7],c=r[8],h=r[9],f=r[10],l=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=a*i+c*n,t[5]=o*i+h*n,t[6]=s*i+f*n,t[7]=u*i+l*n,t[8]=c*i-a*n,t[9]=h*i-o*n,t[10]=f*i-s*n,t[11]=l*i-u*n,t},l.rotateY=function(t,r,e){var n=Math.sin(e),i=Math.cos(e),a=r[0],o=r[1],s=r[2],u=r[3],c=r[8],h=r[9],f=r[10],l=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*i-c*n,t[1]=o*i-h*n,t[2]=s*i-f*n,t[3]=u*i-l*n,t[8]=a*n+c*i,t[9]=o*n+h*i,t[10]=s*n+f*i,t[11]=u*n+l*i,t},l.rotateZ=function(t,r,e){var n=Math.sin(e),i=Math.cos(e),a=r[0],o=r[1],s=r[2],u=r[3],c=r[4],h=r[5],f=r[6],l=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*i+c*n,t[1]=o*i+h*n,t[2]=s*i+f*n,t[3]=u*i+l*n,t[4]=c*i-a*n,t[5]=h*i-o*n,t[6]=f*i-s*n,t[7]=l*i-u*n,t},l.fromRotationTranslation=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=n+n,u=i+i,c=a+a,h=n*s,f=n*u,l=n*c,_=i*u,d=i*c,y=a*c,m=o*s,v=o*u,p=o*c;return t[0]=1-(_+y),t[1]=f+p,t[2]=l-v,t[3]=0,t[4]=f-p,t[5]=1-(h+y),t[6]=d+m,t[7]=0,t[8]=l+v,t[9]=d-m,t[10]=1-(h+_),t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},l.fromQuat=function(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=e+e,s=n+n,u=i+i,c=e*o,h=n*o,f=n*s,l=i*o,_=i*s,d=i*u,y=a*o,m=a*s,v=a*u;return t[0]=1-f-d,t[1]=h+v,t[2]=l-m,t[3]=0,t[4]=h-v,t[5]=1-c-d,t[6]=_+y,t[7]=0,t[8]=l+m,t[9]=_-y,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.frustum=function(t,r,e,n,i,a,o){var s=1/(e-r),u=1/(i-n),c=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(e+r)*s,t[9]=(i+n)*u,t[10]=(o+a)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*c,t[15]=0,t},l.perspective=function(t,r,e,n,i){var a=1/Math.tan(r/2),o=1/(n-i);return t[0]=a/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+n)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*n*o,t[15]=0,t},l.ortho=function(t,r,e,n,i,a,o){var s=1/(r-e),u=1/(n-i),c=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(r+e)*s,t[13]=(i+n)*u,t[14]=(o+a)*c,t[15]=1,t},l.lookAt=function(t,e,n,i){var a,o,s,u,c,h,f,_,d,y,m=e[0],v=e[1],p=e[2],g=i[0],E=i[1],T=i[2],A=n[0],b=n[1],x=n[2];return Math.abs(m-A)<r&&Math.abs(v-b)<r&&Math.abs(p-x)<r?l.identity(t):(f=m-A,_=v-b,d=p-x,y=1/Math.sqrt(f*f+_*_+d*d),f*=y,_*=y,d*=y,a=E*d-T*_,o=T*f-g*d,s=g*_-E*f,y=Math.sqrt(a*a+o*o+s*s),y?(y=1/y,a*=y,o*=y,s*=y):(a=0,o=0,s=0),u=_*s-d*o,c=d*a-f*s,h=f*o-_*a,y=Math.sqrt(u*u+c*c+h*h),y?(y=1/y,u*=y,c*=y,h*=y):(u=0,c=0,h=0),t[0]=a,t[1]=u,t[2]=f,t[3]=0,t[4]=o,t[5]=c,t[6]=_,t[7]=0,t[8]=s,t[9]=h,t[10]=d,t[11]=0,t[12]=-(a*m+o*v+s*p),t[13]=-(u*m+c*v+h*p),t[14]=-(f*m+_*v+d*p),t[15]=1,t)},l.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},l.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},"undefined"!=typeof t&&(t.mat4=l);var _={};_.create=function(){var t=new e(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},_.rotationTo=function(){var t=s.create(),r=s.fromValues(1,0,0),e=s.fromValues(0,1,0);return function(n,i,a){var o=s.dot(i,a);return o<-.999999?(s.cross(t,r,i),s.length(t)<1e-6&&s.cross(t,e,i),s.normalize(t,t),_.setAxisAngle(n,t,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(s.cross(t,i,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+o,_.normalize(n,n))}}(),_.setAxes=function(){var t=f.create();return function(r,e,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-e[0],t[5]=-e[1],t[8]=-e[2],_.normalize(r,_.fromMat3(r,t))}}(),_.clone=u.clone,_.fromValues=u.fromValues,_.copy=u.copy,_.set=u.set,_.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},_.setAxisAngle=function(t,r,e){e*=.5;var n=Math.sin(e);return t[0]=n*r[0],t[1]=n*r[1],t[2]=n*r[2],t[3]=Math.cos(e),t},_.add=u.add,_.multiply=function(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=e[0],u=e[1],c=e[2],h=e[3];return t[0]=n*h+o*s+i*c-a*u,t[1]=i*h+o*u+a*s-n*c,t[2]=a*h+o*c+n*u-i*s,t[3]=o*h-n*s-i*u-a*c,t},_.mul=_.multiply,_.scale=u.scale,_.rotateX=function(t,r,e){e*=.5;var n=r[0],i=r[1],a=r[2],o=r[3],s=Math.sin(e),u=Math.cos(e);return t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=a*u-i*s,t[3]=o*u-n*s,t},_.rotateY=function(t,r,e){e*=.5;var n=r[0],i=r[1],a=r[2],o=r[3],s=Math.sin(e),u=Math.cos(e);return t[0]=n*u-a*s,t[1]=i*u+o*s,t[2]=a*u+n*s,t[3]=o*u-i*s,t},_.rotateZ=function(t,r,e){e*=.5;var n=r[0],i=r[1],a=r[2],o=r[3],s=Math.sin(e),u=Math.cos(e);return t[0]=n*u+i*s,t[1]=i*u-n*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t},_.calculateW=function(t,r){var e=r[0],n=r[1],i=r[2];return t[0]=e,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-e*e-n*n-i*i)),t},_.dot=u.dot,_.lerp=u.lerp,_.slerp=function(t,r,e,n){var i,a,o,s,u,c=r[0],h=r[1],f=r[2],l=r[3],_=e[0],d=e[1],y=e[2],m=e[3];return a=c*_+h*d+f*y+l*m,a<0&&(a=-a,_=-_,d=-d,y=-y,m=-m),1-a>1e-6?(i=Math.acos(a),o=Math.sin(i),s=Math.sin((1-n)*i)/o,u=Math.sin(n*i)/o):(s=1-n,u=n),t[0]=s*c+u*_,t[1]=s*h+u*d,t[2]=s*f+u*y,t[3]=s*l+u*m,t},_.invert=function(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=e*e+n*n+i*i+a*a,s=o?1/o:0;return t[0]=-e*s,t[1]=-n*s,t[2]=-i*s,t[3]=a*s,t},_.conjugate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=r[3],t},_.length=u.length,_.len=_.length,_.squaredLength=u.squaredLength,_.sqrLen=_.squaredLength,_.normalize=u.normalize,_.fromMat3=function(t,r){var e,n=r[0]+r[4]+r[8];if(n>0)e=Math.sqrt(n+1),t[3]=.5*e,e=.5/e,t[0]=(r[5]-r[7])*e,t[1]=(r[6]-r[2])*e,t[2]=(r[1]-r[3])*e;else{var i=0;r[4]>r[0]&&(i=1),r[8]>r[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;e=Math.sqrt(r[3*i+i]-r[3*a+a]-r[3*o+o]+1),t[i]=.5*e,e=.5/e,t[3]=(r[3*a+o]-r[3*o+a])*e,t[a]=(r[3*a+i]+r[3*i+a])*e,t[o]=(r[3*o+i]+r[3*i+o])*e}return t},_.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.quat=_)}(e.exports)}(this)},function(r,e){r.exports=t},function(t,r,e){"use strict";function n(t,r,e){return t<r?r:t>e?e:t}var i=e(1),a=i.vec3,o=function(t,r,e){t=t||0,r=r||0,e=e||0,this._array=a.fromValues(t,r,e),this._dirty=!0};o.prototype={constructor:o,add:function(t){return a.add(this._array,this._array,t._array),this._dirty=!0,this},set:function(t,r,e){return this._array[0]=t,this._array[1]=r,this._array[2]=e,this._dirty=!0,this},setArray:function(t){return this._array[0]=t[0],this._array[1]=t[1],this._array[2]=t[2],this._dirty=!0,this},clone:function(){return new o(this.x,this.y,this.z)},copy:function(t){return a.copy(this._array,t._array),this._dirty=!0,this},cross:function(t,r){return a.cross(this._array,t._array,r._array),this._dirty=!0,this},dist:function(t){return a.dist(this._array,t._array)},distance:function(t){return a.distance(this._array,t._array)},div:function(t){return a.div(this._array,this._array,t._array),this._dirty=!0,this},divide:function(t){return a.divide(this._array,this._array,t._array),this._dirty=!0,this},dot:function(t){return a.dot(this._array,t._array)},len:function(){return a.len(this._array)},length:function(){return a.length(this._array)},lerp:function(t,r,e){return a.lerp(this._array,t._array,r._array,e),this._dirty=!0,this},min:function(t){return a.min(this._array,this._array,t._array),this._dirty=!0,this},max:function(t){return a.max(this._array,this._array,t._array),this._dirty=!0,this},mul:function(t){return a.mul(this._array,this._array,t._array),this._dirty=!0,this},multiply:function(t){return a.multiply(this._array,this._array,t._array),this._dirty=!0,this},negate:function(){return a.negate(this._array,this._array),this._dirty=!0,this},normalize:function(){return a.normalize(this._array,this._array),this._dirty=!0,this},random:function(t){return a.random(this._array,t),this._dirty=!0,this},scale:function(t){return a.scale(this._array,this._array,t),this._dirty=!0,this},scaleAndAdd:function(t,r){return a.scaleAndAdd(this._array,this._array,t._array,r),this._dirty=!0,this},sqrDist:function(t){return a.sqrDist(this._array,t._array)},squaredDistance:function(t){return a.squaredDistance(this._array,t._array)},sqrLen:function(){return a.sqrLen(this._array)},squaredLength:function(){return a.squaredLength(this._array)},sub:function(t){return a.sub(this._array,this._array,t._array),this._dirty=!0,this},subtract:function(t){return a.subtract(this._array,this._array,t._array),this._dirty=!0,this},transformMat3:function(t){return a.transformMat3(this._array,this._array,t._array),this._dirty=!0,this},transformMat4:function(t){return a.transformMat4(this._array,this._array,t._array),this._dirty=!0,this},transformQuat:function(t){return a.transformQuat(this._array,this._array,t._array),this._dirty=!0,this},applyProjection:function(t){var r=this._array;if(t=t._array,0===t[15]){var e=-1/r[2];r[0]=t[0]*r[0]*e,r[1]=t[5]*r[1]*e,r[2]=(t[10]*r[2]+t[14])*e}else r[0]=t[0]*r[0]+t[12],r[1]=t[5]*r[1]+t[13],r[2]=t[10]*r[2]+t[14];return this._dirty=!0,this},eulerFromQuat:function(t,r){o.eulerFromQuat(this,t,r)},eulerFromMat3:function(t,r){o.eulerFromMat3(this,t,r)},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"},
toArray:function(){return Array.prototype.slice.call(this._array)}};var s=Object.defineProperty;if(s){var u=o.prototype;s(u,"x",{get:function(){return this._array[0]},set:function(t){this._array[0]=t,this._dirty=!0}}),s(u,"y",{get:function(){return this._array[1]},set:function(t){this._array[1]=t,this._dirty=!0}}),s(u,"z",{get:function(){return this._array[2]},set:function(t){this._array[2]=t,this._dirty=!0}})}o.add=function(t,r,e){return a.add(t._array,r._array,e._array),t._dirty=!0,t},o.set=function(t,r,e,n){a.set(t._array,r,e,n),t._dirty=!0},o.copy=function(t,r){return a.copy(t._array,r._array),t._dirty=!0,t},o.cross=function(t,r,e){return a.cross(t._array,r._array,e._array),t._dirty=!0,t},o.dist=function(t,r){return a.distance(t._array,r._array)},o.distance=o.dist,o.div=function(t,r,e){return a.divide(t._array,r._array,e._array),t._dirty=!0,t},o.divide=o.div,o.dot=function(t,r){return a.dot(t._array,r._array)},o.len=function(t){return a.length(t._array)},o.lerp=function(t,r,e,n){return a.lerp(t._array,r._array,e._array,n),t._dirty=!0,t},o.min=function(t,r,e){return a.min(t._array,r._array,e._array),t._dirty=!0,t},o.max=function(t,r,e){return a.max(t._array,r._array,e._array),t._dirty=!0,t},o.mul=function(t,r,e){return a.multiply(t._array,r._array,e._array),t._dirty=!0,t},o.multiply=o.mul,o.negate=function(t,r){return a.negate(t._array,r._array),t._dirty=!0,t},o.normalize=function(t,r){return a.normalize(t._array,r._array),t._dirty=!0,t},o.random=function(t,r){return a.random(t._array,r),t._dirty=!0,t},o.scale=function(t,r,e){return a.scale(t._array,r._array,e),t._dirty=!0,t},o.scaleAndAdd=function(t,r,e,n){return a.scaleAndAdd(t._array,r._array,e._array,n),t._dirty=!0,t},o.sqrDist=function(t,r){return a.sqrDist(t._array,r._array)},o.squaredDistance=o.sqrDist,o.sqrLen=function(t){return a.sqrLen(t._array)},o.squaredLength=o.sqrLen,o.sub=function(t,r,e){return a.subtract(t._array,r._array,e._array),t._dirty=!0,t},o.subtract=o.sub,o.transformMat3=function(t,r,e){return a.transformMat3(t._array,r._array,e._array),t._dirty=!0,t},o.transformMat4=function(t,r,e){return a.transformMat4(t._array,r._array,e._array),t._dirty=!0,t},o.transformQuat=function(t,r,e){return a.transformQuat(t._array,r._array,e._array),t._dirty=!0,t};var c=Math.atan2,h=Math.asin,f=Math.abs;o.eulerFromQuat=function(t,r,e){t._dirty=!0,r=r._array;var i=t._array,a=r[0],o=r[1],s=r[2],u=r[3],f=a*a,l=o*o,_=s*s,d=u*u,e=(e||"XYZ").toUpperCase();switch(e){case"XYZ":i[0]=c(2*(a*u-o*s),d-f-l+_),i[1]=h(n(2*(a*s+o*u),-1,1)),i[2]=c(2*(s*u-a*o),d+f-l-_);break;case"YXZ":i[0]=h(n(2*(a*u-o*s),-1,1)),i[1]=c(2*(a*s+o*u),d-f-l+_),i[2]=c(2*(a*o+s*u),d-f+l-_);break;case"ZXY":i[0]=h(n(2*(a*u+o*s),-1,1)),i[1]=c(2*(o*u-s*a),d-f-l+_),i[2]=c(2*(s*u-a*o),d-f+l-_);break;case"ZYX":i[0]=c(2*(a*u+s*o),d-f-l+_),i[1]=h(n(2*(o*u-a*s),-1,1)),i[2]=c(2*(a*o+s*u),d+f-l-_);break;case"YZX":i[0]=c(2*(a*u-s*o),d-f+l-_),i[1]=c(2*(o*u-a*s),d+f-l-_),i[2]=h(n(2*(a*o+s*u),-1,1));break;case"XZY":i[0]=c(2*(a*u+o*s),d-f+l-_),i[1]=c(2*(a*s+o*u),d+f-l-_),i[2]=h(n(2*(s*u-a*o),-1,1));break;default:console.warn("Unkown order: "+e)}return t},o.eulerFromMat3=function(t,r,e){var i=r._array,a=i[0],o=i[3],s=i[6],u=i[1],l=i[4],_=i[7],d=i[2],y=i[5],m=i[8],v=t._array,e=(e||"XYZ").toUpperCase();switch(e){case"XYZ":v[1]=h(n(s,-1,1)),f(s)<.99999?(v[0]=c(-_,m),v[2]=c(-o,a)):(v[0]=c(y,l),v[2]=0);break;case"YXZ":v[0]=h(-n(_,-1,1)),f(_)<.99999?(v[1]=c(s,m),v[2]=c(u,l)):(v[1]=c(-d,a),v[2]=0);break;case"ZXY":v[0]=h(n(y,-1,1)),f(y)<.99999?(v[1]=c(-d,m),v[2]=c(-o,l)):(v[1]=0,v[2]=c(u,a));break;case"ZYX":v[1]=h(-n(d,-1,1)),f(d)<.99999?(v[0]=c(y,m),v[2]=c(u,a)):(v[0]=0,v[2]=c(-o,l));break;case"YZX":v[2]=h(n(u,-1,1)),f(u)<.99999?(v[0]=c(-_,l),v[1]=c(-d,a)):(v[0]=0,v[1]=c(s,m));break;case"XZY":v[2]=h(-n(o,-1,1)),f(o)<.99999?(v[0]=c(y,l),v[1]=c(s,a)):(v[0]=c(-_,m),v[1]=0);break;default:console.warn("Unkown order: "+e)}return t._dirty=!0,t},o.POSITIVE_X=new o(1,0,0),o.NEGATIVE_X=new o(-1,0,0),o.POSITIVE_Y=new o(0,1,0),o.NEGATIVE_Y=new o(0,-1,0),o.POSITIVE_Z=new o(0,0,1),o.NEGATIVE_Z=new o(0,0,-1),o.UP=new o(0,1,0),o.ZERO=new o(0,0,0),t.exports=o},function(t,r,e){"use strict";var n=e(3),i=e(1),a=i.vec3,o=a.copy,s=a.set,u=function(t,r){this.min=t||new n(1/0,1/0,1/0),this.max=r||new n(-(1/0),-(1/0),-(1/0))};u.prototype={constructor:u,updateFromVertices:function(t){if(t.length>0){var r=this.min,e=this.max,n=r._array,i=e._array;o(n,t[0]),o(i,t[0]);for(var a=1;a<t.length;a++){var s=t[a];s[0]<n[0]&&(n[0]=s[0]),s[1]<n[1]&&(n[1]=s[1]),s[2]<n[2]&&(n[2]=s[2]),s[0]>i[0]&&(i[0]=s[0]),s[1]>i[1]&&(i[1]=s[1]),s[2]>i[2]&&(i[2]=s[2])}r._dirty=!0,e._dirty=!0}},union:function(t){var r=this.min,e=this.max;a.min(r._array,r._array,t.min._array),a.max(e._array,e._array,t.max._array),r._dirty=!0,e._dirty=!0},intersectBoundingBox:function(t){var r=this.min._array,e=this.max._array,n=t.min._array,i=t.max._array;return!(r[0]>i[0]||r[1]>i[1]||r[2]>i[2]||e[0]<n[0]||e[1]<n[1]||e[2]<n[2])},containBoundingBox:function(t){var r=this.min._array,e=this.max._array,n=t.min._array,i=t.max._array;return r[0]<=n[0]&&r[1]<=n[1]&&r[2]<=n[2]&&e[0]>=i[0]&&e[1]>=i[1]&&e[2]>=i[2]},containPoint:function(t){var r=this.min._array,e=this.max._array,n=t._array;return r[0]<=n[0]&&r[1]<=n[1]&&r[2]<=n[2]&&e[0]>=n[0]&&e[1]>=n[1]&&e[2]>=n[2]},isFinite:function(){var t=this.min._array,r=this.max._array;return isFinite(t[0])&&isFinite(t[1])&&isFinite(t[2])&&isFinite(r[0])&&isFinite(r[1])&&isFinite(r[2])},applyTransform:function(){var t=a.create(),r=a.create(),e=a.create(),n=a.create(),i=a.create(),o=a.create();return function(a){var s=this.min._array,u=this.max._array,c=a._array;t[0]=c[0]*s[0],t[1]=c[1]*s[1],t[2]=c[2]*s[2],r[0]=c[0]*u[0],r[1]=c[1]*u[1],r[2]=c[2]*u[2],e[0]=c[4]*s[0],e[1]=c[5]*s[1],e[2]=c[6]*s[2],n[0]=c[4]*u[0],n[1]=c[5]*u[1],n[2]=c[6]*u[2],i[0]=c[8]*s[0],i[1]=c[9]*s[1],i[2]=c[10]*s[2],o[0]=c[8]*u[0],o[1]=c[9]*u[1],o[2]=c[10]*u[2],s[0]=Math.min(t[0],r[0])+Math.min(e[0],n[0])+Math.min(i[0],o[0])+c[12],s[1]=Math.min(t[1],r[1])+Math.min(e[1],n[1])+Math.min(i[1],o[1])+c[13],s[2]=Math.min(t[2],r[2])+Math.min(e[2],n[2])+Math.min(i[2],o[2])+c[14],u[0]=Math.max(t[0],r[0])+Math.max(e[0],n[0])+Math.max(i[0],o[0])+c[12],u[1]=Math.max(t[1],r[1])+Math.max(e[1],n[1])+Math.max(i[1],o[1])+c[13],u[2]=Math.max(t[2],r[2])+Math.max(e[2],n[2])+Math.max(i[2],o[2])+c[14],this.min._dirty=!0,this.max._dirty=!0}}(),applyProjection:function(t){var r=this.min._array,e=this.max._array,n=t._array,i=r[0],a=r[1],o=r[2],s=e[0],u=e[1],c=r[2],h=e[0],f=e[1],l=e[2];if(1===n[15])r[0]=n[0]*i+n[12],r[1]=n[5]*a+n[13],e[2]=n[10]*o+n[14],e[0]=n[0]*h+n[12],e[1]=n[5]*f+n[13],r[2]=n[10]*l+n[14];else{var _=-1/o;r[0]=n[0]*i*_,r[1]=n[5]*a*_,e[2]=(n[10]*o+n[14])*_,_=-1/c,e[0]=n[0]*s*_,e[1]=n[5]*u*_,_=-1/l,r[2]=(n[10]*l+n[14])*_}this.min._dirty=!0,this.max._dirty=!0},updateVertices:function(){var t=this.vertices;if(!t){for(var t=[],r=0;r<8;r++)t[r]=a.fromValues(0,0,0);this.vertices=t}var e=this.min._array,n=this.max._array;s(t[0],e[0],e[1],e[2]),s(t[1],e[0],n[1],e[2]),s(t[2],n[0],e[1],e[2]),s(t[3],n[0],n[1],e[2]),s(t[4],e[0],e[1],n[2]),s(t[5],e[0],n[1],n[2]),s(t[6],n[0],e[1],n[2]),s(t[7],n[0],n[1],n[2])},copy:function(t){var r=this.min,e=this.max;o(r._array,t.min._array),o(e._array,t.max._array),r._dirty=!0,e._dirty=!0},clone:function(){var t=new u;return t.copy(this),t}},t.exports=u},function(t,r){t.exports={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444}},function(t,r,e){"use strict";var n=e(68),i=e(69),a=e(19),o=function(){this.__GUID__=a.genGUID()};o.__initializers__=[function(t){a.extend(this,t)}],a.extend(o,n),a.extend(o.prototype,i),t.exports=o},function(t,r,e){"use strict";var n=e(24),i=e(4),a=e(1),o=e(9),s=e(5),u=a.mat4,c=a.vec3,h=n.StaticAttribute,f=c.create,l=c.add,_=c.set,d=n.extend(function(){return{attributes:{position:new h("position","float",3,"POSITION"),texcoord0:new h("texcoord0","float",2,"TEXCOORD_0"),texcoord1:new h("texcoord1","float",2,"TEXCOORD_1"),normal:new h("normal","float",3,"NORMAL"),tangent:new h("tangent","float",4,"TANGENT"),color:new h("color","float",4,"COLOR"),weight:new h("weight","float",3,"WEIGHT"),joint:new h("joint","float",4,"JOINT"),barycentric:new h("barycentric","float",3,null)},hint:s.STATIC_DRAW,faces:null,_normalType:"vertex",_enabledAttributes:null}},{updateBoundingBox:function(){var t=this.boundingBox;t||(t=this.boundingBox=new i);var r=this.attributes.position.value;if(r&&r.length){var e=t.min,n=t.max,a=e._array,o=n._array;c.set(a,r[0],r[1],r[2]),c.set(o,r[0],r[1],r[2]);for(var s=3;s<r.length;){var u=r[s++],h=r[s++],f=r[s++];u<a[0]&&(a[0]=u),h<a[1]&&(a[1]=h),f<a[2]&&(a[2]=f),u>o[0]&&(o[0]=u),h>o[1]&&(o[1]=h),f>o[2]&&(o[2]=f)}e._dirty=!0,n._dirty=!0}},dirty:function(){this._cache.dirtyAll(),this._enabledAttributes=null},getFace:function(t,r){if(t<this.faceCount&&t>=0){r||(r=f());var e=this.faces;return r[0]=e[3*t],r[1]=e[3*t+1],r[2]=e[3*t+2],r}},setFace:function(t,r){var e=this.faces;e[3*t]=r[0],e[3*t+1]=r[1],e[3*t+2]=r[2]},isUseFace:function(){return this.useFace&&null!=this.faces},initFaceFromArray:function(t){var r,e=this.vertexCount>65535?o.Uint32Array:o.Uint16Array;if(t[0]&&t[0].length){var n=0,i=3;r=new e(t.length*i);for(var a=0;a<t.length;a++)for(var s=0;s<i;s++)r[n++]=t[a][s]}else r=new e(t);this.faces=r},createAttribute:function(t,r,e,n){var i=new h(t,r,e,n);return this.attributes[t]=i,this._attributeList.push(t),i},removeAttribute:function(t){var r=this._attributeList,e=r.indexOf(t);return e>=0&&(r.splice(e,1),delete this.attributes[t],!0)},getEnabledAttributes:function(){var t=this._enabledAttributes,r=this._attributeList;if(t)return t;for(var e=[],n=this.vertexCount,i=0;i<r.length;i++){var a=r[i],o=this.attributes[a];o.value&&o.value.length===n*o.size&&e.push(a)}return this._enabledAttributes=e,e},getBufferChunks:function(t){var r=this._cache;return r.use(t.__GLID__),r.isDirty()&&(this._updateBuffer(t),r.fresh()),r.get("chunks")},_updateBuffer:function(t){var r=this._cache.get("chunks"),e=!1;r||(r=[],r[0]={attributeBuffers:[],indicesBuffer:null},this._cache.put("chunks",r),e=!0);for(var i=r[0],a=i.attributeBuffers,o=i.indicesBuffer,s=this.getEnabledAttributes(),u=0,c=0,h=0;h<s.length;h++){var f,l=s[h],_=this.attributes[l];if(!e){for(var d=u;d<a.length;d++)if(a[d].name===l){f=a[d],u=d+1;break}if(!f)for(var d=u-1;d>=0;d--)if(a[d].name===l){f=a[d],u=d;break}}var y;y=f?f.buffer:t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,y),t.bufferData(t.ARRAY_BUFFER,_.value,this.hint),a[c++]=new n.AttributeBuffer(l,_.type,y,_.size,_.semantic)}a.length=c,this.isUseFace()&&(o||(o=new n.IndicesBuffer(t.createBuffer()),i.indicesBuffer=o),o.count=this.faces.length,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.faces,this.hint))},generateVertexNormals:function(){var t=this.faces,r=this.attributes,e=r.position.value,n=r.normal.value;if(n&&n.length===e.length)for(var i=0;i<n.length;i++)n[i]=0;else n=r.normal.value=new o.Float32Array(e.length);for(var a=f(),s=f(),u=f(),h=f(),l=f(),d=f(),y=0;y<t.length;){var m=t[y++],v=t[y++],p=t[y++];_(a,e[3*m],e[3*m+1],e[3*m+2]),_(s,e[3*v],e[3*v+1],e[3*v+2]),_(u,e[3*p],e[3*p+1],e[3*p+2]),c.sub(h,a,s),c.sub(l,s,u),c.cross(d,h,l);for(var i=0;i<3;i++)n[3*m+i]=n[3*m+i]+d[i],n[3*v+i]=n[3*v+i]+d[i],n[3*p+i]=n[3*p+i]+d[i]}for(var i=0;i<n.length;)_(d,n[i],n[i+1],n[i+2]),c.normalize(d,d),n[i++]=d[0],n[i++]=d[1],n[i++]=d[2];this.dirty()},generateFaceNormals:function(){this.isUniqueVertex()||this.generateUniqueVertex();var t=this.faces,r=this.attributes,e=r.position.value,n=r.normal.value,i=f(),a=f(),o=f(),s=f(),u=f(),h=f();n||(n=r.normal.value=new Float32Array(e.length));for(var l=0;l<t.length;){var d=t[l++],y=t[l++],m=t[l++];_(i,e[3*d],e[3*d+1],e[3*d+2]),_(a,e[3*y],e[3*y+1],e[3*y+2]),_(o,e[3*m],e[3*m+1],e[3*m+2]),c.sub(s,i,a),c.sub(u,a,o),c.cross(h,s,u),c.normalize(h,h);for(var v=0;v<3;v++)n[3*d+v]=h[v],n[3*y+v]=h[v],n[3*m+v]=h[v]}this.dirty()},generateTangents:function(){var t=this.vertexCount,r=this.attributes;r.tangent.value||(r.tangent.value=new Float32Array(4*t));for(var e=r.texcoord0.value,n=r.position.value,i=r.tangent.value,a=r.normal.value,o=[],s=[],u=0;u<t;u++)o[u]=[0,0,0],s[u]=[0,0,0];for(var h=[0,0,0],_=[0,0,0],d=this.faces,u=0;u<d.length;){var y=d[u++],m=d[u++],v=d[u++],p=e[2*y],g=e[2*m],E=e[2*v],T=e[2*y+1],A=e[2*m+1],b=e[2*v+1],x=n[3*y],R=n[3*m],I=n[3*v],S=n[3*y+1],N=n[3*m+1],M=n[3*v+1],w=n[3*y+2],O=n[3*m+2],L=n[3*v+2],C=R-x,P=I-x,D=N-S,U=M-S,F=O-w,B=L-w,k=g-p,V=E-p,G=A-T,W=b-T,X=1/(k*W-G*V);h[0]=(W*C-G*P)*X,h[1]=(W*D-G*U)*X,h[2]=(W*F-G*B)*X,_[0]=(k*P-V*C)*X,_[1]=(k*U-V*D)*X,_[2]=(k*B-V*F)*X,l(o[y],o[y],h),l(o[m],o[m],h),l(o[v],o[v],h),l(s[y],s[y],_),l(s[m],s[m],_),l(s[v],s[v],_)}for(var z=f(),H=f(),q=f(),u=0;u<t;u++){q[0]=a[3*u],q[1]=a[3*u+1],q[2]=a[3*u+2];var j=o[u];c.scale(z,q,c.dot(q,j)),c.sub(z,j,z),c.normalize(z,z),c.cross(H,q,j),i[4*u]=z[0],i[4*u+1]=z[1],i[4*u+2]=z[2],i[4*u+3]=c.dot(H,s[u])<0?-1:1}this.dirty()},isUniqueVertex:function(){return!this.isUseFace()||this.vertexCount===this.faces.length},generateUniqueVertex:function(){for(var t=[],r=0,e=this.vertexCount;r<e;r++)t[r]=0;this.faces.length>65535&&(this.faces=new o.Uint32Array(this.faces));for(var n=0,i=this.attributes,a=this.faces,r=0;r<a.length;r++)n=Math.max(n,a[r]+1);for(var s=this.getEnabledAttributes(),u=0;u<s.length;u++){var c=s[u],h=i[c].value;i[c].init(this.faces.length);for(var f=i[c].value,r=0;r<h.length;r++)f[r]=h[r]}for(var r=0;r<a.length;r++){var l=a[r];if(t[l]>0){for(var u=0;u<s.length;u++)for(var c=s[u],_=i[c].value,d=i[c].size,y=0;y<d;y++)_[n*d+y]=_[l*d+y];a[r]=n,n++}t[l]++}this.dirty()},generateBarycentric:function(){this.isUniqueVertex()||this.generateUniqueVertex();var t=this.attributes,r=t.barycentric.value,e=this.faces;if(!r||r.length!==3*e.length){r=t.barycentric.value=new Float32Array(3*e.length);for(var n=0;n<e.length;)for(var i=0;i<3;i++){var a=e[n++];r[3*a+i]=1}this.dirty()}},convertToDynamic:function(t){for(var r=0;r<this.faces.length;r+=3)t.faces.push(this.face.subarray(r,r+3));var e=this.getEnabledAttributes();for(var n in e){var a=e[n],o=t.attributes[n];o||(o=t.attributes[n]={type:a.type,size:a.size,value:[]},a.semantic&&(o.semantic=a.semantic));for(var r=0;r<a.value.length;r+=a.size)1===a.size?o.value.push(a.array[r]):o.value.push(a.subarray(r,r+a.size))}return this.boundingBox&&(t.boundingBox=new i,t.boundingBox.min.copy(this.boundingBox.min),t.boundingBox.max.copy(this.boundingBox.max)),t},applyTransform:function(t){var r=this.attributes,e=r.position.value,n=r.normal.value,i=r.tangent.value;t=t._array;var a=u.create();u.invert(a,t),u.transpose(a,a);var o=c.transformMat4,s=c.forEach;s(e,3,0,null,o,t),n&&s(n,3,0,null,o,a),i&&s(i,4,0,null,o,a),this.boundingBox&&this.updateBoundingBox()},dispose:function(t){var r=this._cache;r.use(t.__GLID__);var e=r.get("chunks");if(e)for(var n=0;n<e.length;n++)for(var i=e[n],a=0;a<i.attributeBuffers.length;a++){var o=i.attributeBuffers[a];t.deleteBuffer(o.buffer)}r.deleteContext(t.__GLID__)}});Object.defineProperty&&(Object.defineProperty(d.prototype,"vertexCount",{enumerable:!1,get:function(){var t=this.attributes[this.mainAttribute];return t&&t.value?t.value.length/t.size:0}}),Object.defineProperty(d.prototype,"faceCount",{enumerable:!1,get:function(){var t=this.faces;return t?t.length/3:0}})),d.Attribute=n.StaticAttribute,t.exports=d},function(t,r,e){"use strict";var n=e(1),i=e(3),a=n.mat4,o=n.vec3,s=n.mat3,u=n.quat,c=function(){this._axisX=new i,this._axisY=new i,this._axisZ=new i,this._array=a.create(),this._dirty=!0};c.prototype={constructor:c,setArray:function(t){for(var r=0;r<this._array.length;r++)this._array[r]=t[r];return this._dirty=!0,this},adjoint:function(){return a.adjoint(this._array,this._array),this._dirty=!0,this},clone:function(){return(new c).copy(this)},copy:function(t){return a.copy(this._array,t._array),this._dirty=!0,this},determinant:function(){return a.determinant(this._array)},fromQuat:function(t){return a.fromQuat(this._array,t._array),this._dirty=!0,this},fromRotationTranslation:function(t,r){return a.fromRotationTranslation(this._array,t._array,r._array),this._dirty=!0,this},fromMat2d:function(t){return c.fromMat2d(this,t),this},frustum:function(t,r,e,n,i,o){return a.frustum(this._array,t,r,e,n,i,o),this._dirty=!0,this},identity:function(){return a.identity(this._array),this._dirty=!0,this},invert:function(){return a.invert(this._array,this._array),this._dirty=!0,this},lookAt:function(t,r,e){return a.lookAt(this._array,t._array,r._array,e._array),this._dirty=!0,this},mul:function(t){return a.mul(this._array,this._array,t._array),this._dirty=!0,this},mulLeft:function(t){return a.mul(this._array,t._array,this._array),this._dirty=!0,this},multiply:function(t){return a.multiply(this._array,this._array,t._array),this._dirty=!0,this},multiplyLeft:function(t){return a.multiply(this._array,t._array,this._array),this._dirty=!0,this},ortho:function(t,r,e,n,i,o){return a.ortho(this._array,t,r,e,n,i,o),this._dirty=!0,this},perspective:function(t,r,e,n){return a.perspective(this._array,t,r,e,n),this._dirty=!0,this},rotate:function(t,r){return a.rotate(this._array,this._array,t,r._array),this._dirty=!0,this},rotateX:function(t){return a.rotateX(this._array,this._array,t),this._dirty=!0,this},rotateY:function(t){return a.rotateY(this._array,this._array,t),this._dirty=!0,this},rotateZ:function(t){return a.rotateZ(this._array,this._array,t),this._dirty=!0,this},scale:function(t){return a.scale(this._array,this._array,t._array),this._dirty=!0,this},translate:function(t){return a.translate(this._array,this._array,t._array),this._dirty=!0,this},transpose:function(){return a.transpose(this._array,this._array),this._dirty=!0,this},decomposeMatrix:function(){var t=o.create(),r=o.create(),e=o.create(),n=s.create();return function(i,a,c){var h=this._array;o.set(t,h[0],h[1],h[2]),o.set(r,h[4],h[5],h[6]),o.set(e,h[8],h[9],h[10]);var f=o.length(t),l=o.length(r),_=o.length(e);i&&(i.x=f,i.y=l,i.z=_,i._dirty=!0),c.set(h[12],h[13],h[14]),s.fromMat4(n,h),n[0]/=f,n[1]/=f,n[2]/=f,n[3]/=l,n[4]/=l,n[5]/=l,n[6]/=_,n[7]/=_,n[8]/=_,u.fromMat3(a._array,n),u.normalize(a._array,a._array),a._dirty=!0,c._dirty=!0}}(),toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this._array)}};var h=Object.defineProperty;if(h){var f=c.prototype;h(f,"z",{get:function(){var t=this._array;return this._axisZ.set(t[8],t[9],t[10]),this._axisZ},set:function(t){var r=this._array;t=t._array,r[8]=t[0],r[9]=t[1],r[10]=t[2],this._dirty=!0}}),h(f,"y",{get:function(){var t=this._array;return this._axisY.set(t[4],t[5],t[6]),this._axisY},set:function(t){var r=this._array;t=t._array,r[4]=t[0],r[5]=t[1],r[6]=t[2],this._dirty=!0}}),h(f,"x",{get:function(){var t=this._array;return this._axisX.set(t[0],t[1],t[2]),this._axisX},set:function(t){var r=this._array;t=t._array,r[0]=t[0],r[1]=t[1],r[2]=t[2],this._dirty=!0}})}c.adjoint=function(t,r){return a.adjoint(t._array,r._array),t._dirty=!0,t},c.copy=function(t,r){return a.copy(t._array,r._array),t._dirty=!0,t},c.determinant=function(t){return a.determinant(t._array)},c.identity=function(t){return a.identity(t._array),t._dirty=!0,t},c.ortho=function(t,r,e,n,i,o,s){return a.ortho(t._array,r,e,n,i,o,s),t._dirty=!0,t},c.perspective=function(t,r,e,n,i){return a.perspective(t._array,r,e,n,i),t._dirty=!0,t},c.lookAt=function(t,r,e,n){return a.lookAt(t._array,r._array,e._array,n._array),t._dirty=!0,t},c.invert=function(t,r){return a.invert(t._array,r._array),t._dirty=!0,t},c.mul=function(t,r,e){return a.mul(t._array,r._array,e._array),t._dirty=!0,t},c.multiply=c.mul,c.fromQuat=function(t,r){return a.fromQuat(t._array,r._array),t._dirty=!0,t},c.fromRotationTranslation=function(t,r,e){return a.fromRotationTranslation(t._array,r._array,e._array),t._dirty=!0,t},c.fromMat2d=function(t,r){t._dirty=!0;var r=r._array,t=t._array;return t[0]=r[0],t[4]=r[2],t[12]=r[4],t[1]=r[1],t[5]=r[3],t[13]=r[5],t},c.rotate=function(t,r,e,n){return a.rotate(t._array,r._array,e,n._array),t._dirty=!0,t},c.rotateX=function(t,r,e){return a.rotateX(t._array,r._array,e),t._dirty=!0,t},c.rotateY=function(t,r,e){return a.rotateY(t._array,r._array,e),t._dirty=!0,t},c.rotateZ=function(t,r,e){return a.rotateZ(t._array,r._array,e),t._dirty=!0,t},c.scale=function(t,r,e){return a.scale(t._array,r._array,e._array),t._dirty=!0,t},c.transpose=function(t,r){return a.transpose(t._array,r._array),t._dirty=!0,t},c.translate=function(t,r,e){return a.translate(t._array,r._array,e._array),t._dirty=!0,t},t.exports=c},function(t,r){"use strict";var e=!0;try{var n=document.createElement("canvas"),i=n.getContext("webgl")||n.getContext("experimental-webgl");if(!i)throw new Error}catch(t){e=!1}var a={};a.supportWebGL=function(){return e},a.Int8Array="undefined"==typeof Int8Array?Array:Int8Array,a.Uint8Array="undefined"==typeof Uint8Array?Array:Uint8Array,a.Uint16Array="undefined"==typeof Uint16Array?Array:Uint16Array,a.Uint32Array="undefined"==typeof Uint32Array?Array:Uint32Array,a.Int16Array="undefined"==typeof Int16Array?Array:Int16Array,a.Float32Array="undefined"==typeof Float32Array?Array:Float32Array,a.Float64Array="undefined"==typeof Float64Array?Array:Float64Array,t.exports=a},function(t,r,e){"use strict";var n=e(11),i=n.extend(function(){return{color:[1,1,1],intensity:1,castShadow:!0,shadowResolution:512,group:0}},{type:"",clone:function(){var t=n.prototype.clone.call(this);return t.color=Array.prototype.slice.call(this.color),t.intensity=this.intensity,t.castShadow=this.castShadow,t.shadowResolution=this.shadowResolution,t}});t.exports=i},function(t,r,e){"use strict";var n=e(6),i=e(3),a=e(20),o=e(8),s=e(1),u=e(4),c=s.mat4,h=0,f=n.extend({name:"",position:null,rotation:null,scale:null,worldTransform:null,localTransform:null,autoUpdateLocalTransform:!0,_parent:null,_scene:null,_needsUpdateWorldTransform:!0,_inIterating:!1,__depth:0},function(){this.name||(this.name=(this.type||"NODE")+"_"+h++),this.position||(this.position=new i),this.rotation||(this.rotation=new a),this.scale||(this.scale=new i(1,1,1)),this.worldTransform=new o,this.localTransform=new o,this._children=[]},{invisible:!1,isRenderable:function(){return!1},setName:function(t){var r=this._scene;if(r){var e=r._nodeRepository;delete e[this.name],e[t]=this}this.name=t},add:function(t){this._inIterating&&console.warn("Add operation can cause unpredictable error when in iterating");var r=t._parent;if(r!==this){r&&r.remove(t),t._parent=this,this._children.push(t);var e=this._scene;e&&e!==t.scene&&t.traverse(this._addSelfToScene,this),t._needsUpdateWorldTransform=!0}},remove:function(t){this._inIterating&&console.warn("Remove operation can cause unpredictable error when in iterating");var r=this._children,e=r.indexOf(t);e<0||(r.splice(e,1),t._parent=null,this._scene&&t.traverse(this._removeSelfFromScene,this))},removeAll:function(){for(var t=this._children,r=0;r<t.length;r++)t[r]._parent=null,this._scene&&t[r].traverse(this._removeSelfFromScene,this);this._children=[]},getScene:function(){return this._scene},getParent:function(){return this._parent},_removeSelfFromScene:function(t){t._scene.removeFromScene(t),t._scene=null},_addSelfToScene:function(t){this._scene.addToScene(t),t._scene=this._scene},isAncestor:function(t){for(var r=t._parent;r;){if(r===this)return!0;r=r._parent}return!1},children:function(){return this._children.slice()},childAt:function(t){return this._children[t]},getChildByName:function(t){for(var r=this._children,e=0;e<r.length;e++)if(r[e].name===t)return r[e]},getDescendantByName:function(t){for(var r=this._children,e=0;e<r.length;e++){var n=r[e];if(n.name===t)return n;var i=n.getDescendantByName(t);if(i)return i}},queryNode:function(t){if(t){for(var r=t.split("/"),e=this,n=0;n<r.length;n++){var i=r[n];if(i){for(var a=!1,o=e._children,s=0;s<o.length;s++){var u=o[s];if(u.name===i){e=u,a=!0;break}}if(!a)return}}return e}},getPath:function(t){if(!this._parent)return"/";for(var r=this._parent,e=this.name;r._parent&&(e=r.name+"/"+e,r._parent!=t);)r=r._parent;return!r._parent&&t?null:e},traverse:function(t,r,e){this._inIterating=!0,null!=e&&this.constructor!==e||t.call(r,this);for(var n=this._children,i=0,a=n.length;i<a;i++)n[i].traverse(t,r,e);this._inIterating=!1},eachChild:function(t,r,e){this._inIterating=!0;for(var n=this._children,i=null==e,a=0,o=n.length;a<o;a++){var s=n[a];(i||s.constructor===e)&&t.call(r,s,a)}this._inIterating=!1},setLocalTransform:function(t){c.copy(this.localTransform._array,t._array),this.decomposeLocalTransform()},decomposeLocalTransform:function(t){var r=t?null:this.scale;this.localTransform.decomposeMatrix(r,this.rotation,this.position)},setWorldTransform:function(t){c.copy(this.worldTransform._array,t._array),this.decomposeWorldTransform()},decomposeWorldTransform:function(){var t=c.create();return function(r){var e=this.localTransform,n=this.worldTransform;this._parent?(c.invert(t,this._parent.worldTransform._array),c.multiply(e._array,t,n._array)):c.copy(e._array,n._array);var i=r?null:this.scale;e.decomposeMatrix(i,this.rotation,this.position)}}(),transformNeedsUpdate:function(){return this.position._dirty||this.rotation._dirty||this.scale._dirty},updateLocalTransform:function(){var t=this.position,r=this.rotation,e=this.scale;if(this.transformNeedsUpdate()){var n=this.localTransform._array;c.fromRotationTranslation(n,r._array,t._array),c.scale(n,n,e._array),r._dirty=!1,e._dirty=!1,t._dirty=!1,this._needsUpdateWorldTransform=!0}},updateWorldTransform:function(){var t=this.localTransform._array,r=this.worldTransform._array;this._parent?c.multiplyAffine(r,this._parent.worldTransform._array,t):c.copy(r,t)},update:function(t){this.autoUpdateLocalTransform?this.updateLocalTransform():t=!0,(t||this._needsUpdateWorldTransform)&&(this.updateWorldTransform(),t=!0,this._needsUpdateWorldTransform=!1);for(var r=this._children,e=0,n=r.length;e<n;e++)r[e].update(t)},getBoundingBox:function(){function t(t){
return!t.invisible}return function(r,e){e=e||new u,r=r||t;var n=this._children;0===n.length&&(e.max.set(-(1/0),-(1/0),-(1/0)),e.min.set(1/0,1/0,1/0));for(var i=new u,a=0;a<n.length;a++){var o=n[a];r(o)&&(o.getBoundingBox(r,i),o.updateLocalTransform(),i.isFinite()&&i.applyTransform(o.localTransform),0===a?e.copy(i):e.union(i))}return e}}(),getWorldPosition:function(t){if(this.transformNeedsUpdate()){for(var r=this;r&&r.getParent()&&r.getParent().transformNeedsUpdate();)r=r.getParent();r.update()}var e=this.worldTransform._array;if(t){var n=t._array;return n[0]=e[12],n[1]=e[13],n[2]=e[14],t}return new i(e[12],e[13],e[14])},clone:function(){var t=new this.constructor,r=this._children;t.setName(this.name),t.position.copy(this.position),t.rotation.copy(this.rotation),t.scale.copy(this.scale);for(var e=0;e<r.length;e++)t.add(r[e].clone());return t},rotateAround:function(){var t=new i,r=new o;return function(e,n,i){t.copy(this.position).subtract(e);var a=this.localTransform;a.identity(),a.translate(e),a.rotate(i,n),r.fromRotationTranslation(this.rotation,t),a.multiply(r),a.scale(this.scale),this.decomposeLocalTransform(),this._needsUpdateWorldTransform=!0}}(),lookAt:function(){var t=new o;return function(r,e){t.lookAt(this.position,r,e||this.localTransform.y).invert(),this.setLocalTransform(t)}}()});t.exports=f},function(t,r){"use strict";var e=["OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","OES_standard_derivatives","OES_vertex_array_object","OES_element_index_uint","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","EXT_texture_filter_anisotropic","EXT_shader_texture_lod","WEBGL_draw_buffers","EXT_frag_depth"],n=["MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE"],i={},a={},o={initialize:function(t){var r=t.__GLID__;if(!i[r]){i[r]={},a[r]={};for(var o=0;o<e.length;o++){var s=e[o];this._createExtension(t,s)}for(var o=0;o<n.length;o++){var u=n[o];a[r][u]=t.getParameter(t[u])}}},getExtension:function(t,r){var e=t.__GLID__;if(i[e])return"undefined"==typeof i[e][r]&&this._createExtension(t,r),i[e][r]},getParameter:function(t,r){var e=t.__GLID__;if(a[e])return a[e][r]},dispose:function(t){delete i[t.__GLID__],delete a[t.__GLID__]},_createExtension:function(t,r){var e=t.getExtension(r);e||(e=t.getExtension("MOZ_"+r)),e||(e=t.getExtension("WEBKIT_"+r)),i[t.__GLID__][r]=e}};t.exports=o},function(t,r){function e(t){if(null==t||"object"!=typeof t)return t;var r=t,n=C.call(t);if("[object Array]"===n){r=[];for(var i=0,a=t.length;i<a;i++)r[i]=e(t[i])}else if(L[n])r=t.constructor.from(t);else if(!O[n]&&!R(t)){r={};for(var o in t)t.hasOwnProperty(o)&&(r[o]=e(t[o]))}return r}function n(t,r,i){if(!b(r)||!b(t))return i?e(r):t;for(var a in r)if(r.hasOwnProperty(a)){var o=t[a],s=r[a];!b(s)||!b(o)||E(s)||E(o)||R(s)||R(o)||x(s)||x(o)?!i&&a in t||(t[a]=e(r[a],!0)):n(o,s,i)}return t}function i(t,r){for(var e=t[0],i=1,a=t.length;i<a;i++)e=n(e,t[i],r);return e}function a(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);return t}function o(t,r,e){for(var n in r)r.hasOwnProperty(n)&&(e?null!=r[n]:null==t[n])&&(t[n]=r[n]);return t}function s(){return document.createElement("canvas")}function u(){return w||(w=V.createCanvas().getContext("2d")),w}function c(t,r){if(t){if(t.indexOf)return t.indexOf(r);for(var e=0,n=t.length;e<n;e++)if(t[e]===r)return e}return-1}function h(t,r){function e(){}var n=t.prototype;e.prototype=r.prototype,t.prototype=new e;for(var i in n)t.prototype[i]=n[i];t.prototype.constructor=t,t.superClass=r}function f(t,r,e){t="prototype"in t?t.prototype:t,r="prototype"in r?r.prototype:r,o(t,r,e)}function l(t){if(t)return"string"!=typeof t&&"number"==typeof t.length}function _(t,r,e){if(t&&r)if(t.forEach&&t.forEach===D)t.forEach(r,e);else if(t.length===+t.length)for(var n=0,i=t.length;n<i;n++)r.call(e,t[n],n,t);else for(var a in t)t.hasOwnProperty(a)&&r.call(e,t[a],a,t)}function d(t,r,e){if(t&&r){if(t.map&&t.map===B)return t.map(r,e);for(var n=[],i=0,a=t.length;i<a;i++)n.push(r.call(e,t[i],i,t));return n}}function y(t,r,e,n){if(t&&r){if(t.reduce&&t.reduce===k)return t.reduce(r,e,n);for(var i=0,a=t.length;i<a;i++)e=r.call(n,e,t[i],i,t);return e}}function m(t,r,e){if(t&&r){if(t.filter&&t.filter===U)return t.filter(r,e);for(var n=[],i=0,a=t.length;i<a;i++)r.call(e,t[i],i,t)&&n.push(t[i]);return n}}function v(t,r,e){if(t&&r)for(var n=0,i=t.length;n<i;n++)if(r.call(e,t[n],n,t))return t[n]}function p(t,r){var e=F.call(arguments,2);return function(){return t.apply(r,e.concat(F.call(arguments)))}}function g(t){var r=F.call(arguments,1);return function(){return t.apply(this,r.concat(F.call(arguments)))}}function E(t){return"[object Array]"===C.call(t)}function T(t){return"function"==typeof t}function A(t){return"[object String]"===C.call(t)}function b(t){var r=typeof t;return"function"===r||!!t&&"object"==r}function x(t){return!!O[C.call(t)]}function R(t){return"object"==typeof t&&"number"==typeof t.nodeType&&"object"==typeof t.ownerDocument}function I(t){return t!==t}function S(t){for(var r=0,e=arguments.length;r<e;r++)if(null!=arguments[r])return arguments[r]}function N(){return Function.call.apply(F,arguments)}function M(t,r){if(!t)throw new Error(r)}var w,O={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1,"[object CanvasPattern]":1,"[object Image]":1,"[object Canvas]":1},L={"[object Int8Array]":1,"[object Uint8Array]":1,"[object Uint8ClampedArray]":1,"[object Int16Array]":1,"[object Uint16Array]":1,"[object Int32Array]":1,"[object Uint32Array]":1,"[object Float32Array]":1,"[object Float64Array]":1},C=Object.prototype.toString,P=Array.prototype,D=P.forEach,U=P.filter,F=P.slice,B=P.map,k=P.reduce,V={inherits:h,mixin:f,clone:e,merge:n,mergeAll:i,extend:a,defaults:o,getContext:u,createCanvas:s,indexOf:c,slice:N,find:v,isArrayLike:l,each:_,map:d,reduce:y,filter:m,bind:p,curry:g,isArray:E,isString:A,isObject:b,isFunction:T,isBuiltInObject:x,isDom:R,eqNaN:I,retrieve:S,assert:M,noop:function(){}};t.exports=V},function(t,r,e){"use strict";var n=e(1),i=n.vec2,a=function(t,r){t=t||0,r=r||0,this._array=i.fromValues(t,r),this._dirty=!0};if(a.prototype={constructor:a,add:function(t){return i.add(this._array,this._array,t._array),this._dirty=!0,this},set:function(t,r){return this._array[0]=t,this._array[1]=r,this._dirty=!0,this},setArray:function(t){return this._array[0]=t[0],this._array[1]=t[1],this._dirty=!0,this},clone:function(){return new a(this.x,this.y)},copy:function(t){return i.copy(this._array,t._array),this._dirty=!0,this},cross:function(t,r){return i.cross(t._array,this._array,r._array),t._dirty=!0,this},dist:function(t){return i.dist(this._array,t._array)},distance:function(t){return i.distance(this._array,t._array)},div:function(t){return i.div(this._array,this._array,t._array),this._dirty=!0,this},divide:function(t){return i.divide(this._array,this._array,t._array),this._dirty=!0,this},dot:function(t){return i.dot(this._array,t._array)},len:function(){return i.len(this._array)},length:function(){return i.length(this._array)},lerp:function(t,r,e){return i.lerp(this._array,t._array,r._array,e),this._dirty=!0,this},min:function(t){return i.min(this._array,this._array,t._array),this._dirty=!0,this},max:function(t){return i.max(this._array,this._array,t._array),this._dirty=!0,this},mul:function(t){return i.mul(this._array,this._array,t._array),this._dirty=!0,this},multiply:function(t){return i.multiply(this._array,this._array,t._array),this._dirty=!0,this},negate:function(){return i.negate(this._array,this._array),this._dirty=!0,this},normalize:function(){return i.normalize(this._array,this._array),this._dirty=!0,this},random:function(t){return i.random(this._array,t),this._dirty=!0,this},scale:function(t){return i.scale(this._array,this._array,t),this._dirty=!0,this},scaleAndAdd:function(t,r){return i.scaleAndAdd(this._array,this._array,t._array,r),this._dirty=!0,this},sqrDist:function(t){return i.sqrDist(this._array,t._array)},squaredDistance:function(t){return i.squaredDistance(this._array,t._array)},sqrLen:function(){return i.sqrLen(this._array)},squaredLength:function(){return i.squaredLength(this._array)},sub:function(t){return i.sub(this._array,this._array,t._array),this._dirty=!0,this},subtract:function(t){return i.subtract(this._array,this._array,t._array),this._dirty=!0,this},transformMat2:function(t){return i.transformMat2(this._array,this._array,t._array),this._dirty=!0,this},transformMat2d:function(t){return i.transformMat2d(this._array,this._array,t._array),this._dirty=!0,this},transformMat3:function(t){return i.transformMat3(this._array,this._array,t._array),this._dirty=!0,this},transformMat4:function(t){return i.transformMat4(this._array,this._array,t._array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this._array)}},Object.defineProperty){var o=a.prototype;Object.defineProperty(o,"x",{get:function(){return this._array[0]},set:function(t){this._array[0]=t,this._dirty=!0}}),Object.defineProperty(o,"y",{get:function(){return this._array[1]},set:function(t){this._array[1]=t,this._dirty=!0}})}a.add=function(t,r,e){return i.add(t._array,r._array,e._array),t._dirty=!0,t},a.set=function(t,r,e){return i.set(t._array,r,e),t._dirty=!0,t},a.copy=function(t,r){return i.copy(t._array,r._array),t._dirty=!0,t},a.cross=function(t,r,e){return i.cross(t._array,r._array,e._array),t._dirty=!0,t},a.dist=function(t,r){return i.distance(t._array,r._array)},a.distance=a.dist,a.div=function(t,r,e){return i.divide(t._array,r._array,e._array),t._dirty=!0,t},a.divide=a.div,a.dot=function(t,r){return i.dot(t._array,r._array)},a.len=function(t){return i.length(t._array)},a.lerp=function(t,r,e,n){return i.lerp(t._array,r._array,e._array,n),t._dirty=!0,t},a.min=function(t,r,e){return i.min(t._array,r._array,e._array),t._dirty=!0,t},a.max=function(t,r,e){return i.max(t._array,r._array,e._array),t._dirty=!0,t},a.mul=function(t,r,e){return i.multiply(t._array,r._array,e._array),t._dirty=!0,t},a.multiply=a.mul,a.negate=function(t,r){return i.negate(t._array,r._array),t._dirty=!0,t},a.normalize=function(t,r){return i.normalize(t._array,r._array),t._dirty=!0,t},a.random=function(t,r){return i.random(t._array,r),t._dirty=!0,t},a.scale=function(t,r,e){return i.scale(t._array,r._array,e),t._dirty=!0,t},a.scaleAndAdd=function(t,r,e,n){return i.scaleAndAdd(t._array,r._array,e._array,n),t._dirty=!0,t},a.sqrDist=function(t,r){return i.sqrDist(t._array,r._array)},a.squaredDistance=a.sqrDist,a.sqrLen=function(t){return i.sqrLen(t._array)},a.squaredLength=a.sqrLen,a.sub=function(t,r,e){return i.subtract(t._array,r._array,e._array),t._dirty=!0,t},a.subtract=a.sub,a.transformMat2=function(t,r,e){return i.transformMat2(t._array,r._array,e._array),t._dirty=!0,t},a.transformMat2d=function(t,r,e){return i.transformMat2d(t._array,r._array,e._array),t._dirty=!0,t},a.transformMat3=function(t,r,e){return i.transformMat3(t._array,r._array,e._array),t._dirty=!0,t},a.transformMat4=function(t,r,e){return i.transformMat4(t._array,r._array,e._array),t._dirty=!0,t},t.exports=a},function(t,r,e){function n(t){return!t||"none"===t}function i(t){return t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof Image}var a=e(63),o=e(65),s=e(17),u=e(25),c=e(11),h=e(7),f=e(2),l=e(16),_=e(90),d=e(58);f.util.extend(c.prototype,d);var y=l.prototype.addToScene,m=l.prototype.removeFromScene;l.prototype.addToScene=function(t){if(y.call(this,t),this.__zr){var r=this.__zr;t.traverse(function(t){t.__zr=r,t.addAnimatorsToZr&&t.addAnimatorsToZr(r)})}},l.prototype.removeFromScene=function(t){m.call(this,t),t.traverse(function(t){var r=t.__zr;t.__zr=null,r&&t.removeAnimatorsFromZr&&t.removeAnimatorsFromZr(r)})},a.prototype.setTextureImage=function(t,r,e,i){null==e&&(e=i);var a=this.material;if(a&&a.shader){var o=e.getZr();return n(r)?a.shader.disableTexture(t):v.loadTexture(r,e,i,function(r){a.shader.enableTexture(t),a.set(t,r),o&&o.refresh()}),a.get(t)}};var v={};v.Node=c,v.Mesh=a,v.Shader=s,v.Material=u,v.Texture2D=o,v.Geometry=h,v.SphereGeometry=e(71),v.PlaneGeometry=e(28),v.CubeGeometry=e(70),v.AmbientLight=e(72),v.DirectionalLight=e(73),v.PointLight=e(74),v.SpotLight=e(75),v.Vector2=e(14),v.Vector3=e(3),v.Vector4=e(79),v.Quaternion=e(20),v.Matrix2=e(76),v.Matrix2d=e(77),v.Matrix3=e(78),v.Matrix4=e(8),v.Plane=e(30),v.Ray=e(21),v.BoundingBox=e(4),v.Frustum=e(29),v.loadTexture=function(t,r,e,n){"function"==typeof e&&(n=e,e={});for(var a=Object.keys(e).sort(),o="",s=0;s<a.length;s++)o+=a[s]+"_"+e[a[s]]+"_";var u=r.__textureCache=r.__textureCache||new _(20);if(i(t)){var c=t.__textureid__,h=u.get(o+c);if(!h){h={texture:new v.Texture2D({image:t})};for(var s=0;s<a.length;s++)h.texture[a[s]]=e[a[s]];c=t.__textureid__||"__ecgl_image__"+h.texture.__GUID__,t.__textureid__=c,h.put(o+c,h),n&&n(h.texture)}return h.texture}var h=u.get(o+t);if(h)h.callbacks?h.callbacks.push(n):n&&n(h.texture);else{for(var f=new v.Texture2D({image:new Image}),s=0;s<a.length;s++)f[a[s]]=e[a[s]];h={texture:f,callbacks:[n]},f.image.onload=function(){f.dirty(),h.callbacks.forEach(function(t){t&&t(f)}),h.callbacks=null},f.image.src=t,u.put(o+t,h)}return h.texture},v.isImage=i,t.exports=v},function(t,r,e){"use strict";function n(t,r){if(r.castShadow&&!t.castShadow)return!0}var i=e(11),a=e(10),o=e(4),s=i.extend(function(){return{material:null,autoUpdate:!0,opaqueQueue:[],transparentQueue:[],lights:[],viewBoundingBoxLastFrame:new o,_lightUniforms:{},_lightNumber:{},_opaqueObjectCount:0,_transparentObjectCount:0,_nodeRepository:{}}},function(){this._scene=this},{addToScene:function(t){t.name&&(this._nodeRepository[t.name]=t)},removeFromScene:function(t){t.name&&delete this._nodeRepository[t.name]},getNode:function(t){return this._nodeRepository[t]},cloneNode:function(t){var r=t.clone(),e={},n=function(i,a){i.skeleton&&(a.skeleton=i.skeleton.clone(t,r),a.joints=i.joints.slice()),i.material&&(e[i.material.__GUID__]={oldMat:i.material});for(var o=0;o<i._children.length;o++)n(i._children[o],a._children[o])};n(t,r);for(var i in e)e[i].newMat=e[i].oldMat.clone();return r.traverse(function(t){t.material&&(t.material=e[t.material.__GUID__].newMat)}),r},update:function(t,r){if(this.autoUpdate||t){i.prototype.update.call(this,t);var e=this.lights,n=this.material&&this.material.transparent;if(this._opaqueObjectCount=0,this._transparentObjectCount=0,e.length=0,this._updateRenderQueue(this,n),this.opaqueQueue.length=this._opaqueObjectCount,this.transparentQueue.length=this._transparentObjectCount,!r){var a=this._lightNumber;for(var o in a)for(var s in a[o])a[o][s]=0;for(var u=0;u<e.length;u++){var c=e[u],o=c.group;a[o]||(a[o]={}),a[o][c.type]=a[o][c.type]||0,a[o][c.type]++}this._updateLightUniforms()}}},_updateRenderQueue:function(t,r){if(!t.invisible)for(var e=0;e<t._children.length;e++){var n=t._children[e];n instanceof a&&this.lights.push(n),n.isRenderable()&&(n.material.transparent||r?this.transparentQueue[this._transparentObjectCount++]=n:this.opaqueQueue[this._opaqueObjectCount++]=n),n._children.length>0&&this._updateRenderQueue(n)}},_updateLightUniforms:function(){var t=this.lights;t.sort(n);var r=this._lightUniforms;for(var e in r)for(var i in r[e])r[e][i].value.length=0;for(var a=0;a<t.length;a++){var o=t[a],e=o.group;for(var i in o.uniformTemplates){var s=o.uniformTemplates[i];r[e]||(r[e]={}),r[e][i]||(r[e][i]={type:"",value:[]});var u=s.value(o),c=r[e][i];switch(c.type=s.type+"v",s.type){case"1i":case"1f":case"t":c.value.push(u);break;case"2f":case"3f":case"4f":for(var h=0;h<u.length;h++)c.value.push(u[h]);break;default:console.error("Unkown light uniform type "+s.type)}}}},isShaderLightNumberChanged:function(t){var r=t.lightGroup;for(var e in this._lightNumber[r])if(this._lightNumber[r][e]!==t.lightNumber[e])return!0;for(var e in t.lightNumber)if(this._lightNumber[r][e]!==t.lightNumber[e])return!0;return!1},setShaderLightNumber:function(t){var r=t.lightGroup;for(var e in this._lightNumber[r])t.lightNumber[e]=this._lightNumber[r][e];t.dirty()},setLightUniforms:function(t,r){var e=t.lightGroup;for(var n in this._lightUniforms[e]){var i=this._lightUniforms[e][n];if("tv"===i.type)for(var a=0;a<i.value.length;a++){var o=i.value[a],s=t.currentTextureSlot(),u=t.setUniform(r,"1i",n,s);u&&t.useCurrentTextureSlot(r,o)}else t.setUniform(r,i.type,n,i.value)}},dispose:function(){this.material=null,this.opaqueQueue=[],this.transparentQueue=[],this.lights=[],this._lightUniforms={},this._lightNumber={},this._nodeRepository={}}});t.exports=s},function(t,r,e){"use strict";function n(){return{locations:{},attriblocations:{}}}function i(t,r,e){if(!t.getShaderParameter(r,t.COMPILE_STATUS))return[t.getShaderInfoLog(r),a(e)].join("\n")}function a(t){for(var r=t.split("\n"),e=0,n=r.length;e<n;e++)r[e]=e+1+": "+r[e];return r.join("\n")}var o=e(6),s=e(19),u=e(18),c=e(9),h=e(1),f=e(12),l=h.mat2,_=h.mat3,d=h.mat4,y=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\w\,]+)?(\[.*?\])?\s*(:\s*([\S\s]+?))?;/g,m=/attribute\s+(float|int|vec2|vec3|vec4)\s+(\w*)\s*(:\s*(\w+))?;/g,v=/#define\s+(\w+)?(\s+[\w-.]+)?\s*;?\s*\n/g,p=/for\s*?\(int\s*?_idx_\s*\=\s*([\w-]+)\;\s*_idx_\s*<\s*([\w-]+);\s*_idx_\s*\+\+\s*\)\s*\{\{([\s\S]+?)(?=\}\})\}\}/g,g={bool:"1i",int:"1i",sampler2D:"t",samplerCube:"t",float:"1f",vec2:"2f",vec3:"3f",vec4:"4f",ivec2:"2i",ivec3:"3i",ivec4:"4i",mat2:"m2",mat3:"m3",mat4:"m4"},E={bool:function(){return!0},int:function(){return 0},float:function(){return 0},sampler2D:function(){return null},samplerCube:function(){return null},vec2:function(){return[0,0]},vec3:function(){return[0,0,0]},vec4:function(){return[0,0,0,0]},ivec2:function(){return[0,0]},ivec3:function(){return[0,0,0]},ivec4:function(){return[0,0,0,0]},mat2:function(){return l.create()},mat3:function(){return _.create()},mat4:function(){return d.create()},array:function(){return[]}},T=["POSITION","NORMAL","BINORMAL","TANGENT","TEXCOORD","TEXCOORD_0","TEXCOORD_1","COLOR","JOINT","WEIGHT"],A=["SKIN_MATRIX","VIEWPORT_SIZE","VIEWPORT","WINDOW_SIZE"],b=["WORLD","VIEW","PROJECTION","WORLDVIEW","VIEWPROJECTION","WORLDVIEWPROJECTION","WORLDINVERSE","VIEWINVERSE","PROJECTIONINVERSE","WORLDVIEWINVERSE","VIEWPROJECTIONINVERSE","WORLDVIEWPROJECTIONINVERSE","WORLDTRANSPOSE","VIEWTRANSPOSE","PROJECTIONTRANSPOSE","WORLDVIEWTRANSPOSE","VIEWPROJECTIONTRANSPOSE","WORLDVIEWPROJECTIONTRANSPOSE","WORLDINVERSETRANSPOSE","VIEWINVERSETRANSPOSE","PROJECTIONINVERSETRANSPOSE","WORLDVIEWINVERSETRANSPOSE","VIEWPROJECTIONINVERSETRANSPOSE","WORLDVIEWPROJECTIONINVERSETRANSPOSE"],x={},R=1,I=2,S=3,N=o.extend(function(){return{vertex:"",fragment:"",precision:"highp",attribSemantics:{},matrixSemantics:{},uniformSemantics:{},matrixSemanticKeys:[],uniformTemplates:{},attributeTemplates:{},vertexDefines:{},fragmentDefines:{},extensions:["OES_standard_derivatives","EXT_shader_texture_lod"],lightGroup:0,lightNumber:{},_textureSlot:0,_attacheMaterialNumber:0,_uniformList:[],_textureStatus:{},_vertexProcessed:"",_fragmentProcessed:"",_currentLocationsMap:{}}},function(){this._cache=new u,this._updateShaderString()},{setVertex:function(t){this.vertex=t,this._updateShaderString(),this.dirty()},setFragment:function(t){this.fragment=t,this._updateShaderString(),this.dirty()},bind:function(t){var r=this._cache;if(r.use(t.__GLID__,n),this._currentLocationsMap=r.get("locations"),this._textureSlot=0,r.isDirty()){for(var e=[],i=this.extensions,a=0;a<i.length;a++)f.getExtension(t,i[a])&&e.push(i[a]);this._updateShaderString(e);var o=this._buildProgram(t,this._vertexProcessed,this._fragmentProcessed);if(r.fresh(),o)return o}t.useProgram(r.get("program"))},dirty:function(){var t=this._cache;t.dirtyAll();for(var r=0;r<t._caches.length;r++)if(t._caches[r]){var e=t._caches[r];e.locations={},e.attriblocations={}}},_updateShaderString:function(t){this.vertex===this._vertexPrev&&this.fragment===this._fragmentPrev||(this._parseImport(),this.attribSemantics={},this.matrixSemantics={},this._textureStatus={},this._parseUniforms(),this._parseAttributes(),this._parseDefines(),this._vertexPrev=this.vertex,this._fragmentPrev=this.fragment),this._addDefineExtensionAndPrecision(t),this._vertexProcessed=this._unrollLoop(this._vertexProcessed,this.vertexDefines),this._fragmentProcessed=this._unrollLoop(this._fragmentProcessed,this.fragmentDefines)},define:function(t,r,e){var n=this.vertexDefines,i=this.fragmentDefines;e=null!=e?e:null,"vertex"!==t&&"fragment"!==t&&"both"!==t&&arguments.legnth<3&&(e=r,r=t,t="both"),"vertex"!==t&&"both"!==t||n[r]!==e&&(n[r]=e,this.dirty()),"fragment"!==t&&"both"!==t||i[r]!==e&&(i[r]=e,"both"!==t&&this.dirty())},unDefine:function(t,r){"vertex"!==t&&"fragment"!==t&&"both"!==t&&arguments.legnth<2&&(r=t,t="both"),"vertex"!==t&&"both"!==t||this.isDefined("vertex",r)&&(delete this.vertexDefines[r],this.dirty()),"fragment"!==t&&"both"!==t||this.isDefined("fragment",r)&&(delete this.fragmentDefines[r],"both"!==t&&this.dirty())},isDefined:function(t,r){switch(t){case"vertex":return void 0!==this.vertexDefines[r];case"fragment":return void 0!==this.fragmentDefines[r]}},getDefine:function(t,r){switch(t){case"vertex":return this.vertexDefines[r];case"fragment":return this.fragmentDefines[r]}},enableTexture:function(t){if(t instanceof Array)for(var r=0;r<t.length;r++)this.enableTexture(t[r]);else{var e=this._textureStatus[t];if(e){var n=e.enabled;n||(e.enabled=!0,this.dirty())}}},enableTexturesAll:function(){var t=this._textureStatus;for(var r in t)t[r].enabled=!0;this.dirty()},disableTexture:function(t){if(t instanceof Array)for(var r=0;r<t.length;r++)this.disableTexture(t[r]);else{var e=this._textureStatus[t];if(e){var n=!e.enabled;n||(e.enabled=!1,this.dirty())}}},disableTexturesAll:function(){var t=this._textureStatus;for(var r in t)t[r].enabled=!1;this.dirty()},isTextureEnabled:function(t){var r=this._textureStatus;return r[t]&&r[t].enabled},getEnabledTextures:function(){var t=[],r=this._textureStatus;for(var e in r)r[e].enabled&&t.push(e);return t},hasUniform:function(t){var r=this._currentLocationsMap[t];return null!==r&&void 0!==r},currentTextureSlot:function(){return this._textureSlot},resetTextureSlot:function(t){this._textureSlot=t||0},useCurrentTextureSlot:function(t,r){var e=this._textureSlot;return this.useTextureSlot(t,r,e),this._textureSlot++,e},useTextureSlot:function(t,r,e){r&&(t.activeTexture(t.TEXTURE0+e),r.isRenderable()?r.bind(t):r.unbind(t))},setUniform:function(t,r,e,n){var i=this._currentLocationsMap,a=i[e];if(null===a||void 0===a)return!1;switch(r){case"m4":t.uniformMatrix4fv(a,!1,n);break;case"2i":t.uniform2i(a,n[0],n[1]);break;case"2f":t.uniform2f(a,n[0],n[1]);break;case"3i":t.uniform3i(a,n[0],n[1],n[2]);break;case"3f":t.uniform3f(a,n[0],n[1],n[2]);break;case"4i":t.uniform4i(a,n[0],n[1],n[2],n[3]);break;case"4f":t.uniform4f(a,n[0],n[1],n[2],n[3]);break;case"1i":t.uniform1i(a,n);break;case"1f":t.uniform1f(a,n);break;case"1fv":t.uniform1fv(a,n);break;case"1iv":t.uniform1iv(a,n);break;case"2iv":t.uniform2iv(a,n);break;case"2fv":t.uniform2fv(a,n);break;case"3iv":t.uniform3iv(a,n);break;case"3fv":t.uniform3fv(a,n);break;case"4iv":t.uniform4iv(a,n);break;case"4fv":t.uniform4fv(a,n);break;case"m2":case"m2v":t.uniformMatrix2fv(a,!1,n);break;case"m3":case"m3v":t.uniformMatrix3fv(a,!1,n);break;case"m4v":if(n instanceof Array){for(var o=new c.Float32Array(16*n.length),s=0,u=0;u<n.length;u++)for(var h=n[u],f=0;f<16;f++)o[s++]=h[f];t.uniformMatrix4fv(a,!1,o)}else n instanceof c.Float32Array&&t.uniformMatrix4fv(a,!1,n)}return!0},setUniformOfSemantic:function(t,r,e){var n=this.uniformSemantics[r];return!!n&&this.setUniform(t,n.type,n.symbol,e)},enableAttributes:function(t,r,e){var n,i=this._cache.get("program"),a=this._cache.get("attriblocations");n=e?e.__enabledAttributeList:x[t.__GLID__],n||(n=e?e.__enabledAttributeList=[]:x[t.__GLID__]=[]);for(var o=[],s=0;s<r.length;s++){var u=r[s];if(this.attributeTemplates[u]){var c=a[u];if(void 0===c){if(c=t.getAttribLocation(i,u),c===-1){o[s]=-1;continue}a[u]=c}o[s]=c,n[c]?n[c]=I:n[c]=R}else o[s]=-1}for(var s=0;s<n.length;s++)switch(n[s]){case R:t.enableVertexAttribArray(s),n[s]=S;break;case I:n[s]=S;break;case S:t.disableVertexAttribArray(s),n[s]=0}return o},_parseImport:function(){this._vertexProcessedWithoutDefine=N.parseImport(this.vertex),this._fragmentProcessedWithoutDefine=N.parseImport(this.fragment)},_addDefineExtensionAndPrecision:function(t){t=t||this.extensions;for(var r=[],e=0;e<t.length;e++)r.push("#extension GL_"+t[e]+" : enable");var n=this._getDefineStr(this.vertexDefines);this._vertexProcessed=n+"\n"+this._vertexProcessedWithoutDefine;var n=this._getDefineStr(this.fragmentDefines),i=n+"\n"+this._fragmentProcessedWithoutDefine;this._fragmentProcessed=r.join("\n")+"\n"+["precision",this.precision,"float"].join(" ")+";\n"+["precision",this.precision,"int"].join(" ")+";\n"+["precision",this.precision,"sampler2D"].join(" ")+";\n"+i},_getDefineStr:function(t){var r=this.lightNumber,e=this._textureStatus,n=[];for(var i in r){var a=r[i];a>0&&n.push("#define "+i.toUpperCase()+"_COUNT "+a)}for(var o in e){var s=e[o];s.enabled&&n.push("#define "+o.toUpperCase()+"_ENABLED")}for(var o in t){var u=t[o];null===u?n.push("#define "+o):n.push("#define "+o+" "+u.toString())}return n.join("\n")},_unrollLoop:function(t,r){function e(t,e,i,a){var o="";isNaN(e)&&(e=e in r?r[e]:n[e]),isNaN(i)&&(i=i in r?r[i]:n[i]);for(var s=parseInt(e);s<parseInt(i);s++)o+="{"+a.replace(/float\s*\(\s*_idx_\s*\)/g,s.toFixed(1)).replace(/_idx_/g,s)+"\n}";return o}var n={};for(var i in this.lightNumber)n[i+"_COUNT"]=this.lightNumber[i];return t.replace(p,e)},_parseUniforms:function(){function t(t,i,a,o,s,u){if(i&&a){var c,h=g[i],f=!0;if(h){if(e._uniformList.push(a),"sampler2D"!==i&&"samplerCube"!==i||(e._textureStatus[a]={enabled:!1,shaderType:n}),o&&(h+="v"),u)if(T.indexOf(u)>=0)e.attribSemantics[u]={symbol:a,type:h},f=!1;else if(b.indexOf(u)>=0){var l=!1,_=u;u.match(/TRANSPOSE$/)&&(l=!0,_=u.slice(0,-9)),e.matrixSemantics[u]={symbol:a,type:h,isTranspose:l,semanticNoTranspose:_},f=!1}else if(A.indexOf(u)>=0)e.uniformSemantics[u]={symbol:a,type:h},f=!1;else if("unconfigurable"===u)f=!1;else{if(c=e._parseDefaultValue(i,u),!c)throw new Error('Unkown semantic "'+u+'"');u=""}f&&(r[a]={type:h,value:o?E.array:c||E[i],semantic:u||null})}return["uniform",i,a,o].join(" ")+";\n"}}var r={},e=this,n="vertex";this._uniformList=[],this._vertexProcessedWithoutDefine=this._vertexProcessedWithoutDefine.replace(y,t),n="fragment",this._fragmentProcessedWithoutDefine=this._fragmentProcessedWithoutDefine.replace(y,t),e.matrixSemanticKeys=Object.keys(this.matrixSemantics),this.uniformTemplates=r},_parseDefaultValue:function(t,r){var e=/\[\s*(.*)\s*\]/;{if("vec2"!==t&&"vec3"!==t&&"vec4"!==t)return"bool"===t?function(){return"true"===r.toLowerCase()}:"float"===t?function(){return parseFloat(r)}:"int"===t?function(){return parseInt(r)}:void 0;var n=e.exec(r)[1];if(n){var i=n.split(/\s*,\s*/);return function(){return new c.Float32Array(i)}}}},createUniforms:function(){var t={};for(var r in this.uniformTemplates){var e=this.uniformTemplates[r];t[r]={type:e.type,value:e.value()}}return t},attached:function(){this._attacheMaterialNumber++},detached:function(){this._attacheMaterialNumber--},isAttachedToAny:function(){return 0!==this._attacheMaterialNumber},_parseAttributes:function(){function t(t,n,i,a,o){if(n&&i){var s=1;switch(n){case"vec4":s=4;break;case"vec3":s=3;break;case"vec2":s=2;break;case"float":s=1}if(r[i]={type:"float",size:s,semantic:o||null},o){if(T.indexOf(o)<0)throw new Error('Unkown semantic "'+o+'"');e.attribSemantics[o]={symbol:i,type:n}}}return["attribute",n,i].join(" ")+";\n"}var r={},e=this;this._vertexProcessedWithoutDefine=this._vertexProcessedWithoutDefine.replace(m,t),this.attributeTemplates=r},_parseDefines:function(){function t(t,n,i){var a="vertex"===e?r.vertexDefines:r.fragmentDefines;return a[n]||("false"==i?a[n]=!1:"true"==i?a[n]=!0:a[n]=i?parseFloat(i):null),""}var r=this,e="vertex";this._vertexProcessedWithoutDefine=this._vertexProcessedWithoutDefine.replace(v,t),e="fragment",this._fragmentProcessedWithoutDefine=this._fragmentProcessedWithoutDefine.replace(v,t)},_buildProgram:function(t,r,e){var n=this._cache;n.get("program")&&t.deleteProgram(n.get("program"));var a=t.createProgram(),o=t.createShader(t.VERTEX_SHADER);t.shaderSource(o,r),t.compileShader(o);var s=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(s,e),t.compileShader(s);var u=i(t,o,r);if(u)return u;if(u=i(t,s,e))return u;if(t.attachShader(a,o),t.attachShader(a,s),this.attribSemantics.POSITION)t.bindAttribLocation(a,0,this.attribSemantics.POSITION.symbol);else{var c=Object.keys(this.attributeTemplates);t.bindAttribLocation(a,0,c[0])}if(t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))return"Could not link program\nVALIDATE_STATUS: "+t.getProgramParameter(a,t.VALIDATE_STATUS)+", gl error ["+t.getError()+"]";for(var h=0;h<this._uniformList.length;h++){var f=this._uniformList[h],l=n.get("locations");l[f]=t.getUniformLocation(a,f)}t.deleteShader(o),t.deleteShader(s),n.put("program",a)},clone:function(){var t=new N({vertex:this.vertex,fragment:this.fragment,vertexDefines:s.clone(this.vertexDefines),fragmentDefines:s.clone(this.fragmentDefines)});for(var r in this._textureStatus)t._textureStatus[r]=s.clone(this._textureStatus[r]);return t},dispose:function(t){var r=this._cache;r.use(t.__GLID__);var e=r.get("program");e&&t.deleteProgram(e),r.deleteContext(t.__GLID__),this._locations={}}}),M=/(@import)\s*([0-9a-zA-Z_\-\.]*)/g;N.parseImport=function(t){return t=t.replace(M,function(t,r,e){var t=N.source(e);return t?N.parseImport(t):(console.warn('Shader chunk "'+e+'" not existed in library'),"")})};var w=/(@export)\s*([0-9a-zA-Z_\-\.]*)\s*\n([\s\S]*?)@end/g;N.import=function(t){t.replace(w,function(t,r,e,n){var n=n.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+\x24)/g,"");if(n){for(var i,a=e.split("."),o=N.codes,s=0;s<a.length-1;)i=a[s++],o[i]||(o[i]={}),o=o[i];i=a[s],o[i]=n}return n})},N.codes={},N.source=function(t){for(var r=t.split("."),e=N.codes,n=0;e&&n<r.length;){var i=r[n++];e=e[i]}return"string"!=typeof e?(console.warn('Shader "'+t+'" not existed in library'),""):e},t.exports=N},function(t,r){"use strict";var e="__dirty__",n=function(){this._contextId=0,this._caches=[],this._context={}};n.prototype={use:function(t,r){var e=this._caches;e[t]||(e[t]={},r&&(e[t]=r())),this._contextId=t,this._context=e[t]},put:function(t,r){this._context[t]=r},get:function(t){return this._context[t]},dirty:function(t){t=t||"";var r=e+t;this.put(r,!0)},dirtyAll:function(t){t=t||"";for(var r=e+t,n=this._caches,i=0;i<n.length;i++)n[i]&&(n[i][r]=!0)},fresh:function(t){t=t||"";var r=e+t;this.put(r,!1)},freshAll:function(t){t=t||"";for(var r=e+t,n=this._caches,i=0;i<n.length;i++)n[i]&&(n[i][r]=!1)},isDirty:function(t){t=t||"";var r=e+t,n=this._context;return!n.hasOwnProperty(r)||n[r]===!0},deleteContext:function(t){delete this._caches[t],this._context={}},delete:function(t){delete this._context[t]},clearAll:function(){this._caches={}},getContext:function(){return this._context},eachContext:function(t,r){var e=Object.keys(this._caches);e.forEach(function(e){t&&t.call(r,e)})},miss:function(t){return!this._context.hasOwnProperty(t)}},n.prototype.constructor=n,t.exports=n},function(t,r){"use strict";var e=0,n=Array.prototype,i=n.forEach,a={genGUID:function(){return++e},relative2absolute:function(t,r){if(!r||t.match(/^\//))return t;for(var e=t.split("/"),n=r.split("/"),i=e[0];"."===i||".."===i;)".."===i&&n.pop(),e.shift(),i=e[0];return n.join("/")+"/"+e.join("/")},extend:function(t,r){if(r)for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);return t},defaults:function(t,r){if(r)for(var e in r)void 0===t[e]&&(t[e]=r[e]);return t},extendWithPropList:function(t,r,e){if(r)for(var n=0;n<e.length;n++){var i=e[n];t[i]=r[i]}return t},defaultsWithPropList:function(t,r,e){if(r)for(var n=0;n<e.length;n++){var i=e[n];null==t[i]&&(t[i]=r[i])}return t},each:function(t,r,e){if(t&&r)if(t.forEach&&t.forEach===i)t.forEach(r,e);else if(t.length===+t.length)for(var n=0,a=t.length;n<a;n++)r.call(e,t[n],n,t);else for(var o in t)t.hasOwnProperty(o)&&r.call(e,t[o],o,t);
},isObject:function(t){return t===Object(t)},isArray:function(t){return t instanceof Array},isArrayLike:function(t){return!!t&&t.length===+t.length},clone:function(t){if(a.isObject(t)){if(a.isArray(t))return t.slice();if(a.isArrayLike(t)){for(var r=new t.constructor(t.length),e=0;e<t.length;e++)r[e]=t[e];return r}return a.extend({},t)}return t}};t.exports=a},function(t,r,e){"use strict";var n=e(1),i=n.quat,a=function(t,r,e,n){t=t||0,r=r||0,e=e||0,n=void 0===n?1:n,this._array=i.fromValues(t,r,e,n),this._dirty=!0};a.prototype={constructor:a,add:function(t){return i.add(this._array,this._array,t._array),this._dirty=!0,this},calculateW:function(){return i.calculateW(this._array,this._array),this._dirty=!0,this},set:function(t,r,e,n){return this._array[0]=t,this._array[1]=r,this._array[2]=e,this._array[3]=n,this._dirty=!0,this},setArray:function(t){return this._array[0]=t[0],this._array[1]=t[1],this._array[2]=t[2],this._array[3]=t[3],this._dirty=!0,this},clone:function(){return new a(this.x,this.y,this.z,this.w)},conjugate:function(){return i.conjugate(this._array,this._array),this._dirty=!0,this},copy:function(t){return i.copy(this._array,t._array),this._dirty=!0,this},dot:function(t){return i.dot(this._array,t._array)},fromMat3:function(t){return i.fromMat3(this._array,t._array),this._dirty=!0,this},fromMat4:function(){var t=n.mat3,r=t.create();return function(e){return t.fromMat4(r,e._array),t.transpose(r,r),i.fromMat3(this._array,r),this._dirty=!0,this}}(),identity:function(){return i.identity(this._array),this._dirty=!0,this},invert:function(){return i.invert(this._array,this._array),this._dirty=!0,this},len:function(){return i.len(this._array)},length:function(){return i.length(this._array)},lerp:function(t,r,e){return i.lerp(this._array,t._array,r._array,e),this._dirty=!0,this},mul:function(t){return i.mul(this._array,this._array,t._array),this._dirty=!0,this},mulLeft:function(t){return i.multiply(this._array,t._array,this._array),this._dirty=!0,this},multiply:function(t){return i.multiply(this._array,this._array,t._array),this._dirty=!0,this},multiplyLeft:function(t){return i.multiply(this._array,t._array,this._array),this._dirty=!0,this},normalize:function(){return i.normalize(this._array,this._array),this._dirty=!0,this},rotateX:function(t){return i.rotateX(this._array,this._array,t),this._dirty=!0,this},rotateY:function(t){return i.rotateY(this._array,this._array,t),this._dirty=!0,this},rotateZ:function(t){return i.rotateZ(this._array,this._array,t),this._dirty=!0,this},rotationTo:function(t,r){return i.rotationTo(this._array,t._array,r._array),this._dirty=!0,this},setAxes:function(t,r,e){return i.setAxes(this._array,t._array,r._array,e._array),this._dirty=!0,this},setAxisAngle:function(t,r){return i.setAxisAngle(this._array,t._array,r),this._dirty=!0,this},slerp:function(t,r,e){return i.slerp(this._array,t._array,r._array,e),this._dirty=!0,this},sqrLen:function(){return i.sqrLen(this._array)},squaredLength:function(){return i.squaredLength(this._array)},fromEuler:function(t,r){return a.fromEuler(this,t,r)},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this._array)}};var o=Object.defineProperty;if(o){var s=a.prototype;o(s,"x",{get:function(){return this._array[0]},set:function(t){this._array[0]=t,this._dirty=!0}}),o(s,"y",{get:function(){return this._array[1]},set:function(t){this._array[1]=t,this._dirty=!0}}),o(s,"z",{get:function(){return this._array[2]},set:function(t){this._array[2]=t,this._dirty=!0}}),o(s,"w",{get:function(){return this._array[3]},set:function(t){this._array[3]=t,this._dirty=!0}})}a.add=function(t,r,e){return i.add(t._array,r._array,e._array),t._dirty=!0,t},a.set=function(t,r,e,n,a){i.set(t._array,r,e,n,a),t._dirty=!0},a.copy=function(t,r){return i.copy(t._array,r._array),t._dirty=!0,t},a.calculateW=function(t,r){return i.calculateW(t._array,r._array),t._dirty=!0,t},a.conjugate=function(t,r){return i.conjugate(t._array,r._array),t._dirty=!0,t},a.identity=function(t){return i.identity(t._array),t._dirty=!0,t},a.invert=function(t,r){return i.invert(t._array,r._array),t._dirty=!0,t},a.dot=function(t,r){return i.dot(t._array,r._array)},a.len=function(t){return i.length(t._array)},a.lerp=function(t,r,e,n){return i.lerp(t._array,r._array,e._array,n),t._dirty=!0,t},a.slerp=function(t,r,e,n){return i.slerp(t._array,r._array,e._array,n),t._dirty=!0,t},a.mul=function(t,r,e){return i.multiply(t._array,r._array,e._array),t._dirty=!0,t},a.multiply=a.mul,a.rotateX=function(t,r,e){return i.rotateX(t._array,r._array,e),t._dirty=!0,t},a.rotateY=function(t,r,e){return i.rotateY(t._array,r._array,e),t._dirty=!0,t},a.rotateZ=function(t,r,e){return i.rotateZ(t._array,r._array,e),t._dirty=!0,t},a.setAxisAngle=function(t,r,e){return i.setAxisAngle(t._array,r._array,e),t._dirty=!0,t},a.normalize=function(t,r){return i.normalize(t._array,r._array),t._dirty=!0,t},a.sqrLen=function(t){return i.sqrLen(t._array)},a.squaredLength=a.sqrLen,a.fromMat3=function(t,r){return i.fromMat3(t._array,r._array),t._dirty=!0,t},a.setAxes=function(t,r,e,n){return i.setAxes(t._array,r._array,e._array,n._array),t._dirty=!0,t},a.rotationTo=function(t,r,e){return i.rotationTo(t._array,r._array,e._array),t._dirty=!0,t},a.fromEuler=function(t,r,e){t._dirty=!0,r=r._array;var n=t._array,i=Math.cos(r[0]/2),a=Math.cos(r[1]/2),o=Math.cos(r[2]/2),s=Math.sin(r[0]/2),u=Math.sin(r[1]/2),c=Math.sin(r[2]/2),e=(e||"XYZ").toUpperCase();switch(e){case"XYZ":n[0]=s*a*o+i*u*c,n[1]=i*u*o-s*a*c,n[2]=i*a*c+s*u*o,n[3]=i*a*o-s*u*c;break;case"YXZ":n[0]=s*a*o+i*u*c,n[1]=i*u*o-s*a*c,n[2]=i*a*c-s*u*o,n[3]=i*a*o+s*u*c;break;case"ZXY":n[0]=s*a*o-i*u*c,n[1]=i*u*o+s*a*c,n[2]=i*a*c+s*u*o,n[3]=i*a*o-s*u*c;break;case"ZYX":n[0]=s*a*o-i*u*c,n[1]=i*u*o+s*a*c,n[2]=i*a*c-s*u*o,n[3]=i*a*o+s*u*c;break;case"YZX":n[0]=s*a*o+i*u*c,n[1]=i*u*o+s*a*c,n[2]=i*a*c-s*u*o,n[3]=i*a*o-s*u*c;break;case"XZY":n[0]=s*a*o-i*u*c,n[1]=i*u*o-s*a*c,n[2]=i*a*c+s*u*o,n[3]=i*a*o+s*u*c}},t.exports=a},function(t,r,e){"use strict";var n=e(3),i=e(1),a=i.vec3,o=1e-5,s=function(t,r){this.origin=t||new n,this.direction=r||new n};s.prototype={constructor:s,intersectPlane:function(t,r){var e=t.normal._array,i=t.distance,o=this.origin._array,s=this.direction._array,u=a.dot(e,s);if(0===u)return null;r||(r=new n);var c=(a.dot(e,o)-i)/u;return a.scaleAndAdd(r._array,o,s,-c),r._dirty=!0,r},mirrorAgainstPlane:function(t){var r=a.dot(t.normal._array,this.direction._array);a.scaleAndAdd(this.direction._array,this.direction._array,t.normal._array,2*-r),this.direction._dirty=!0},distanceToPoint:function(){var t=a.create();return function(r){a.sub(t,r,this.origin._array);var e=a.dot(t,this.direction._array);if(e<0)return a.distance(this.origin._array,r);var n=a.lenSquared(t);return Math.sqrt(n-e*e)}}(),intersectSphere:function(){var t=a.create();return function(r,e,i){var o=this.origin._array,s=this.direction._array;r=r._array,a.sub(t,r,o);var u=a.dot(t,s),c=a.squaredLength(t),h=c-u*u,f=e*e;if(!(h>f)){var l=Math.sqrt(f-h),_=u-l,d=u+l;return i||(i=new n),_<0?d<0?null:(a.scaleAndAdd(i._array,o,s,d),i):(a.scaleAndAdd(i._array,o,s,_),i)}}}(),intersectBoundingBox:function(t,r){var e,i,o,s,u,c,h=this.direction._array,f=this.origin._array,l=t.min._array,_=t.max._array,d=1/h[0],y=1/h[1],m=1/h[2];if(d>=0?(e=(l[0]-f[0])*d,i=(_[0]-f[0])*d):(i=(l[0]-f[0])*d,e=(_[0]-f[0])*d),y>=0?(o=(l[1]-f[1])*y,s=(_[1]-f[1])*y):(s=(l[1]-f[1])*y,o=(_[1]-f[1])*y),e>s||o>i)return null;if((o>e||e!==e)&&(e=o),(s<i||i!==i)&&(i=s),m>=0?(u=(l[2]-f[2])*m,c=(_[2]-f[2])*m):(c=(l[2]-f[2])*m,u=(_[2]-f[2])*m),e>c||u>i)return null;if((u>e||e!==e)&&(e=u),(c<i||i!==i)&&(i=c),i<0)return null;var v=e>=0?e:i;return r||(r=new n),a.scaleAndAdd(r._array,f,h,v),r},intersectTriangle:function(){var t=a.create(),r=a.create(),e=a.create(),i=a.create();return function(s,u,c,h,f,l){var _=this.direction._array,d=this.origin._array;s=s._array,u=u._array,c=c._array,a.sub(t,u,s),a.sub(r,c,s),a.cross(i,r,_);var y=a.dot(t,i);if(h){if(y>-o)return null}else if(y>-o&&y<o)return null;a.sub(e,d,s);var m=a.dot(i,e)/y;if(m<0||m>1)return null;a.cross(i,t,e);var v=a.dot(_,i)/y;if(v<0||v>1||m+v>1)return null;a.cross(i,t,r);var p=-a.dot(e,i)/y;return p<0?null:(f||(f=new n),l&&n.set(l,1-m-v,m,v),a.scaleAndAdd(f._array,d,_,p),f)}}(),applyTransform:function(t){n.add(this.direction,this.direction,this.origin),n.transformMat4(this.origin,this.origin,t),n.transformMat4(this.direction,this.direction,t),n.sub(this.direction,this.direction,this.origin),n.normalize(this.direction,this.direction)},copy:function(t){n.copy(this.origin,t.origin),n.copy(this.direction,t.direction)},clone:function(){var t=new s;return t.copy(this),t}},t.exports=s},function(t,r){function e(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")}var n={},i=1e-4;n.linearMap=function(t,r,e,n){var i=r[1]-r[0],a=e[1]-e[0];if(0===i)return 0===a?e[0]:(e[0]+e[1])/2;if(n)if(i>0){if(t<=r[0])return e[0];if(t>=r[1])return e[1]}else{if(t>=r[0])return e[0];if(t<=r[1])return e[1]}else{if(t===r[0])return e[0];if(t===r[1])return e[1]}return(t-r[0])/i*a+e[0]},n.parsePercent=function(t,r){switch(t){case"center":case"middle":t="50%";break;case"left":case"top":t="0%";break;case"right":case"bottom":t="100%"}return"string"==typeof t?e(t).match(/%$/)?parseFloat(t)/100*r:parseFloat(t):null==t?NaN:+t},n.round=function(t,r){return null==r&&(r=10),r=Math.min(Math.max(0,r),20),+(+t).toFixed(r)},n.asc=function(t){return t.sort(function(t,r){return t-r}),t},n.getPrecision=function(t){if(t=+t,isNaN(t))return 0;for(var r=1,e=0;Math.round(t*r)/r!==t;)r*=10,e++;return e},n.getPrecisionSafe=function(t){var r=t.toString(),e=r.indexOf(".");return e<0?0:r.length-1-e},n.getPixelPrecision=function(t,r){var e=Math.log,n=Math.LN10,i=Math.floor(e(t[1]-t[0])/n),a=Math.round(e(Math.abs(r[1]-r[0]))/n),o=Math.min(Math.max(-i+a,0),20);return isFinite(o)?o:20},n.MAX_SAFE_INTEGER=9007199254740991,n.remRadian=function(t){var r=2*Math.PI;return(t%r+r)%r},n.isRadianAroundZero=function(t){return t>-i&&t<i},n.parseDate=function(t){if(t instanceof Date)return t;if("string"==typeof t){var r=new Date(t);return isNaN(+r)&&(r=new Date(new Date(t.replace(/-/g,"/"))-new Date("1970/01/01"))),r}return new Date(Math.round(t))},n.quantity=function(t){return Math.pow(10,Math.floor(Math.log(t)/Math.LN10))},n.nice=function(t,r){var e,i=n.quantity(t),a=t/i;return e=r?a<1.5?1:a<2.5?2:a<4?3:a<7?5:10:a<1?1:a<2?2:a<3?3:a<5?5:10,e*i},n.reformIntervals=function(t){function r(t,e,n){return t.interval[n]<e.interval[n]||t.interval[n]===e.interval[n]&&(t.close[n]-e.close[n]===(n?-1:1)||!n&&r(t,e,1))}t.sort(function(t,e){return r(t,e,0)?-1:1});for(var e=-(1/0),n=1,i=0;i<t.length;){for(var a=t[i].interval,o=t[i].close,s=0;s<2;s++)a[s]<=e&&(a[s]=e,o[s]=s?1:1-n),e=a[s],n=o[s];a[0]===a[1]&&o[0]*o[1]!==1?t.splice(i,1):i++}return t},n.isNumeric=function(t){return t-parseFloat(t)>=0},t.exports=n},function(t,r,e){"use strict";var n=e(11),i=e(8),a=e(29),o=e(21),s=e(1),u=s.vec3,c=s.vec4,h=n.extend(function(){return{projectionMatrix:new i,invProjectionMatrix:new i,viewMatrix:new i,frustum:new a}},function(){this.update(!0)},{update:function(t){n.prototype.update.call(this,t),i.invert(this.viewMatrix,this.worldTransform),this.updateProjectionMatrix(),i.invert(this.invProjectionMatrix,this.projectionMatrix),this.frustum.setFromProjection(this.projectionMatrix)},setViewMatrix:function(t){i.invert(this.worldTransform,t),this.decomposeWorldTransform()},decomposeProjectionMatrix:function(){},setProjectionMatrix:function(t){i.copy(this.projectionMatrix,t),i.invert(this.invProjectionMatrix,t),this.decomposeProjectionMatrix()},updateProjectionMatrix:function(){},castRay:function(){var t=c.create();return function(r,e){var n=void 0!==e?e:new o,i=r._array[0],a=r._array[1];return c.set(t,i,a,-1,1),c.transformMat4(t,t,this.invProjectionMatrix._array),c.transformMat4(t,t,this.worldTransform._array),u.scale(n.origin._array,t,1/t[3]),c.set(t,i,a,1,1),c.transformMat4(t,t,this.invProjectionMatrix._array),c.transformMat4(t,t,this.worldTransform._array),u.scale(t,t,1/t[3]),u.sub(n.direction._array,t,n.origin._array),u.normalize(n.direction._array,n.direction._array),n.direction._dirty=!0,n.origin._dirty=!0,n}}()});t.exports=h},function(t,r,e){"use strict";function n(t){var r;switch(t){case"byte":r=_.Int8Array;break;case"ubyte":r=_.Uint8Array;break;case"short":r=_.Int16Array;break;case"ushort":r=_.Uint16Array;break;default:r=_.Float32Array}return r}function i(t,r,e,n){this.name=t,this.type=r,this.size=e,n&&(this.semantic=n)}function a(t,r,e,n){switch(i.call(this,t,r,e,n),this.value=null,e){case 1:this.get=function(t){return this.value[t]},this.set=function(t,r){this.value[t]=r},this.copy=function(t,r){this.value[t]=this.value[t]};break;case 2:this.get=function(t,r){var e=this.value;return r[0]=e[2*t],r[1]=e[2*t+1],r},this.set=function(t,r){var e=this.value;e[2*t]=r[0],e[2*t+1]=r[1]},this.copy=function(t,r){var e=this.value;r*=2,t*=2,e[t]=e[r],e[t+1]=e[r+1]};break;case 3:this.get=function(t,r){var e=3*t,n=this.value;return r[0]=n[e++],r[1]=n[e++],r[2]=n[e++],r},this.set=function(t,r){var e=3*t,n=this.value;n[e++]=r[0],n[e++]=r[1],n[e++]=r[2]},this.copy=function(t,r){var e=this.value;r*=3,t*=3,e[t]=e[r],e[t+1]=e[r+1],e[t+2]=e[r+2]};break;case 4:this.get=function(t,r){var e=this.value,n=4*t;return r[0]=e[n++],r[1]=e[n++],r[2]=e[n++],r[3]=e[n++],r},this.set=function(t,r){var e=this.value,n=4*t;e[n++]=r[0],e[n++]=r[1],e[n++]=r[2],e[n++]=r[3]},this.copy=function(t,r){var e=this.value;r*=4,t*=4,e[t]=e[r],e[t+1]=e[r+1],e[t+2]=e[r+2],e[t+3]=e[r+3]}}}function o(t,r,e,n){switch(i.call(this,t,r,e,n),this.value=[],e){case 1:this.get=function(t){return this.value[t]},this.set=function(t,r){this.value[t]=r};break;case 2:this.get=function(t,r){var e=this.value[t];return e&&E(r,e),r},this.set=function(t,r){var e=this.value[t];e||(e=this.value[t]=y.create()),E(e,r)};break;case 3:this.get=function(t,r){var e=this.value[t];return e&&g(r,e),r},this.set=function(t,r){var e=this.value[t];e||(e=this.value[t]=m.create()),g(e,r)};break;case 4:this.get=function(t,r){var e=this.value[t];return e&&p(r,e),r},this.set=function(t,r){var e=this.value[t];e||(e=this.value[t]=v.create()),p(e,r)}}}function s(t,r,e,n,i){this.name=t,this.type=r,this.buffer=e,this.size=n,this.semantic=i,this.symbol=""}function u(t){this.buffer=t,this.count=0}function c(){console.warn("Geometry doesn't implement this method, use DynamicGeometry or StaticGeometry instead")}var h=e(6),f=e(5),l=e(18),_=e(9),d=e(1),y=d.vec2,m=d.vec3,v=d.vec4,p=v.copy,g=m.copy,E=y.copy;i.prototype.clone=function(t){var r=new this.constructor(this.name,this.type,this.size,this.semantic);return t&&console.warn("todo"),r},a.prototype.constructor=new i,a.prototype.init=function(t){if(!this.value||this.value.length!=t*this.size){var r=n(this.type);this.value=new r(t*this.size)}},a.prototype.fromArray=function(t){var r,e=n(this.type);if(t[0]&&t[0].length){var i=0,a=this.size;r=new e(t.length*a);for(var o=0;o<t.length;o++)for(var s=0;s<a;s++)r[i++]=t[o][s]}else r=new e(t);this.value=r},o.prototype.constructor=new i,o.prototype.init=function(t){console.warn("Dynamic geometry not support init method")},o.prototype.fromArray=function(t){console.warn("Dynamic geometry not support fromArray method")};var T=h.extend({boundingBox:null,attributes:{},faces:null,dynamic:!1,useFace:!0},function(){this._cache=new l,this._attributeList=Object.keys(this.attributes)},{pickByRay:null,mainAttribute:"position",dirty:c,createAttribute:c,removeAttribute:c,getFace:c,setFace:c,isUseFace:c,getEnabledAttributes:c,getBufferChunks:c,generateVertexNormals:c,generateFaceNormals:c,isUniqueVertex:c,generateUniqueVertex:c,generateTangents:c,generateBarycentric:c,applyTransform:c,dispose:c});T.STATIC_DRAW=f.STATIC_DRAW,T.DYNAMIC_DRAW=f.DYNAMIC_DRAW,T.STREAM_DRAW=f.STREAM_DRAW,T.AttributeBuffer=s,T.IndicesBuffer=u,T.Attribute=i,T.StaticAttribute=a,T.DynamicAttribute=o,t.exports=T},function(t,r,e){"use strict";var n=e(6),i=e(27),a=n.extend({name:"",depthTest:!0,depthMask:!0,transparent:!1,blend:null,_enabledUniforms:null},function(){this.name||(this.name="MATERIAL_"+this.__GUID__),this.shader&&this.attachShader(this.shader),this.uniforms||(this.uniforms={})},{bind:function(t,r){var e=r&&r.shader===this.shader,n=this.shader;e&&n.resetTextureSlot(r.__textureSlotBase||0),this.__textureSlotBase=n.currentTextureSlot();for(var a=0;a<this._enabledUniforms.length;a++){var o=this._enabledUniforms[a],s=this.uniforms[o],u=s.value;if(!e||r.uniforms[o].value!==u)if(void 0!==u){if(null!==u){if(!(u instanceof Array)||u.length)if(u instanceof i){var c=n.currentTextureSlot(),h=n.setUniform(t,"1i",o,c);if(!h)continue;n.useCurrentTextureSlot(t,u)}else if(u instanceof Array){if(0===u.length)continue;var f=u[0];if(f instanceof i){if(!n.hasUniform(o))continue;for(var l=[],_=0;_<u.length;_++){var d=u[_],c=n.currentTextureSlot();l.push(c),n.useCurrentTextureSlot(t,d)}n.setUniform(t,"1iv",o,l)}else n.setUniform(t,s.type,o,u)}else n.setUniform(t,s.type,o,u)}else if("t"===s.type){var c=n.currentTextureSlot(),h=n.setUniform(t,"1i",o,c);h&&n.useCurrentTextureSlot(t,null)}}else console.warn('Uniform value "'+o+'" is undefined')}},setUniform:function(t,r){void 0===r&&console.warn('Uniform value "'+t+'" is undefined');var e=this.uniforms[t];e&&(e.value=r)},setUniforms:function(t){for(var r in t){var e=t[r];this.setUniform(r,e)}},isUniformEnabled:function(t){return this._enabledUniforms.indexOf(t)>=0},set:function(t,r){if("object"==typeof t)for(var e in t){var n=t[e];this.set(e,n)}else{var i=this.uniforms[t];i&&(i.value=r)}},get:function(t){var r=this.uniforms[t];if(r)return r.value},attachShader:function(t,r){this.shader&&this.shader.detached();var e=this.uniforms;this.uniforms=t.createUniforms(),this.shader=t;var n=this.uniforms;if(this._enabledUniforms=Object.keys(n),this._enabledUniforms.sort(),r)for(var i in e)n[i]&&(n[i].value=e[i].value);t.attached()},detachShader:function(){this.shader.detached(),this.shader=null,this.uniforms={}},clone:function(){var t=new this.constructor({name:this.name,shader:this.shader});for(var r in this.uniforms)t.uniforms[r].value=this.uniforms[r].value;return t.depthTest=this.depthTest,t.depthMask=this.depthMask,t.transparent=this.transparent,t.blend=this.blend,t},dispose:function(t,r){if(r)for(var e in this.uniforms){var n=this.uniforms[e].value;if(n)if(n instanceof i)n.dispose(t);else if(n instanceof Array)for(var a=0;a<n.length;a++)n[a]instanceof i&&n[a].dispose(t)}var o=this.shader;o&&(this.detachShader(),o.isAttachedToAny()||o.dispose(t))}});t.exports=a},function(t,r,e){"use strict";function n(t,r,e){this.availableAttributes=t,this.availableAttributeSymbols=r,this.indicesBuffer=e,this.vao=null}var i,a=e(11),o=e(5),s=e(12),u=e(62),c=0,h=null,f=!0,l=function(){this.faceCount=0,this.vertexCount=0,this.drawCallCount=0},_=a.extend({material:null,geometry:null,mode:o.TRIANGLES,_drawCache:null,_renderInfo:null},function(){this._drawCache={},this._renderInfo=new l},{renderOrder:0,lineWidth:1,culling:!0,cullFace:o.BACK,frontFace:o.CCW,frustumCulling:!0,receiveShadow:!0,castShadow:!0,ignorePicking:!1,isRenderable:function(){return this.geometry&&this.material&&!this.invisible},beforeRender:function(t){},afterRender:function(t,r){},getBoundingBox:function(t,r){return r=a.prototype.getBoundingBox.call(this,t,r),this.geometry&&this.geometry.boundingBox&&r.union(this.geometry.boundingBox),r},render:function(t,r){var e=r||this.material,a=e.shader,l=this.geometry,_=this.mode,d=l.vertexCount,y=l.isUseFace(),m=s.getExtension(t,"OES_element_index_uint"),v=m&&d>65535,p=v?t.UNSIGNED_INT:t.UNSIGNED_SHORT,g=s.getExtension(t,"OES_vertex_array_object"),E=!l.dynamic,T=this._renderInfo;T.vertexCount=d,T.faceCount=0,T.drawCallCount=0;var A=!1;if(i=t.__GLID__+"-"+l.__GUID__+"-"+a.__GUID__,i!==c?A=!0:(l instanceof u&&d>65535&&!m&&y||g&&E||l._cache.isDirty())&&(A=!0),c=i,A){var b=this._drawCache[i];if(!b){var x=l.getBufferChunks(t);if(!x)return;b=[];for(var R=0;R<x.length;R++){for(var I=x[R],S=I.attributeBuffers,N=I.indicesBuffer,M=[],w=[],O=0;O<S.length;O++){var L,C=S[O],P=C.name,D=C.semantic;if(D){var U=a.attribSemantics[D];L=U&&U.symbol}else L=P;L&&a.attributeTemplates[L]&&(M.push(C),w.push(L))}var F=new n(M,w,N);b.push(F)}E&&(this._drawCache[i]=b)}for(var B=0;B<b.length;B++){var F=b[B],k=!0;g&&E&&(null==F.vao?F.vao=g.createVertexArrayOES():k=!1,g.bindVertexArrayOES(F.vao));var M=F.availableAttributes,N=F.indicesBuffer;if(k)for(var V=a.enableAttributes(t,F.availableAttributeSymbols,g&&E&&F.vao),O=0;O<M.length;O++){var G=V[O];if(G!==-1){var W,C=M[O],X=C.buffer,z=C.size;switch(C.type){case"float":W=t.FLOAT;break;case"byte":W=t.BYTE;break;case"ubyte":W=t.UNSIGNED_BYTE;break;case"short":W=t.SHORT;break;case"ushort":W=t.UNSIGNED_SHORT;break;default:W=t.FLOAT}t.bindBuffer(t.ARRAY_BUFFER,X),t.vertexAttribPointer(G,z,W,!1,0,0)}}_!=o.LINES&&_!=o.LINE_STRIP&&_!=o.LINE_LOOP||t.lineWidth(this.lineWidth),h=N,f=l.isUseFace(),f?(k&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,N.buffer),t.drawElements(_,N.count,p,0),T.faceCount+=N.count/3):t.drawArrays(_,0,d),g&&E&&g.bindVertexArrayOES(null),T.drawCallCount++}}else f?(t.drawElements(_,h.count,p,0),T.faceCount=h.count/3):t.drawArrays(_,0,d),T.drawCallCount=1;return T},clone:function(){var t=["castShadow","receiveShadow","mode","culling","cullFace","frontFace","frustumCulling"];return function(){var r=a.prototype.clone.call(this);r.geometry=this.geometry,r.material=this.material;for(var e=0;e<t.length;e++){var n=t[e];r[n]!==this[n]&&(r[n]=this[n])}return r}}()});_.beforeFrame=function(){c=0},_.POINTS=o.POINTS,_.LINES=o.LINES,_.LINE_LOOP=o.LINE_LOOP,_.LINE_STRIP=o.LINE_STRIP,_.TRIANGLES=o.TRIANGLES,_.TRIANGLE_STRIP=o.TRIANGLE_STRIP,_.TRIANGLE_FAN=o.TRIANGLE_FAN,_.BACK=o.BACK,_.FRONT=o.FRONT,_.FRONT_AND_BACK=o.FRONT_AND_BACK,_.CW=o.CW,_.CCW=o.CCW,_.RenderInfo=l,t.exports=_},function(t,r,e){"use strict";var n=e(6),i=e(5),a=e(18),o=n.extend({width:512,height:512,type:i.UNSIGNED_BYTE,format:i.RGBA,wrapS:i.CLAMP_TO_EDGE,wrapT:i.CLAMP_TO_EDGE,minFilter:i.LINEAR_MIPMAP_LINEAR,magFilter:i.LINEAR,useMipmap:!0,anisotropic:1,flipY:!0,unpackAlignment:4,premultiplyAlpha:!1,dynamic:!1,NPOT:!1},function(){this._cache=new a},{getWebGLTexture:function(t){var r=this._cache;return r.use(t.__GLID__),r.miss("webgl_texture")&&r.put("webgl_texture",t.createTexture()),this.dynamic?this.update(t):r.isDirty()&&(this.update(t),r.fresh()),r.get("webgl_texture")},bind:function(){},unbind:function(){},dirty:function(){this._cache.dirtyAll()},update:function(t){},beforeUpdate:function(t){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,this.unpackAlignment),this.fallBack()},fallBack:function(){var t=this.isPowerOfTwo();this.format===i.DEPTH_COMPONENT&&(this.useMipmap=!1),t&&this.useMipmap?(this.NPOT=!1,this._minFilterOriginal&&(this.minFilter=this._minFilterOriginal),this._magFilterOriginal&&(this.magFilter=this._magFilterOriginal),this._wrapSOriginal&&(this.wrapS=this._wrapSOriginal),this._wrapTOriginal&&(this.wrapT=this._wrapTOriginal)):(this.NPOT=!0,this._minFilterOriginal=this.minFilter,this._magFilterOriginal=this.magFilter,this._wrapSOriginal=this.wrapS,this._wrapTOriginal=this.wrapT,this.minFilter==i.NEAREST_MIPMAP_NEAREST||this.minFilter==i.NEAREST_MIPMAP_LINEAR?this.minFilter=i.NEAREST:this.minFilter!=i.LINEAR_MIPMAP_LINEAR&&this.minFilter!=i.LINEAR_MIPMAP_NEAREST||(this.minFilter=i.LINEAR),this.wrapS=i.CLAMP_TO_EDGE,this.wrapT=i.CLAMP_TO_EDGE)},nextHighestPowerOfTwo:function(t){--t;for(var r=1;r<32;r<<=1)t|=t>>r;return t+1},dispose:function(t){var r=this._cache;r.use(t.__GLID__);var e=r.get("webgl_texture");e&&t.deleteTexture(e),r.deleteContext(t.__GLID__)},isRenderable:function(){},isPowerOfTwo:function(){}});o.BYTE=i.BYTE,o.UNSIGNED_BYTE=i.UNSIGNED_BYTE,o.SHORT=i.SHORT,o.UNSIGNED_SHORT=i.UNSIGNED_SHORT,o.INT=i.INT,o.UNSIGNED_INT=i.UNSIGNED_INT,o.FLOAT=i.FLOAT,o.HALF_FLOAT=36193,o.UNSIGNED_INT_24_8_WEBGL=34042,o.DEPTH_COMPONENT=i.DEPTH_COMPONENT,o.DEPTH_STENCIL=i.DEPTH_STENCIL,o.ALPHA=i.ALPHA,o.RGB=i.RGB,o.RGBA=i.RGBA,o.LUMINANCE=i.LUMINANCE,o.LUMINANCE_ALPHA=i.LUMINANCE_ALPHA,o.COMPRESSED_RGB_S3TC_DXT1_EXT=33776,o.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,o.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,o.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,o.NEAREST=i.NEAREST,o.LINEAR=i.LINEAR,o.NEAREST_MIPMAP_NEAREST=i.NEAREST_MIPMAP_NEAREST,o.LINEAR_MIPMAP_NEAREST=i.LINEAR_MIPMAP_NEAREST,o.NEAREST_MIPMAP_LINEAR=i.NEAREST_MIPMAP_LINEAR,o.LINEAR_MIPMAP_LINEAR=i.LINEAR_MIPMAP_LINEAR,o.REPEAT=i.REPEAT,o.CLAMP_TO_EDGE=i.CLAMP_TO_EDGE,o.MIRRORED_REPEAT=i.MIRRORED_REPEAT,t.exports=o},function(t,r,e){"use strict";var n=e(7),i=e(4),a=n.extend({widthSegments:1,heightSegments:1},function(){this.build()},{build:function(){for(var t=this.heightSegments,r=this.widthSegments,e=this.attributes,n=[],a=[],o=[],s=[],u=0;u<=t;u++)for(var c=u/t,h=0;h<=r;h++){var f=h/r;if(n.push([2*f-1,2*c-1,0]),a&&a.push([f,c]),o&&o.push([0,0,1]),h<r&&u<t){var l=h+u*(r+1);s.push([l,l+1,l+r+1]),s.push([l+r+1,l+1,l+r+2])}}e.position.fromArray(n),e.texcoord0.fromArray(a),e.normal.fromArray(o),this.initFaceFromArray(s),this.boundingBox=new i,this.boundingBox.min.set(-1,-1,0),this.boundingBox.max.set(1,1,0)}});t.exports=a},function(t,r,e){"use strict";var n=(e(3),e(4)),i=e(30),a=e(1),o=a.vec3,s=o.set,u=o.copy,c=o.transformMat4,h=Math.min,f=Math.max,l=function(){this.planes=[];for(var t=0;t<6;t++)this.planes.push(new i);this.boundingBox=new n,this.vertices=[];for(var t=0;t<8;t++)this.vertices[t]=o.fromValues(0,0,0)};l.prototype={setFromProjection:function(t){var r=this.planes,e=t._array,n=e[0],i=e[1],a=e[2],o=e[3],u=e[4],c=e[5],h=e[6],f=e[7],l=e[8],_=e[9],d=e[10],y=e[11],m=e[12],v=e[13],p=e[14],g=e[15];s(r[0].normal._array,o-n,f-u,y-l),r[0].distance=-(g-m),r[0].normalize(),s(r[1].normal._array,o+n,f+u,y+l),r[1].distance=-(g+m),r[1].normalize(),s(r[2].normal._array,o+i,f+c,y+_),r[2].distance=-(g+v),r[2].normalize(),s(r[3].normal._array,o-i,f-c,y-_),r[3].distance=-(g-v),r[3].normalize(),s(r[4].normal._array,o-a,f-h,y-d),r[4].distance=-(g-p),r[4].normalize(),s(r[5].normal._array,o+a,f+h,y+d),r[5].distance=-(g+p),r[5].normalize();var E=this.boundingBox;if(0===g){var T=c/n,A=-p/(d-1),b=-p/(d+1),x=-b/c,R=-A/c;E.min.set(-x*T,-x,b),E.max.set(x*T,x,A);var I=this.vertices;s(I[0],-x*T,-x,b),s(I[1],-x*T,x,b),s(I[2],x*T,-x,b),s(I[3],x*T,x,b),s(I[4],-R*T,-R,A),s(I[5],-R*T,R,A),s(I[6],R*T,-R,A),s(I[7],R*T,R,A)}else{var S=(-1-m)/n,N=(1-m)/n,M=(1-v)/c,w=(-1-v)/c,O=(-1-p)/d,L=(1-p)/d;E.min.set(S,w,L),E.max.set(N,M,O);var C=E.min._array,P=E.max._array,I=this.vertices;s(I[0],C[0],C[1],C[2]),s(I[1],C[0],P[1],C[2]),s(I[2],P[0],C[1],C[2]),s(I[3],P[0],P[1],C[2]),s(I[4],C[0],C[1],P[2]),s(I[5],C[0],P[1],P[2]),s(I[6],P[0],C[1],P[2]),s(I[7],P[0],P[1],P[2])}},getTransformedBoundingBox:function(){var t=o.create();return function(r,e){var n=this.vertices,i=e._array,a=r.min,o=r.max,s=a._array,l=o._array,_=n[0];c(t,_,i),u(s,t),u(l,t);for(var d=1;d<8;d++)_=n[d],c(t,_,i),s[0]=h(t[0],s[0]),s[1]=h(t[1],s[1]),s[2]=h(t[2],s[2]),l[0]=f(t[0],l[0]),l[1]=f(t[1],l[1]),l[2]=f(t[2],l[2]);return a._dirty=!0,o._dirty=!0,r}}()},t.exports=l},function(t,r,e){"use strict";var n=e(3),i=e(1),a=i.vec3,o=i.mat4,s=i.vec4,u=function(t,r){this.normal=t||new n(0,1,0),this.distance=r||0};u.prototype={constructor:u,distanceToPoint:function(t){return a.dot(t._array,this.normal._array)-this.distance},projectPoint:function(t,r){r||(r=new n);var e=this.distanceToPoint(t);return a.scaleAndAdd(r._array,t._array,this.normal._array,-e),r._dirty=!0,r},normalize:function(){var t=1/a.len(this.normal._array);a.scale(this.normal._array,t),this.distance*=t},intersectFrustum:function(t){for(var r=t.vertices,e=this.normal._array,n=a.dot(r[0]._array,e)>this.distance,i=1;i<8;i++)if(a.dot(r[i]._array,e)>this.distance!=n)return!0},intersectLine:function(){var t=a.create();return function(r,e,i){var o=this.distanceToPoint(r),s=this.distanceToPoint(e);if(o>0&&s>0||o<0&&s<0)return null;var u=this.normal._array,c=this.distance,h=r._array;a.sub(t,e._array,r._array),a.normalize(t,t);var f=a.dot(u,t);if(0===f)return null;i||(i=new n);var l=(a.dot(u,h)-c)/f;return a.scaleAndAdd(i._array,h,t,-l),i._dirty=!0,i}}(),applyTransform:function(){var t=o.create(),r=s.create(),e=s.create();return e[3]=1,function(n){n=n._array,a.scale(e,this.normal._array,this.distance),s.transformMat4(e,e,n),this.distance=a.dot(e,this.normal._array),o.invert(t,n),o.transpose(t,t),r[3]=0,a.copy(r,this.normal._array),s.transformMat4(r,r,t),a.copy(this.normal._array,r)}}(),copy:function(t){a.copy(this.normal._array,t.normal._array),this.normal._dirty=!0,this.distance=t.distance},clone:function(){var t=new u;return t.copy(this),t}},t.exports=u},function(t,r,e){"use strict";function n(t,r,e,n){e<0&&(t+=e,e=-e),n<0&&(r+=n,n=-n),this.x=t,this.y=r,this.width=e,this.height=n}var i=e(92),a=e(91),o=i.applyTransform,s=Math.min,u=Math.max;n.prototype={constructor:n,union:function(t){var r=s(t.x,this.x),e=s(t.y,this.y);this.width=u(t.x+t.width,this.x+this.width)-r,this.height=u(t.y+t.height,this.y+this.height)-e,this.x=r,this.y=e},applyTransform:function(){var t=[],r=[],e=[],n=[];return function(i){if(i){t[0]=e[0]=this.x,t[1]=n[1]=this.y,r[0]=n[0]=this.x+this.width,r[1]=e[1]=this.y+this.height,o(t,t,i),o(r,r,i),o(e,e,i),o(n,n,i),this.x=s(t[0],r[0],e[0],n[0]),this.y=s(t[1],r[1],e[1],n[1]);var a=u(t[0],r[0],e[0],n[0]),c=u(t[1],r[1],e[1],n[1]);this.width=a-this.x,this.height=c-this.y}}}(),calculateTransform:function(t){var r=this,e=t.width/r.width,n=t.height/r.height,i=a.create();return a.translate(i,i,[-r.x,-r.y]),a.scale(i,i,[e,n]),a.translate(i,i,[t.x,t.y]),i},intersect:function(t){if(!t)return!1;t instanceof n||(t=n.create(t));var r=this,e=r.x,i=r.x+r.width,a=r.y,o=r.y+r.height,s=t.x,u=t.x+t.width,c=t.y,h=t.y+t.height;return!(i<s||u<e||o<c||h<a)},contain:function(t,r){var e=this;return t>=e.x&&t<=e.x+e.width&&r>=e.y&&r<=e.y+e.height},clone:function(){return new n(this.x,this.y,this.width,this.height)},copy:function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},plain:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}}},n.create=function(t){return new n(t.x,t.y,t.width,t.height)},t.exports=n},function(t,r){t.exports="@export ecgl.bar3d.albedo.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform vec2 uvRepeat: [1, 1];\n\nattribute vec3 position: POSITION;\nattribute vec4 a_Color : COLOR;\n\nvarying vec4 v_Color;\n\nvoid main()\n{\n    gl_Position = worldViewProjection * vec4(position, 1.0);\n\n    v_Color = a_Color;\n}\n\n@end\n\n@export ecgl.bar3d.albedo.fragment\n\nuniform vec3 color : [1.0, 1.0, 1.0];\nuniform float alpha : 1.0;\n\nvarying vec4 v_Color;\n\nvoid main()\n{\n    gl_FragColor = vec4(color, alpha);\n\n    gl_FragColor *= v_Color;\n}\n@end"},function(t,r){t.exports="/**\n * http://en.wikipedia.org/wiki/Lambertian_reflectance\n */\n\n@export ecgl.bar3d.lambert.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform mat4 worldInverseTranspose : WORLDINVERSETRANSPOSE;\nuniform mat4 world : WORLD;\n\nattribute vec3 position : POSITION;\nattribute vec3 normal : NORMAL;\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nvoid main()\n{\n    gl_Position = worldViewProjection * vec4(position, 1.0);\n\n    v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);\n    v_WorldPosition = (world * vec4(position, 1.0)).xyz;\n}\n\n@end\n\n\n@export ecgl.bar3d.lambert.fragment\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform vec3 color : [1.0, 1.0, 1.0];\nuniform float alpha : 1.0;\n\n#ifdef AMBIENT_LIGHT_COUNT\n@import qtek.header.ambient_light\n#endif\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import qtek.header.directional_light\n#endif\n\nvoid main()\n{\n    gl_FragColor = vec4(color, alpha);\n\n    vec3 N = v_Normal;\n    vec3 P = v_WorldPosition;\n    float ambientFactor = 1.0;\n\n    vec3 diffuseColor = vec3(0.0, 0.0, 0.0);\n\n#ifdef AMBIENT_LIGHT_COUNT\n    for(int i = 0; i < AMBIENT_LIGHT_COUNT; i++)\n    {\n        // Multiply a dot factor to make sure the bump detail can be seen\n        // in the dark side\n        diffuseColor += ambientLightColor[i] * ambientFactor;\n    }\n#endif\n#ifdef DIRECTIONAL_LIGHT_COUNT\n    for(int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++)\n    {\n        vec3 lightDirection = -directionalLightDirection[i];\n        vec3 lightColor = directionalLightColor[i];\n\n        float ndl = dot(N, normalize(lightDirection));\n\n        float shadowContrib = 1.0;\n        #if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n            if(shadowEnabled)\n            {\n                shadowContrib = shadowContribs[i];\n            }\n        #endif\n\n        diffuseColor += lightColor * clamp(ndl, 0.0, 1.0) * shadowContrib;\n    }\n#endif\n\n    gl_FragColor.rgb *= diffuseColor;\n}\n\n@end";
},function(t,r){t.exports="@export ecgl.lines.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec3 position: POSITION;\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n\nvoid main()\n{\n    gl_Position = worldViewProjection * vec4(position, 1.0);\n    v_Color = a_Color;\n}\n\n@end\n\n@export ecgl.lines.fragment\n\nuniform vec3 color : [1.0, 1.0, 1.0];\nuniform float alpha : 1.0;\n\nvarying vec4 v_Color;\n\nvoid main()\n{\n    gl_FragColor = vec4(color, alpha) * v_Color;\n}\n@end"},function(t,r){t.exports="@export ecgl.globe.albedo.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform vec2 uvRepeat: [1, 1];\n\nattribute vec2 texcoord : TEXCOORD_0;\nattribute vec3 position: POSITION;\n\nvarying vec2 v_Texcoord;\n\nvoid main()\n{\n    gl_Position = worldViewProjection * vec4(position, 1.0);\n    v_Texcoord = texcoord * uvRepeat;\n}\n\n@end\n\n@export ecgl.globe.albedo.fragment\n\nuniform sampler2D diffuseMap;\nuniform vec3 color : [1.0, 1.0, 1.0];\nuniform float alpha : 1.0;\n\nvarying vec2 v_Texcoord;\n\nvoid main()\n{\n    gl_FragColor = vec4(color, alpha);\n\n    #ifdef DIFFUSEMAP_ENABLED\n        vec4 tex = texture2D(diffuseMap, v_Texcoord);\n        // Premultiplied alpha\n        #ifdef PREMULTIPLIED_ALPHA\n        tex.rgb /= tex.a;\n        #endif\n        gl_FragColor *= tex;\n    #endif\n}\n@end"},function(t,r){t.exports="/**\n * http://en.wikipedia.org/wiki/Lambertian_reflectance\n */\n\n@export ecgl.globe.lambert.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform mat4 worldInverseTranspose : WORLDINVERSETRANSPOSE;\nuniform mat4 world : WORLD;\n\nuniform vec2 uvRepeat : [1.0, 1.0];\nuniform vec2 uvOffset : [0.0, 0.0];\n\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\nattribute vec3 normal : NORMAL;\n\nvarying vec2 v_Texcoord;\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nvoid main()\n{\n    v_Texcoord = texcoord * uvRepeat + uvOffset;\n\n    gl_Position = worldViewProjection * vec4(position, 1.0);\n\n    v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);\n    v_WorldPosition = (world * vec4(position, 1.0)).xyz;\n}\n\n@end\n\n\n@export ecgl.globe.lambert.fragment\n\n#define PI 3.14159265358979\n\n#extension GL_OES_standard_derivatives : enable\n\nvarying vec2 v_Texcoord;\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\n#ifdef DIFFUSEMAP_ENABLED\nuniform sampler2D diffuseMap;\n#endif\n\n#ifdef BUMPMAP_ENABLED\nuniform sampler2D bumpMap;\nuniform float bumpScale : 1.0;\n// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n//  http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\nvec3 perturbNormalArb(vec3 surfPos, vec3 surfNormal, vec3 baseNormal)\n{\n    vec2 dSTdx = dFdx(v_Texcoord);\n    vec2 dSTdy = dFdy(v_Texcoord);\n\n    float Hll = bumpScale * texture2D(bumpMap, v_Texcoord).x;\n    float dHx = bumpScale * texture2D(bumpMap, v_Texcoord + dSTdx).x - Hll;\n    float dHy = bumpScale * texture2D(bumpMap, v_Texcoord + dSTdy).x - Hll;\n\n    vec3 vSigmaX = dFdx(surfPos);\n    vec3 vSigmaY = dFdy(surfPos);\n    vec3 vN = surfNormal;\n\n    vec3 R1 = cross(vSigmaY, vN);\n    vec3 R2 = cross(vN, vSigmaX);\n\n    float fDet = dot(vSigmaX, R1);\n\n    vec3 vGrad = sign(fDet) * (dHx * R1 + dHy * R2);\n    return normalize(abs(fDet) * baseNormal - vGrad);\n\n}\n#endif\n\nuniform vec3 color : [1.0, 1.0, 1.0];\nuniform float alpha : 1.0;\n\n#ifdef AMBIENT_LIGHT_COUNT\n@import qtek.header.ambient_light\n#endif\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import qtek.header.directional_light\n#endif\n\nvoid main()\n{\n#ifdef RENDER_TEXCOORD\n    gl_FragColor = vec4(v_Texcoord, 1.0, 1.0);\n    return;\n#endif\n\n    gl_FragColor = vec4(color, alpha);\n\n#ifdef DIFFUSEMAP_ENABLED\n    vec4 tex = texture2D(diffuseMap, v_Texcoord);\n    // Premultiplied alpha\n#ifdef PREMULTIPLIED_ALPHA\n    tex.rgb /= tex.a;\n#endif\n    gl_FragColor *= tex;\n#endif\n\n    vec3 N = v_Normal;\n    vec3 P = v_WorldPosition;\n    float ambientFactor = 1.0;\n#ifdef FLAT\n    // Map plane normal and position to sphere coordinates\n    float theta = (1.0 - v_Texcoord.y) * PI;\n    float phi = v_Texcoord.x * PI * 2.0;\n    float r0 = sin(theta);\n    N = vec3(-cos(phi) * r0, cos(theta), sin(phi) * r0);\n    P = N;\n#endif\n\n#ifdef BUMPMAP_ENABLED\n    N = perturbNormalArb(v_WorldPosition, v_Normal, N);\n    #ifdef FLAT\n        ambientFactor = dot(P, N);\n    #else\n        ambientFactor = dot(v_Normal, N);\n    #endif\n#endif\n\nvec3 diffuseColor = vec3(0.0, 0.0, 0.0);\n\n#ifdef AMBIENT_LIGHT_COUNT\n    for(int i = 0; i < AMBIENT_LIGHT_COUNT; i++)\n    {\n        // Multiply a dot factor to make sure the bump detail can be seen\n        // in the dark side\n        diffuseColor += ambientLightColor[i] * ambientFactor;\n    }\n#endif\n#ifdef DIRECTIONAL_LIGHT_COUNT\n    for(int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++)\n    {\n        vec3 lightDirection = -directionalLightDirection[i];\n        vec3 lightColor = directionalLightColor[i];\n\n        float ndl = dot(N, normalize(lightDirection));\n\n        float shadowContrib = 1.0;\n        #if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n            if(shadowEnabled)\n            {\n                shadowContrib = shadowContribs[i];\n            }\n        #endif\n\n        diffuseColor += lightColor * clamp(ndl, 0.0, 1.0) * shadowContrib;\n    }\n#endif\n\n    gl_FragColor.rgb *= diffuseColor;\n}\n\n@end"},function(t,r,e){e(2);e(38),e(39),e(41)},function(t,r,e){var n=e(2);t.exports=n.extendSeriesModel({type:"series.bar3d",dependencies:["globe3d"],initData:function(t,r){var e=new n.List(["x","y","z"],this);return e.initData(t.data),e},defaultOption:{coordinateSystem:"globe",globeIndex:0,zlevel:10,barSize:1,minHeightOnGlobe:0,maxheightOnGlobe:20}})},function(t,r,e){var n=e(2),i=e(15),a=e(40);i.Shader.import(e(32)),i.Shader.import(e(33)),t.exports=n.extendChartView({type:"bar3d",init:function(t,r){this.groupGL=new i.Node;var e=new i.Mesh({geometry:new a({dynamic:!0}),material:new i.Material});this.groupGL.add(e),this._barMesh=e},render:function(t,r,e){var n=t.coordinateSystem;"globe"===n.type},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}})},function(t,r,e){var n=e(7),i=e(1),a=i.vec3,o=n.extend(function(){return{attributes:{position:new n.Attribute("position","float",3,"POSITION"),normal:new n.Attribute("normal","float",3,"NORMAL"),color:new n.Attribute("color","float",4,"COLOR")},_vertexOffset:0,_faceOffset:0}},{reset:function(){this._vertexOffset=0,this._faceOffset=0},setBarCount:function(t,r){var e=this.getBarVertexCount(r),n=this.getBarFaceCount(r);this.vertexCount!==e&&(this.attributes.position.init(e),r?this.attributes.normal.init(e):this.attributes.normal.value=null,this.attributes.color.init(e)),r?this.faces=null:this.faceCount!==n&&(this.faces=e>65535?new Uint32Array(3*n):new Uint16Array(3*n)),this._enableNormal=r},getBarVertexCount:function(t){return t?30:8},getBarFaceCount:function(){return 12},addBar:function(){for(var t=a.create,r=a.scaleAndAdd,e=t(),n=t(),i=t(),o=t(),s=t(),u=t(),c=[],h=[],f=0;f<8;f++)c[f]=t();var l=[[1,5,6],[0,1,6],[2,7,6],[3,7,2],[4,5,6],[4,6,7],[0,2,1],[0,3,2],[0,4,7],[3,0,7],[1,6,5],[1,2,6]];return function(t,f,_,d,y){a.sub(n,f,t),a.normalize(n,n),a.cross(i,_,n),a.normalize(i,i),a.cross(e,n,i),a.normalize(i,i),a.negate(o,e),a.negate(s,n),a.negate(u,i),r(c[0],t,e,d[0]),r(c[0],c[0],i,d[1]),r(c[1],t,e,d[0]),r(c[1],c[1],u,d[1]),r(c[2],t,o,d[0]),r(c[2],c[2],u,d[1]),r(c[3],t,o,d[0]),r(c[3],c[3],i,d[1]),r(c[4],f,e,d[0]),r(c[4],c[4],i,d[1]),r(c[5],f,e,d[0]),r(c[5],c[5],i,d[1]),r(c[6],f,e,d[0]),r(c[6],c[6],i,d[1]),r(c[7],f,e,d[0]),r(c[7],c[7],i,d[1]);var m=this.attributes;if(this._enableNormal){h[0]=e,h[1]=o,h[2]=n,h[3]=s,h[4]=i,h[5]=u;for(var v=0;v<l.length;v++)for(var p=h[Math.floor(v/2)],g=0;g<3;g++){var E=l[v][g];m.position.set(this._vertexOffset,c[E]),m.normal.set(this._vertexOffset,p),m.color.set(this._vertexOffset++,y)}}else{for(var v=0;v<l.length;v++){for(var T=3*this._faceOffset,g=0;g<3;g++)this.faces[T+g]=l[v][g]+this._vertexOffset;this._faceOffset++}for(var v=0;v<c.length;v++)m.position.set(this._vertexOffset,c[v]),m.color.set(this._vertexOffset++,y)}}}()});t.exports=o},function(t,r,e){function n(t,r){var e=t.getData(),n=e.getDataExtent("z",!0),a=[t.get("minHeightOnGlobe"),t.get("minHeightOnGlobe")];e.each(["x","y","z"],function(t,o,s,u){var c=r.radius,h=r.dataToPoint([t,o,c]),f=r.dataToPoint([t,o,c+i.number.linearMap(s,n,a)]);e.setItemLayout(u,[h,f])})}var i=e(2);i.registerLayout(function(t,r){t.eachSeriesByType("bar3d",function(t){var r=t.coordinateSystem;"globe"===r.type&&n(t,r)})})},function(t,r,e){e(46),e(44),e(43)},function(t,r,e){var n=e(2);n.extendSeriesModel({type:"series.lines3d",dependencies:["globe"],visualColorAccessPath:"lineStyle.normal.color",getInitialData:function(t,r){var e=new n.List(["value"],this);return e.hasItemOption=!1,e.initData(t.data,[],function(t,r,n,i){if(t instanceof Array)return NaN;e.hasItemOption=!0;var a=t.value;return null!=a?a instanceof Array?a[i]:a:void 0}),e},defaultOption:{coordinateSystem:"globe",globeIndex:0,zlevel:10,polyline:!1,blendMode:"source-over",lineStyle:{normal:{}}}})},function(t,r,e){var n=e(2),i=e(15),a=e(45);i.Shader.import(e(34)),t.exports=n.extendChartView({type:"lines3d",init:function(t,r){this.groupGL=new i.Node,this._linesMesh=new i.Mesh({material:new i.Material({shader:new i.Shader({vertex:i.Shader.source("ecgl.lines.vertex"),fragment:i.Shader.source("ecgl.lines.fragment")}),transparent:!0}),mode:i.Mesh.LINES,geometry:new a({dynamic:!0})}),this.groupGL.add(this._linesMesh)},render:function(t,r,e){var n=t.coordinateSystem,i=t.getData();if("globe"===n.type){var a=n.viewGL;a.add(this.groupGL),"cubicBezier"===i.getLayout("lineType")&&this._generateBezierCurvesOnGlobe(t)}this._linesMesh.material.blend="lighter"===t.get("blendMode")?function(t){t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE)}:null},_generateBezierCurvesOnGlobe:function(t){var r=t.getData(),e=t.coordinateSystem,i=this._linesMesh.geometry;i.segmentScale=e.radius/20;var a=0;r.each(function(t){var e=r.getItemLayout(t);a+=i.getCubicCurveVertexCount(e[0],e[1],e[2],e[3])}),i.setVertexCount(a),i.reset();var o,s,u,c=[0,0,0],h=["lineStyle","normal","opacity"];r.each(function(t){var e=r.getItemModel(t),a=r.getItemLayout(t),f=r.getItemVisual(t,"color"),l=e.get(h);f===o&&l===s||(u=n.color.parse(f),u[0]/=255,u[1]/=255,u[2]/=255,u[3]*=l,o=f,s=l),i.addCubicCurve(a[0],a[1],a[2],a[3],u||c)}),i.dirty()},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}})},function(t,r,e){var n=e(7),i=e(1).vec3,a=n.extend(function(){return{segmentScale:1,attributes:{position:new n.Attribute("position","float",3,"POSITION"),color:new n.Attribute("color","float",4,"COLOR")}}},{reset:function(){this._offset=0},setVertexCount:function(t){this.vertexCount!==t&&(this.attributes.position.init(t),this.attributes.color.init(t),this._offset=0)},getCubicCurveVertexCount:function(t,r,e,n){var a=i.dist(t,r)+i.dist(e,r)+i.dist(n,e),o=1/(a+1)*this.segmentScale;return 2*Math.ceil(1/o)+1},addCubicCurve:function(t,r,e,n,a){for(var o=t[0],s=t[1],u=t[2],c=r[0],h=r[1],f=r[2],l=e[0],_=e[1],d=e[2],y=n[0],m=n[1],v=n[2],p=i.dist(t,r)+i.dist(e,r)+i.dist(n,e),g=1/(p+1)*this.segmentScale,E=g*g,T=E*g,A=3*g,b=3*E,x=6*E,R=6*T,I=o-2*c+l,S=s-2*h+_,N=u-2*f+d,M=3*(c-l)-o+y,w=3*(h-_)-s+m,O=3*(f-d)-u+v,L=o,C=s,P=u,D=(c-o)*A+I*b+M*T,U=(h-s)*A+S*b+w*T,F=(f-u)*A+N*b+O*T,B=I*x+M*R,k=S*x+w*R,V=N*x+O*R,G=M*R,W=w*R,X=O*R,z=this.attributes.position,H=this.attributes.color,q=!0,j=0,Y=[];j<1+g;)q||(z.copy(this._offset,this._offset-1),H.copy(this._offset,this._offset-1),this._offset++),q=!1,H.set(this._offset,a),Y[0]=L,Y[1]=C,Y[2]=P,z.set(this._offset,Y),this._offset++,L+=D,C+=U,P+=F,D+=B,U+=k,F+=V,B+=G,k+=W,V+=X,j+=g}});t.exports=a},function(t,r,e){function n(t,r){var e=t.getData(),n=t.get("polyline"),i=o.create(),a=o.create(),s=o.create(),u=o.create();e.setLayout("lineType",n?"polyline":"cubicBezier"),e.each(function(t){var c=e.getItemModel(t),h=c.option instanceof Array?c.option:c.getShallow("coords",!0);if(!(h instanceof Array&&h.length>0&&h[0]instanceof Array))throw new Error("Invalid coords "+JSON.stringify(h)+". Lines must have 2d coords array in data item.");var f=[];if(n);else{var l=f[0]=o.create(),_=f[1]=o.create(),d=f[2]=o.create(),y=f[3]=o.create();r.dataToPoint(h[0],l),r.dataToPoint(h[1],y),o.normalize(i,l),o.sub(a,y,l),o.normalize(a,a),o.cross(s,a,i),o.normalize(s,s),o.cross(a,i,s),o.add(_,i,a),o.normalize(_,_),o.normalize(i,y),o.sub(a,l,y),o.normalize(a,a),o.cross(s,a,i),o.normalize(s,s),o.cross(a,i,s),o.add(d,i,a),o.normalize(d,d),o.add(u,l,y),o.normalize(u,u);var m=o.dot(l,u),v=o.dot(u,_),p=(r.radius-m)/v*2;o.scaleAndAdd(_,l,_,p),o.scaleAndAdd(d,y,d,p)}e.setItemLayout(t,f)})}var i=e(2),a=e(1),o=a.vec3;i.registerLayout(function(t,r){t.eachSeriesByType("lines3d",function(t){var r=t.coordinateSystem;"globe"===r.type&&n(t,r)})})},function(t,r){},function(t,r,e){e(2)},function(t,r,e){var n=e(2);e(50),e(51),e(53),n.registerAction({type:"globeUpdateCamera",event:"globeupdatecamera",update:"none"},function(t,r){r.eachComponent({mainType:"globe",query:t},function(r){r.setView(t.position,t.quaternion)})})},function(t,r,e){var n=e(2);t.exports=n.extendComponentModel({type:"globe",layoutMode:"box",coordinateSystem:null,defaultOption:{zlevel:10,show:!0,flat:!1,left:0,top:0,width:"100%",height:"100%",environmentTexture:"",baseTexture:"",heightTexture:"",displacementTexture:"",displacementScale:0,globeRadius:100,light:{enable:!1,sunIntensity:1,ambientIntensity:.1,time:""},viewControl:{autoRotate:!0,autoRotateAfterStill:3,center:null,distance:150,minDistance:40,maxDistance:400,position:null,quaternion:null},layers:[]},setView:function(t,r){this.option.viewControl.position=t,this.option.viewControl.quaternion=r}})},function(t,r,e){function n(){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=t.height=1,r.fillStyle="#fff",r.fillRect(0,0,1,1),r}var i=e(2),a=e(15),o=e(57),s=e(59);a.Shader.import(e(35)),a.Shader.import(e(36)),t.exports=i.extendComponentView({type:"globe",_displacementScale:0,init:function(t,r){this.groupGL=new a.Node,this._blankTexture=new a.Texture2D({image:n()});var e=new a.Shader({vertex:a.Shader.source("ecgl.globe.lambert.vertex"),fragment:a.Shader.source("ecgl.globe.lambert.fragment")});this._lambertMaterial=new a.Material({shader:e});var i=new a.Shader({vertex:a.Shader.source("ecgl.globe.albedo.vertex"),fragment:a.Shader.source("ecgl.globe.albedo.fragment")});this._albedoMaterial=new a.Material({shader:i}),this._sphereGeometry=new a.SphereGeometry({widthSegments:200,heightSegments:100,dynamic:!0}),this._planeGeometry=new a.PlaneGeometry,this._earthMesh=new a.Mesh({name:"earth"}),this._sunLight=new a.DirectionalLight,this._ambientLight=new a.AmbientLight,this.groupGL.add(this._earthMesh),this.groupGL.add(this._ambientLight),this.groupGL.add(this._sunLight),this._control=new o({zr:r.getZr()}),this._control.init()},render:function(t,r,e){function n(){return{type:"globeUpdateCamera",position:c.position.toArray(),quaternion:c.rotation.toArray(),from:this.uid,globeId:t.id}}var i=t.coordinateSystem,o=t.get("light.enable");i.viewGL.add(this.groupGL);var s=this._earthMesh;s.geometry=this._sphereGeometry,s.material=o?this._lambertMaterial:this._albedoMaterial,s.scale.set(i.radius,i.radius,i.radius),s.setTextureImage("diffuseMap",t.get("baseTexture"),e,{flipY:!1,anisotropic:8}),s.setTextureImage("bumpMap",t.get("heightTexture"),e,{flipY:!1,anisotropic:8}),this._updateLight(t,e),this._displaceVertices(t,e);var u=t.getModel("viewControl"),c=i.viewGL.camera,h=u.get("position"),f=u.get("quaternion");null!=h?c.position.setArray(h):c.position.z=i.radius+u.get("distance"),null!=f&&c.lookAt(a.Vector3.ZERO),e.dispatchAction(n());var l=this._control;l.setCamera(c),l.autoRotate=u.get("autoRotate"),l.autoRotateAfterStill=u.get("autoRotateAfterStill"),l.minDistance=u.get("minDistance")+i.radius,l.maxDistance=u.get("maxDistance")+i.radius,l.setDistance(u.get("distance")+i.radius),l.off("update"),l.on("update",function(){e.dispatchAction(n())})},_displaceVertices:function(t,r){var e=t.get("displacementTexture")||t.get("heightTexture"),n=t.get("displacementScale");if(e&&"none"!==e||(n=0),n!==this._displacementScale){this._displacementScale=n;var i,o=this._sphereGeometry;if(a.isImage(e))i=e,this._doDisplaceVertices(o,i,n);else{i=new Image;var s=this;i.onload=function(){s._doDisplaceVertices(o,i,n)},i.src=e}}},_doDisplaceVertices:function(t,r,e){var n=t.attributes.position.value,i=t.attributes.texcoord0.value,a=t.__originalPosition;a&&a.length===n.length||(a=new Float32Array(n.length),a.set(n),t.__originalPosition=a);var o=document.createElement("canvas"),s=o.getContext("2d"),u=r.width,c=r.height;o.width=u,o.height=c,s.drawImage(r,0,0,u,c);for(var h=s.getImageData(0,0,u,c).data,f=0;f<t.vertexCount;f++){var l=3*f,_=2*f,d=a[l+1],y=a[l+2],m=a[l+3],v=i[_++],p=i[_++],g=Math.round(v*(u-1)),E=Math.round(p*(c-1)),T=E*u+g,A=h[4*T]/255*e;n[l+1]=d+d*A,n[l+2]=y+y*A,n[l+3]=m+m*A}t.generateVertexNormals(),t.dirty()},_updateLight:function(t,r){var e=this._earthMesh,n=this._sunLight,i=this._ambientLight,a=t.getModel("light");n.intensity=a.get("sunIntensity"),i.intensity=a.get("ambientIntensity");var o=a.get("time")||new Date,u=s.getPosition(Date.parse(o),0,0),c=Math.cos(u.altitude);n.position.y=-c*Math.cos(u.azimuth),n.position.x=Math.sin(u.altitude),n.position.z=c*Math.sin(u.azimuth),n.lookAt(e.getWorldPosition())},dispose:function(){this.groupGL.removeAll()}})},function(t,r,e){function n(t){this.radius=t||100,this.viewGL=new a}var i=(e(2),e(8),e(1)),a=e(55),o=i.vec3;n.prototype={constructor:n,dimensions:["lng","lat","alt"],type:"globe",dataToPoint:function(t,r){var e=t[0],n=t[1],i=t[2]||0;e=e*Math.PI/180,n=n*Math.PI/180;var a=i+this.radius,o=Math.cos(n)*a;return r=r||[],r[0]=-o*Math.cos(e+Math.PI),r[1]=Math.sin(n)*a,r[2]=o*Math.sin(e+Math.PI),r},pointToData:function(t,r){var e=t[0],n=t[1],i=t[2],a=o.len(t);e/=a,n/=a,i/=a;var s=Math.asin(n),u=Math.atan2(i,-e);u<0&&(u=2*Math.PI+u);var c=180*s/Math.PI,h=180*u/Math.PI-180;return r=r||[],r[0]=h,r[1]=c,r[2]=a-this.radius,r}},t.exports=n},function(t,r,e){function n(t,r){var e=t.getBoxLayoutParams(),n=o.getLayoutRect(e,{width:r.getWidth(),height:r.getHeight()});this.viewGL.setViewport(n.x,n.y,n.width,n.height),this.radius=t.get("globeRadius")}var i=e(52),a=e(2),o=e(61),s={dimensions:i.prototype.dimensions,create:function(t,r){var e=[];t.eachComponent("globe",function(t){var a=new i;t.coordinateSystem=a,e.push(a),a.resize=n,a.resize(t,r)}),t.eachSeries(function(t){if("globe"===t.get("coordinateSystem")){var r=t.get("globeIndex"),n=e[r];n||console.warn("globe %s not exists",r),t.coordinateSystem=n}})}};a.registerCoordinateSystem("globe",s),t.exports=s},function(t,r,e){var n=e(64),i=e(81),a=e(93),o=e(13),s=function(t,r){a.call(this),this.id=t,this.zr=r;try{this.renderer=new n({clear:0}),this.renderer.resize(r.painter.getWidth(),r.painter.getHeight())}catch(t){return this.renderer=null,this.dom=document.createElement("div"),this.dom.style.cssText="position:absolute; left: 0; top: 0; right: 0; bottom: 0;",this.dom.className="ecgl-nowebgl",this.dom.innerHTML="Sorry, your browser does support WebGL",void console.error(t)}this.dom=this.renderer.canvas;var e=this.dom.style;e.position="absolute",e.left="0",e.top="0",this.views=[],this._initHandlers()};s.prototype._initHandlers=function(){this.on("click",this._clickHandler,this),this.on("mousedown",this._mouseDownHandler,this),this.on("mouseup",this._mouseUpHandler,this),this.on("mousemove",this._mouseMoveHandler,this),this._picking=new i({renderer:this.renderer})},s.prototype.addView=function(t){if(t.layer!==this){this.views.push(t),t.layer=this;var r=this.zr;t.scene.traverse(function(t){t.__zr=r,t.addAnimatorsToZr&&t.addAnimatorsToZr(r)})}},s.prototype.removeView=function(t){if(t.layer===this){var r=this.views.indexOf(t);r>=0&&(this.views.splice(r,1),t.scene.traverse(function(t){var r=t.__zr;t.__zr=null,r&&t.removeAnimatorsFromZr&&t.removeAnimatorsFromZr(r)},this),t.layer=null)}},s.prototype.resize=function(t,r){var e=this.renderer;e.resize(t,r)},s.prototype.clear=function(){var t=this.renderer.gl;t.clearColor(0,0,0,0),t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT)},s.prototype.clearDepth=function(){var t=this.renderer.gl;t.clear(t.DEPTH_BUFFER_BIT)},s.prototype.clearColor=function(){var t=this.renderer.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},s.prototype.needsRefresh=function(){this.zr.refresh()},s.prototype.refresh=function(){this.clear(),this.renderer.saveViewport();for(var t=0;t<this.views.length;t++){var r=this.views[t];this.renderer.setViewport(r.viewport),this.renderer.render(r.scene,r.camera)}this.renderer.restoreViewport()},s.prototype.renderScene=function(t){this.renderer.render(t,this.camera)},s.prototype.dispose=function(){this.renderer.disposeScene(this.scene)},s.prototype.onmousedown=function(t){t=t.event;var r=this.pickObject(t.offsetX,t.offsetY);r&&this._dispatchEvent("mousedown",t,r)},s.prototype.onmousemove=function(t){t=t.event;var r=this.pickObject(t.offsetX,t.offsetY);r&&this._dispatchEvent("mousemove",t,r)},s.prototype.onmouseup=function(t){t=t.event;var r=this.pickObject(t.offsetX,t.offsetY);r&&this._dispatchEvent("mouseup",t,r)},s.prototype.onclick=function(t){t=t.event;var r=this.pickObject(t.offsetX,t.offsetY);r&&this._dispatchEvent("click",t,r)},s.prototype.pickObject=function(t,r){for(var e=[],n=0;n<this.views.length;n++){var i=this.views[n];i.containPoint(t,r)&&(this._picking.scene=i.scene,this._picking.camera=i.camera,this._picking.pickAll(t,r,e))}return e.sort(function(t,r){return t.distance-r.distance}),e[0]},s.prototype._dispatchEvent=function(t,r,e){var n=e.target;for(e.cancelBubble=!1,e.event=r,e.type=t;n&&(n.trigger(t,e),n=n.getParent(),!e.cancelBubble););},o.inherits(s,a),t.exports=s},function(t,r,e){function n(t){t=t||"perspective",this.layer=null,this.scene=new i,this.viewport={x:0,y:0,width:0,height:0},this.setCameraType(t)}var i=e(16),a=e(67),o=e(66);n.prototype.setCameraType=function(t){this.camera="perspective"===t?new a:new o},n.prototype.setViewport=function(t,r,e,n){this.camera instanceof a&&(this.camera.aspect=e/n),this.viewport.x=t,this.viewport.y=r,this.viewport.width=e,this.viewport.height=n},n.prototype.containPoint=function(t,r){var e=this.viewport;return t>=e.x&&r>=e.y&&t<=e.x+e.width&&r<=e.y+e.height},n.prototype.add=function(t){this.scene.add(t)},n.prototype.remove=function(t){this.scene.remove(t)},n.prototype.removeAll=function(t){this.scene.removeAll(t)},t.exports=n},function(t,r,e){function n(t){throw new Error(t+" version is too old, needs "+h[t]+" or higher")}function i(t,r){t.replace(".","")-0<h[r].replace(".","")-0&&n(r),console.log("Loaded "+r+", version "+t)}function a(t){this._layers={},this._zr=t}var o={version:"1.0.0",dependencies:{echarts:"3.4.0",qtek:"0.3.0"}},s=e(2),u=e(85),c=(e(16),e(54)),h=o.dependencies;i(u,"qtek"),i(s.version,"echarts"),a.prototype.update=function(t,r){function e(t){var r=t.get("zlevel"),e=i._layers,n=e[r];return n||(n=new c("gl-"+r,a),a.painter.insertLayer(r,n)),n}function n(t,r){var e=t.__oldDispose||t.dispose;t.__oldDispose=e,t.dispose=function(){t.viewGL?r.renderer.disposeScene(t.viewGL.scene):r.renderer.disposeNode(t.groupGL),e.apply(this,arguments)}}var i=this,a=r.getZr();t.eachComponent(function(t,i){if("series"!==t){var a=r.getViewOfComponentModel(i),o=a.groupGL,s=i.coordinateSystem;if(o){var u;if(s){if(!s.viewGL)return void console.error("Can't find viewGL in coordinateSystem of component "+i.id);u=s.viewGL}else{if(!i.viewGL)return void console.error("Can't find viewGL of component "+i.id);u=s.viewGL}var u=s.viewGL,c=e(i);c.addView(u),n(a,c)}}}),t.eachSeries(function(t){var i=r.getViewOfSeriesModel(t),a=i.groupGL,o=t.coordinateSystem;if(a){var s;if(o){if(!o.viewGL)return void console.error("Can't find viewGL in coordinateSystem of series "+t.id);s=o.viewGL}else{if(!t.viewGL)return void console.error("Can't find viewGL of series "+t.id);s=o.viewGL}var s=o.viewGL,u=e(t);u.addView(s),n(i,u)}})},s.registerPostUpdate(function(t,r){var e=r.getZr(),n=e.__egl=e.__egl||new a(e);n.update(t,r)}),t.exports=a},function(t,r,e){var n=e(6),i=e(14),a=e(3),o=e(20),s=n.extend(function(){return{zr:null,origin:new a,minDistance:.5,maxDistance:1.5,autoRotateAfterStill:0,mode:"rotate",_camera:null,_needsUpdate:!1,_rotating:!1,_rotateY:0,_rotateX:0,_mouseX:0,_mouseY:0,_rotateVelocity:new i,_panVelocity:new i,_distance:100,_zoomSpeed:0,_animating:!1,_stillTimeout:0,_animators:[]}},{init:function(){this._animating=!1,this.zr.on("mousedown",this._mouseDownHandler,this),this.zr.on("mousewheel",this._mouseWheelHandler,this),this._decomposeRotation(),this.zr.animation.on("frame",this._update,this)},dispose:function(){this.zr.off("mousedown",this._mouseDownHandler),this.zr.off("mousemove",this._mouseMoveHandler),this.zr.off("mouseup",this._mouseUpHandler),this.zr.off("mousewheel",this._mouseWheelHandler),this.stopAllAnimation()},getDistance:function(){return this._distance},setDistance:function(t){this._distance=t,this._needsUpdate=!1},setCamera:function(t){this._camera=t,this._decomposeRotation()},rotateTo:function(t){var r;if(t.rotation)r=t.rotation;else{r=new o;var e=new a;a.negate(e,t.z),r.setAxes(e,t.x,t.y)}},zoomTo:function(t){var r=this.zr,e=t.distance,n=this;return e=Math.max(Math.min(this.maxDistance,e),this.minDistance),this._animating=!0,this._addAnimator(r.animation.animate(this).when(t.time||1e3,{_distance:e}).during(function(){n._setDistance(n._distance),r.refresh()}).done(function(){n._animating=!1}).start(t.easing||"Linear"))},stopAllAnimation:function(){for(var t=0;t<this._animators.length;t++)this._animators[t].stop();this._animators.length=0,this._animating=!1},_update:function(t){this._animating||(this._camera.rotation.identity(),this._camera.update(),this._updateDistance(t),"rotate"===this.mode?this._updateRotate(t):"pan"===this.mode&&this._updatePan(t),this._needsUpdate&&(this.zr.refresh(),this.trigger("update"),this._needsUpdate=!1))},_updateRotate:function(t){var r=this._rotateVelocity;this._rotateY=(r.y+this._rotateY)%(2*Math.PI),this._rotateX=(r.x+this._rotateX)%(2*Math.PI),this._rotateX=Math.max(Math.min(this._rotateX,Math.PI/2),-Math.PI/2),this._camera.rotateAround(this.origin,a.UP,-this._rotateY);var e=this._camera.localTransform.x;this._camera.rotateAround(this.origin,e,-this._rotateX),this._vectorDamping(r,.8),this._rotating?(this._rotateY-=1e-4*t,this._needsUpdate=!0):r.len()>0&&(this._needsUpdate=!0)},_updateDistance:function(t){this._setDistance(this._distance+this._zoomSpeed),this._zoomSpeed*=.8,Math.abs(this._zoomSpeed)>.001&&(this._needsUpdate=!0)},_setDistance:function(t){this._distance=Math.max(Math.min(t,this.maxDistance),this.minDistance);var t=this._distance,r=this._camera,e=this.origin;r.position.copy(e).scaleAndAdd(r.worldTransform.z,t)},_updatePan:function(t){var r=this._panVelocity;this._vectorDamping(r,.8),r.len()>0&&(this._needsUpdate=!0)},_startCountingStill:function(){clearTimeout(this._stillTimeout);var t=this.autoRotateAfterStill,r=this;!isNaN(t)&&t>0&&(this._stillTimeout=setTimeout(function(){r._rotating=!0},1e3*t))},_vectorDamping:function(t,r){var e=t.len();e*=r,e<1e-4&&(e=0),t.normalize().scale(e)},_decomposeRotation:function(){!this._camera},_mouseDownHandler:function(t){this._animating||(this.zr.on("mousemove",this._mouseMoveHandler,this),this.zr.on("mouseup",this._mouseUpHandler,this),t=t.event,"rotate"===this.mode&&(this._rotateVelocity.set(0,0),this._rotating=!1,this.autoRotate&&this._startCountingStill()),this._mouseX=t.pageX,this._mouseY=t.pageY)},_mouseMoveHandler:function(t){this._animating||(t=t.event,"rotate"===this.mode?(this._rotateVelocity.y=(t.pageX-this._mouseX)/500,this._rotateVelocity.x=(t.pageY-this._mouseY)/500):"pan"===this.mode&&(this._panVelocity.x=t.pageX-this._mouseX,this._panVelocity.y=-t.pageY+this._mouseY),this._mouseX=t.pageX,this._mouseY=t.pageY)},_mouseWheelHandler:function(t){if(!this._animating){t=t.event;var r=t.wheelDelta||-t.detail;if(0!==r){var e=Math.min(this._distance-this.minDistance,this.maxDistance-this._distance);this._zoomSpeed=r>0?e/40:-e/40,this._rotating=!1,this.autoRotate&&"rotate"===this.mode&&this._startCountingStill()}}},_mouseUpHandler:function(){this.zr.off("mousemove",this._mouseMoveHandler,this),this.zr.off("mouseup",this._mouseUpHandler,this)},_addAnimator:function(t){var r=this._animators;return r.push(t),t.done(function(){var e=r.indexOf(t);e>=0&&r.splice(e,1)}),t}});Object.defineProperty(s.prototype,"autoRotate",{get:function(t){return this._autoRotate},set:function(t){this._autoRotate=t,this._rotating=t}}),t.exports=s},function(t,r,e){var n=e(86),i={_animators:null,getAnimators:function(){return this._animators=this._animators||[],this._animators},animate:function(t,r){this._animators=this._animators||[];var e,i=this;if(t){for(var a=t.split("."),o=i,s=0,u=a.length;s<u;s++)o&&(o=o[a[s]]);o&&(e=o)}else e=i;var c=this._animators,h=new n(e,r),f=this;h.during(function(){f.__zr&&f.__zr.refresh()}).done(function(){var t=c.indexOf(h);t>=0&&c.splice(t,1)}),c.push(h),this.__zr&&this.__zr.animation.addAnimator(h)},stopAnimation:function(t){this._animators=this._animators||[];for(var r=this._animators,e=r.length,n=0;n<e;n++)r[n].stop(t);return r.length=0,this},addAnimatorsToZr:function(t){if(this._animators)for(var r=0;r<this._animators.length;r++)t.animation.addAnimator(this._animators[r])},removeAnimatorsFromZr:function(t){if(this._animators)for(var r=0;r<this._animators.length;r++)t.animation.removeAnimator(this._animators[r])}};t.exports=i},function(t,r){function e(t){return t.valueOf()/g-.5+E}function n(t){return e(t)-T}function i(t,r){return v(_(t)*d(A)-y(r)*_(A),d(t))}function a(t,r){return m(_(r)*d(A)+d(r)*_(A)*_(t))}function o(t,r,e){return v(_(t),d(t)*_(r)-y(e)*d(r))}function s(t,r,e){return m(_(r)*_(e)+d(r)*d(e)*d(t))}function u(t,r){return p*(280.16+360.9856235*t)-r}function c(t){return p*(357.5291+.98560028*t)}function h(t){var r=p*(1.9148*_(t)+.02*_(2*t)+3e-4*_(3*t)),e=102.9372*p;return t+r+e+l}function f(t){var r=c(t),e=h(r);return{dec:a(e,0),ra:i(e,0)}}var l=Math.PI,_=Math.sin,d=Math.cos,y=Math.tan,m=Math.asin,v=Math.atan2,p=l/180,g=864e5,E=2440588,T=2451545,A=23.4397*p,b={};b.getPosition=function(t,r,e){var i=p*-e,a=p*r,c=n(t),h=f(c),l=u(c,i)-h.ra;return{azimuth:o(l,a,h.dec),altitude:s(l,a,h.dec)}},t.exports=b},function(t,r,e){var n=e(13),i=e(22),a=e(89),o={};o.addCommas=function(t){return isNaN(t)?"-":(t=(t+"").split("."),t[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+(t.length>1?"."+t[1]:""))},o.toCamelCase=function(t,r){return t=(t||"").toLowerCase().replace(/-(.)/g,function(t,r){return r.toUpperCase()}),r&&t&&(t=t.charAt(0).toUpperCase()+t.slice(1)),t},o.normalizeCssArray=function(t){var r=t.length;return"number"==typeof t?[t,t,t,t]:2===r?[t[0],t[1],t[0],t[1]]:3===r?[t[0],t[1],t[2],t[1]]:t};var s=o.encodeHTML=function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},u=["a","b","c","d","e","f","g"],c=function(t,r){return"{"+t+(null==r?"":r)+"}"};o.formatTpl=function(t,r,e){n.isArray(r)||(r=[r]);var i=r.length;if(!i)return"";for(var a=r[0].$vars||[],o=0;o<a.length;o++){var h=u[o],f=c(h,0);t=t.replace(c(h),e?s(f):f)}for(var l=0;l<i;l++)for(var _=0;_<a.length;_++){var f=r[l][a[_]];t=t.replace(c(u[_],l),e?s(f):f)}return t};var h=function(t){return t<10?"0"+t:t};o.formatTime=function(t,r){"week"!==t&&"month"!==t&&"quarter"!==t&&"half-year"!==t&&"year"!==t||(t="MM-dd\nyyyy");var e=i.parseDate(r),n=e.getFullYear(),a=e.getMonth()+1,o=e.getDate(),s=e.getHours(),u=e.getMinutes(),c=e.getSeconds();return t=t.replace("MM",h(a)).toLowerCase().replace("yyyy",n).replace("yy",n%100).replace("dd",h(o)).replace("d",o).replace("hh",h(s)).replace("h",s).replace("mm",h(u)).replace("m",u).replace("ss",h(c)).replace("s",c);
},o.capitalFirst=function(t){return t?t.charAt(0).toUpperCase()+t.substr(1):t},o.truncateText=a.truncateText,t.exports=o},function(t,r,e){"use strict";function n(t,r,e,n,i){var a=0,o=0;null==n&&(n=1/0),null==i&&(i=1/0);var s=0;r.eachChild(function(u,c){var h,f,l=u.position,_=u.getBoundingRect(),d=r.childAt(c+1),y=d&&d.getBoundingRect();if("horizontal"===t){var m=_.width+(y?-y.x+_.x:0);h=a+m,h>n||u.newline?(a=0,h=m,o+=s+e,s=_.height):s=Math.max(s,_.height)}else{var v=_.height+(y?-y.y+_.y:0);f=o+v,f>i||u.newline?(a+=s+e,o=0,f=v,s=_.width):s=Math.max(s,_.width)}u.newline||(l[0]=a,l[1]=o,"horizontal"===t?a=h+e:o=f+e)})}var i=e(13),a=e(31),o=e(22),s=e(60),u=o.parsePercent,c=i.each,h={},f=h.LOCATION_PARAMS=["left","right","top","bottom","width","height"];h.box=n,h.vbox=i.curry(n,"vertical"),h.hbox=i.curry(n,"horizontal"),h.getAvailableSize=function(t,r,e){var n=r.width,i=r.height,a=u(t.x,n),o=u(t.y,i),c=u(t.x2,n),h=u(t.y2,i);return(isNaN(a)||isNaN(parseFloat(t.x)))&&(a=0),(isNaN(c)||isNaN(parseFloat(t.x2)))&&(c=n),(isNaN(o)||isNaN(parseFloat(t.y)))&&(o=0),(isNaN(h)||isNaN(parseFloat(t.y2)))&&(h=i),e=s.normalizeCssArray(e||0),{width:Math.max(c-a-e[1]-e[3],0),height:Math.max(h-o-e[0]-e[2],0)}},h.getLayoutRect=function(t,r,e){e=s.normalizeCssArray(e||0);var n=r.width,i=r.height,o=u(t.left,n),c=u(t.top,i),h=u(t.right,n),f=u(t.bottom,i),l=u(t.width,n),_=u(t.height,i),d=e[2]+e[0],y=e[1]+e[3],m=t.aspect;switch(isNaN(l)&&(l=n-h-y-o),isNaN(_)&&(_=i-f-d-c),isNaN(l)&&isNaN(_)&&(m>n/i?l=.8*n:_=.8*i),null!=m&&(isNaN(l)&&(l=m*_),isNaN(_)&&(_=l/m)),isNaN(o)&&(o=n-h-l-y),isNaN(c)&&(c=i-f-_-d),t.left||t.right){case"center":o=n/2-l/2-e[3];break;case"right":o=n-l-y}switch(t.top||t.bottom){case"middle":case"center":c=i/2-_/2-e[0];break;case"bottom":c=i-_-d}o=o||0,c=c||0,isNaN(l)&&(l=n-o-(h||0)),isNaN(_)&&(_=i-c-(f||0));var v=new a(o+e[3],c+e[0],l,_);return v.margin=e,v},h.positionElement=function(t,r,e,n,o){var s=!o||!o.hv||o.hv[0],u=!o||!o.hv||o.hv[1],c=o&&o.boundingMode||"all";if(s||u){var f;if("raw"===c)f="group"===t.type?new a(0,0,+r.width||0,+r.height||0):t.getBoundingRect();else if(f=t.getBoundingRect(),t.needLocalTransform()){var l=t.getLocalTransform();f=f.clone(),f.applyTransform(l)}r=h.getLayoutRect(i.defaults({width:f.width,height:f.height},r),e,n);var _=t.position,d=s?r.x-f.x:0,y=u?r.y-f.y:0;t.attr("position","raw"===c?[d,y]:[_[0]+d,_[1]+y])}},h.mergeLayoutParam=function(t,r,e){function n(n){var i={},s=0,u={},h=0,f=e.ignoreSize?1:2;if(c(n,function(r){u[r]=t[r]}),c(n,function(t){a(r,t)&&(i[t]=u[t]=r[t]),o(i,t)&&s++,o(u,t)&&h++}),h!==f&&s){if(s>=f)return i;for(var l=0;l<n.length;l++){var _=n[l];if(!a(i,_)&&a(t,_)){i[_]=t[_];break}}return i}return u}function a(t,r){return t.hasOwnProperty(r)}function o(t,r){return null!=t[r]&&"auto"!==t[r]}function s(t,r,e){c(t,function(t){r[t]=e[t]})}!i.isObject(e)&&(e={});var u=["width","left","right"],h=["height","top","bottom"],f=n(u),l=n(h);s(u,t,f),s(h,t,l)},h.getLayoutParams=function(t){return h.copyLayoutParams({},t)},h.copyLayoutParams=function(t,r){return r&&t&&c(f,function(e){r.hasOwnProperty(e)&&(t[e]=r[e])}),t},t.exports=h},function(t,r,e){"use strict";var n=e(24),i=e(4),a=e(5),o=e(12),s=e(9),u=e(1),c=u.vec3,h=u.mat4,f=c.add,l=c.create,_=Array.prototype.slice,d=n.DynamicAttribute,y=n.extend(function(){return{attributes:{position:new d("position","float",3,"POSITION"),texcoord0:new d("texcoord0","float",2,"TEXCOORD_0"),texcoord1:new d("texcoord1","float",2,"TEXCOORD_1"),normal:new d("normal","float",3,"NORMAL"),tangent:new d("tangent","float",4,"TANGENT"),color:new d("color","float",4,"COLOR"),weight:new d("weight","float",3,"WEIGHT"),joint:new d("joint","float",4,"JOINT"),barycentric:new d("barycentric","float",3,null)},dynamic:!0,hint:a.DYNAMIC_DRAW,faces:[],_enabledAttributes:null,_arrayChunks:[]}},{updateBoundingBox:function(){var t=this.boundingBox;t||(t=this.boundingBox=new i),t.updateFromVertices(this.attributes.position.value)},dirty:function(t){if(t)this._cache.dirtyAll(t),this._cache.dirtyAll(),this._enabledAttributes=null;else{this.dirty("indices");for(var r in this.attributes)this.dirty(r)}},getFace:function(t,r){if(t<this.faceCount&&t>=0)return r||(r=c.create()),c.copy(r,this.faces[t]),r},setFace:function(t,r){this.faces[t]=this.faces[t]||l(),c.copy(this.faces[t],r)},isUseFace:function(){return this.useFace&&this.faces.length>0},isSplitted:function(){return this.vertexCount>65535},createAttribute:function(t,r,e,n){var i=new d(t,r,e,n);return this.attributes[t]=i,this._attributeList.push(t),i},removeAttribute:function(t){var r=this._attributeList,e=r.indexOf(t);return e>=0&&(r.splice(e,1),delete this.attributes[t],!0)},getEnabledAttributes:function(){var t=this._enabledAttributes,r=this._attributeList;if(t)return t;for(var e={},n=this.vertexCount,i=0;i<r.length;i++){var a=r[i],o=this.attributes[a];o.value.length&&o.value.length===n&&(e[a]=o)}return this._enabledAttributes=e,e},_getDirtyAttributes:function(){var t=this.getEnabledAttributes(),r=this._cache;if(r.miss("chunks"))return t;var e={},n=!0;for(var i in t)r.isDirty(i)&&(e[i]=t[i],n=!1);return n?void 0:e},getChunkNumber:function(){return this._arrayChunks.length},getBufferChunks:function(t){var r=this._cache;if(r.use(t.__GLID__),r.isDirty()){var e=this._getDirtyAttributes(),n=r.isDirty("indices");if(n=n&&this.isUseFace(),e){this._updateAttributesAndIndicesArrays(e,n,null!=o.getExtension(t,"OES_element_index_uint")),this._updateBuffer(t,e,n);for(var i in e)r.fresh(i);r.fresh("indices"),r.fresh()}}return r.get("chunks")},_updateAttributesAndIndicesArrays:function(t,r,e){var n=this,i=this.vertexCount,a=[],o=[],u={};for(var c in t)switch(t[c].type){case"byte":u[c]=s.Int8Array;break;case"ubyte":u[c]=s.Uint8Array;break;case"short":u[c]=s.Int16Array;break;case"ushort":u[c]=s.Uint16Array;break;default:u[c]=s.Float32Array}var h=function(r){if(n._arrayChunks[r])return n._arrayChunks[r];var e={attributeArrays:{},indicesArray:null};for(var o in t)e.attributeArrays[o]=null;for(var s=0;s<i;s++)a[s]=-1;return n._arrayChunks.push(e),e},f=Object.keys(t);if(i>65535&&this.isUseFace()&&!e){var l,_=0,d=[0],y=[];for(v=0;v<i;v++)y[v]=-1,a[v]=-1;if(r)for(v=0;v<this.faces.length;v++)o[v]=[0,0,0];l=h(_);for(var m=0,v=0;v<this.faces.length;v++){var p=this.faces[v],g=o[v];m+3>65535&&(_++,d[_]=v,m=0,l=h(_));for(var E=0;E<3;E++){for(var T=p[E],A=a[T]===-1,b=0;b<f.length;b++){var c=f[b],x=l.attributeArrays[c],R=t[c].value,I=t[c].size;if(x||(x=l.attributeArrays[c]=[]),A){1===I&&(x[m]=R[T]);for(var S=0;S<I;S++)x[m*I+S]=R[T][S]}}A?(a[T]=m,g[E]=m,m++):g[E]=a[T]}}for(var N=0;N<this._arrayChunks.length;N++){var M=this._arrayChunks[N];for(var c in M.attributeArrays){var w=M.attributeArrays[c];w instanceof Array&&(M.attributeArrays[c]=new u[c](w))}}if(r)for(var O,L,C,M,N=0;N<this._arrayChunks.length;N++){O=d[N],L=d[N+1]||this.faces.length,C=0,M=this._arrayChunks[N];var P=M.indicesArray;P||(P=M.indicesArray=new Uint16Array(3*(L-O)));for(var v=O;v<L;v++)P[C++]=o[v][0],P[C++]=o[v][1],P[C++]=o[v][2]}}else{var M=h(0);if(r){var P=M.indicesArray,D=this.faces.length;if(!P||3*D!==P.length){var U=i>65535?Uint32Array:Uint16Array;P=M.indicesArray=new U(3*this.faces.length)}for(var C=0,v=0;v<D;v++)P[C++]=this.faces[v][0],P[C++]=this.faces[v][1],P[C++]=this.faces[v][2]}for(var c in t){var R=t[c].value,I=(t[c].type,t[c].size),x=M.attributeArrays[c],F=i*I;if(x&&x.length===F||(x=new u[c](F),M.attributeArrays[c]=x),1===I)for(var v=0;v<R.length;v++)x[v]=R[v];else for(var C=0,v=0;v<R.length;v++)for(var S=0;S<I;S++)x[C++]=R[v][S]}}},_updateBuffer:function(t,r,e){var i=this._cache.get("chunks"),a=!1;if(!i){i=[];for(var o=0;o<this._arrayChunks.length;o++)i[o]={attributeBuffers:[],indicesBuffer:null};this._cache.put("chunks",i),a=!0}for(var s=0;s<this._arrayChunks.length;s++){var u=i[s];u||(u=i[s]={attributeBuffers:[],indicesBuffer:null});var c=u.attributeBuffers,h=u.indicesBuffer,f=this._arrayChunks[s],l=f.attributeArrays,_=f.indicesArray,d=0,y=0;for(var m in r){var v,p=r[m],g=p.type,E=p.semantic,T=p.size;if(!a){for(var o=y;o<c.length;o++)if(c[o].name===m){v=c[o],y=o+1;break}if(!v)for(var o=y-1;o>=0;o--)if(c[o].name===m){v=c[o],y=o;break}}var A;A=v?v.buffer:t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,A),t.bufferData(t.ARRAY_BUFFER,l[m],this.hint),c[d++]=new n.AttributeBuffer(m,g,A,T,E)}c.length=d,e&&(h||(h=new n.IndicesBuffer(t.createBuffer()),u.indicesBuffer=h),h.count=_.length,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,_,this.hint))}},generateVertexNormals:function(){for(var t=this.faces,r=t.length,e=this.attributes,n=e.position.value,i=e.normal.value,a=l(),o=l(),s=l(),u=0;u<i.length;u++)c.set(i[u],0,0,0);for(var u=i.length;u<n.length;u++)i[u]=[0,0,0];for(var h=0;h<r;h++){var _=t[h],d=_[0],y=_[1],m=_[2],v=n[d],p=n[y],g=n[m];c.sub(o,v,p),c.sub(s,p,g),c.cross(a,o,s),f(i[d],i[d],a),f(i[y],i[y],a),f(i[m],i[m],a)}for(var u=0;u<i.length;u++)c.normalize(i[u],i[u])},generateFaceNormals:function(){this.isUniqueVertex()||this.generateUniqueVertex();for(var t=this.faces,r=t.length,e=this.attributes,n=e.position.value,i=e.normal.value,a=l(),o=l(),s=l(),u=i.length===n.length,h=0;h<r;h++){var f=t[h],d=f[0],y=f[1],m=f[2],v=n[d],p=n[y],g=n[m];c.sub(o,v,p),c.sub(s,p,g),c.cross(a,o,s),c.normalize(a,a),u?(c.copy(i[d],a),c.copy(i[y],a),c.copy(i[m],a)):i[d]=i[y]=i[m]=_.call(a)}},generateTangents:function(){for(var t=this.attributes,r=t.texcoord0.value,e=t.position.value,n=t.tangent.value,i=t.normal.value,a=[],o=[],s=this.vertexCount,u=0;u<s;u++)a[u]=[0,0,0],o[u]=[0,0,0];for(var h=[0,0,0],l=[0,0,0],u=0;u<this.faces.length;u++){var _=this.faces[u],d=_[0],y=_[1],m=_[2],v=r[d],p=r[y],g=r[m],E=e[d],T=e[y],A=e[m],b=T[0]-E[0],x=A[0]-E[0],R=T[1]-E[1],I=A[1]-E[1],S=T[2]-E[2],N=A[2]-E[2],M=p[0]-v[0],w=g[0]-v[0],O=p[1]-v[1],L=g[1]-v[1],C=1/(M*L-O*w);h[0]=(L*b-O*x)*C,h[1]=(L*R-O*I)*C,h[2]=(L*S-O*N)*C,l[0]=(M*x-w*b)*C,l[1]=(M*I-w*R)*C,l[2]=(M*N-w*S)*C,f(a[d],a[d],h),f(a[y],a[y],h),f(a[m],a[m],h),f(o[d],o[d],l),f(o[y],o[y],l),f(o[m],o[m],l)}for(var P=[0,0,0,0],D=[0,0,0],u=0;u<s;u++){var U=i[u],F=a[u];c.scale(P,U,c.dot(U,F)),c.sub(P,F,P),c.normalize(P,P),c.cross(D,U,F),P[3]=c.dot(D,o[u])<0?-1:1,n[u]=P.slice()}},isUniqueVertex:function(){return!this.isUseFace()||this.vertexCount===3*this.faces.length},generateUniqueVertex:function(){for(var t=[],r=0;r<this.vertexCount;r++)t[r]=0;for(var e=this.vertexCount,n=this.getEnabledAttributes(),i=this.faces,a=Object.keys(n),r=0;r<i.length;r++)for(var o=i[r],s=0;s<3;s++){var u=o[s];if(t[u]>0){for(var c=0;c<a.length;c++){var h=a[c],f=n[h].value,l=n[h].size;1===l?f.push(f[u]):f.push(_.call(f[u]))}o[s]=e,e++}t[u]++}this.dirty()},generateBarycentric:function(){var t=[1,0,0],r=[0,0,1],e=[0,1,0];return function(){this.isUniqueVertex()||this.generateUniqueVertex();var n=this.attributes.barycentric.value;if(n.length!=3*this.faces.length)for(var i,a,o,s,u=0;u<this.faces.length;u++)s=this.faces[u],i=s[0],a=s[1],o=s[2],n[i]=t,n[a]=r,n[o]=e}}(),convertToStatic:function(t,r){if(this._updateAttributesAndIndicesArrays(this.getEnabledAttributes(),!0,r),this._arrayChunks.length>1)console.warn("Large geometry will discard chunks when convert to StaticGeometry");else if(0===this._arrayChunks.length)return t;var e=this._arrayChunks[0],n=this.getEnabledAttributes();for(var a in n){var o=n[a],s=t.attributes[a];s||(s=t.attributes[a]={type:o.type,size:o.size,value:null},o.semantic&&(s.semantic=o.semantic)),s.value=e.attributeArrays[a]}return t.faces=e.indicesArray,this.boundingBox&&(t.boundingBox=new i,t.boundingBox.min.copy(this.boundingBox.min),t.boundingBox.max.copy(this.boundingBox.max)),t},applyTransform:function(t){var r=this.attributes,e=r.position.value,n=r.normal.value,i=r.tangent.value,a=c.transformMat4;t=t._array;for(var o=0;o<e.length;o++)a(e[o],e[o],t);var s=h.create();h.invert(s,t),h.transpose(s,s);for(var o=0;o<n.length;o++)a(n[o],n[o],s);for(var o=0;o<i.length;o++)a(i[o],i[o],s);this.boundingBox&&this.updateBoundingBox()},dispose:function(t){var r=this._cache;r.use(t.__GLID__);var e=r.get("chunks");if(e)for(var n=0;n<e.length;n++)for(var i=e[n],a=0;a<i.attributeBuffers.length;a++){var o=i.attributeBuffers[a];t.deleteBuffer(o.buffer)}r.deleteContext(t.__GLID__)}});Object.defineProperty&&(Object.defineProperty(y.prototype,"vertexCount",{enumerable:!1,get:function(){var t=this.attributes[this.mainAttribute];return t&&t.value?t.value.length:0}}),Object.defineProperty(y.prototype,"faceCount",{enumerable:!1,get:function(){return this.faces.length}})),d.Attribute=n.DynamicAttribute,t.exports=y},function(t,r,e){"use strict";var n=e(26),i=e(5),a=n.extend({skeleton:null,joints:null},function(){this.joints||(this.joints=[])},{render:function(t,r){var e=r||this.material;if(this.skeleton){var i=this.skeleton.getSubSkinMatrices(this.__GUID__,this.joints);e.shader.setUniformOfSemantic(t,"SKIN_MATRIX",i)}return n.prototype.render.call(this,t,r)}});a.POINTS=i.POINTS,a.LINES=i.LINES,a.LINE_LOOP=i.LINE_LOOP,a.LINE_STRIP=i.LINE_STRIP,a.TRIANGLES=i.TRIANGLES,a.TRIANGLE_STRIP=i.TRIANGLE_STRIP,a.TRIANGLE_FAN=i.TRIANGLE_FAN,a.BACK=i.BACK,a.FRONT=i.FRONT,a.FRONT_AND_BACK=i.FRONT_AND_BACK,a.CW=i.CW,a.CCW=i.CCW,t.exports=a},function(t,r,e){"use strict";var n=e(6),i=e(12),a=e(5),o=(e(9),e(4)),s=e(8),u=e(82),c=e(25),h=e(14),f=e(17);f.import(e(84));var l=e(1),_=l.mat4,d=l.vec3,y=_.create,m=0,v={},p=n.extend(function(){return{canvas:null,_width:100,_height:100,devicePixelRatio:window.devicePixelRatio||1,color:[0,0,0,0],clear:17664,alpha:!0,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,throwError:!0,gl:null,viewport:{},__currentFrameBuffer:null,_viewportStack:[],_clearStack:[],_sceneRendering:null}},function(){this.canvas||(this.canvas=document.createElement("canvas"));var t=this.canvas;try{var r={alpha:this.alpha,depth:this.depth,stencil:this.stencil,antialias:this.antialias,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer};if(this.gl=t.getContext("webgl",r)||t.getContext("experimental-webgl",r),!this.gl)throw new Error;null==this.gl.__GLID__&&(this.gl.__GLID__=m++,i.initialize(this.gl)),this.resize()}catch(t){throw"Error creating WebGL Context "+t}},{resize:function(t,r){var e=this.canvas,n=this.devicePixelRatio;null!=t?(e.style.width=t+"px",e.style.height=r+"px",e.width=t*n,e.height=r*n,this._width=t,this._height=r):(this._width=e.width/n,this._height=e.height/n),this.setViewport(0,0,this._width,this._height)},getWidth:function(){return this._width},getHeight:function(){return this._height},getViewportAspect:function(){var t=this.viewport;return t.width/t.height},setDevicePixelRatio:function(t){this.devicePixelRatio=t,this.resize(this._width,this._height)},getDevicePixelRatio:function(){return this.devicePixelRatio},getExtension:function(t){return i.getExtension(this.gl,t)},setViewport:function(t,r,e,n,i){if("object"==typeof t){var a=t;t=a.x,r=a.y,e=a.width,n=a.height,i=a.devicePixelRatio}i=i||this.devicePixelRatio,this.gl.viewport(t*i,r*i,e*i,n*i),this.viewport={x:t,y:r,width:e,height:n,devicePixelRatio:i}},saveViewport:function(){this._viewportStack.push(this.viewport)},restoreViewport:function(){this._viewportStack.length>0&&this.setViewport(this._viewportStack.pop())},saveClear:function(){this._clearStack.push(this.clear)},restoreClear:function(){this._clearStack.length>0&&(this.clear=this._clearStack.pop())},bindSceneRendering:function(t){this._sceneRendering=t},beforeRenderObject:function(){},afterRenderObject:function(){},render:function(t,r,e,n){var i=this.gl;this._sceneRendering=t;var a=this.color;if(this.clear){i.colorMask(!0,!0,!0,!0),i.depthMask(!0);var o=this.viewport,s=!1,u=o.devicePixelRatio;(o.width!==this._width||o.height!==this._height||u&&u!==this.devicePixelRatio||o.x||o.y)&&(s=!0,i.enable(i.SCISSOR_TEST),i.scissor(o.x*u,o.y*u,o.width*u,o.height*u)),i.clearColor(a[0],a[1],a[2],a[3]),i.clear(this.clear),s&&i.disable(i.SCISSOR_TEST)}e||t.update(!1),r.getScene()||r.update(!0);var c=t.opaqueQueue,h=t.transparentQueue,f=t.material;if(t.trigger("beforerender",this,t,r),h.length>0)for(var l=y(),m=d.create(),v=0;v<h.length;v++){var p=h[v];_.multiplyAffine(l,r.viewMatrix._array,p.worldTransform._array),d.transformMat4(m,p.position._array,l),p.__depth=m[2]}c.sort(this.opaqueSortFunc),h.sort(this.transparentSortFunc),t.trigger("beforerender:opaque",this,c),t.viewBoundingBoxLastFrame.min.set(1/0,1/0,1/0),t.viewBoundingBoxLastFrame.max.set(-(1/0),-(1/0),-(1/0)),i.disable(i.BLEND),i.enable(i.DEPTH_TEST);var g=this.renderQueue(c,r,f,n);t.trigger("afterrender:opaque",this,c,g),t.trigger("beforerender:transparent",this,h),i.enable(i.BLEND);var E=this.renderQueue(h,r,f);t.trigger("afterrender:transparent",this,h,E);var T={};for(var A in g)T[A]=g[A]+E[A];return t.trigger("afterrender",this,t,r,T),this._sceneRendering=null,T},renderQueue:function(t,r,e,n){var i={faceCount:0,vertexCount:0,drawCallCount:0,meshCount:t.length,renderedMeshCount:0},a=this.viewport,o=a.devicePixelRatio,s=[a.x*o,a.y*o,a.width*o,a.height*o],h=this.devicePixelRatio,f=this.__currentFrameBuffer?[this.__currentFrameBuffer.getTextureWidth(),this.__currentFrameBuffer.getTextureHeight()]:[this._width*h,this._height*h],l=[s[2],s[3]];_.copy(g.VIEW,r.viewMatrix._array),_.copy(g.PROJECTION,r.projectionMatrix._array),_.multiply(g.VIEWPROJECTION,r.projectionMatrix._array,g.VIEW),_.copy(g.VIEWINVERSE,r.worldTransform._array),_.invert(g.PROJECTIONINVERSE,g.PROJECTION),_.invert(g.VIEWPROJECTIONINVERSE,g.VIEWPROJECTION);var d,y,m,p,E,T,A,b,x=this.gl,R=this._sceneRendering;if(n){var I=new c({shader:u.get("qtek.prez")}),S=I.shader;b=[],S.bind(x),x.colorMask(!1,!1,!1,!1),x.depthMask(!0),x.enable(x.DEPTH_TEST);for(var N=0;N<t.length;N++){var M=t[N],w=M.worldTransform._array,O=M.geometry;if(_.multiplyAffine(g.WORLDVIEW,g.VIEW,w),!(O.boundingBox&&this.isFrustumCulled(M,R,r,g.WORLDVIEW,g.PROJECTION)||M.skeleton)){_.multiply(g.WORLDVIEWPROJECTION,g.VIEWPROJECTION,w),M.cullFace!==T&&(T=M.cullFace,x.cullFace(T)),M.frontFace!==A&&(A=M.frontFace,x.frontFace(A)),M.culling!==E&&(E=M.culling,E?x.enable(x.CULL_FACE):x.disable(x.CULL_FACE));var L=S.matrixSemantics.WORLDVIEWPROJECTION;S.setUniform(x,L.type,L.symbol,g.WORLDVIEWPROJECTION),M.render(x,I),b.push(M)}}x.depthFunc(x.LEQUAL),x.colorMask(!0,!0,!0,!0),x.depthMask(!1)}else b=t;E=null,T=null,A=null;for(var N=0;N<b.length;N++){var M=b[N],O=M.geometry,w=M.worldTransform._array;if(_.multiplyAffine(g.WORLDVIEW,g.VIEW,w),!O.boundingBox||n||!this.isFrustumCulled(M,R,r,g.WORLDVIEW,g.PROJECTION)){var C=e||M.material;C!==d&&C.updateShader&&C.updateShader(x);var P=C.shader;if(_.copy(g.WORLD,w),_.multiply(g.WORLDVIEWPROJECTION,g.VIEWPROJECTION,w),(P.matrixSemantics.WORLDINVERSE||P.matrixSemantics.WORLDINVERSETRANSPOSE)&&_.invert(g.WORLDINVERSE,w),(P.matrixSemantics.WORLDVIEWINVERSE||P.matrixSemantics.WORLDVIEWINVERSETRANSPOSE)&&_.invert(g.WORLDVIEWINVERSE,g.WORLDVIEW),(P.matrixSemantics.WORLDVIEWPROJECTIONINVERSE||P.matrixSemantics.WORLDVIEWPROJECTIONINVERSETRANSPOSE)&&_.invert(g.WORLDVIEWPROJECTIONINVERSE,g.WORLDVIEWPROJECTION),M.beforeRender(x),this.beforeRenderObject(M,d),y!==P){R&&R.isShaderLightNumberChanged(P)&&R.setShaderLightNumber(P);var D=P.bind(x);if(D){if(v[P.__GUID__])continue;if(v[P.__GUID__]=!0,this.throwError)throw new Error(D);this.trigger("error",D)}P.setUniformOfSemantic(x,"VIEWPORT",s),P.setUniformOfSemantic(x,"WINDOW_SIZE",f),P.setUniformOfSemantic(x,"VIEWPORT_SIZE",l),R&&R.setLightUniforms(P,x),y=P}d!==C&&(n||(C.depthTest!==m&&(C.depthTest?x.enable(x.DEPTH_TEST):x.disable(x.DEPTH_TEST),m=C.depthTest),C.depthMask!==p&&(x.depthMask(C.depthMask),p=C.depthMask)),C.bind(x,d),d=C,C.transparent&&(C.blend?C.blend(x):(x.blendEquationSeparate(x.FUNC_ADD,x.FUNC_ADD),x.blendFuncSeparate(x.SRC_ALPHA,x.ONE_MINUS_SRC_ALPHA,x.ONE,x.ONE_MINUS_SRC_ALPHA))));for(var U=P.matrixSemanticKeys,F=0;F<U.length;F++){var B=U[F],L=P.matrixSemantics[B],k=g[B];if(L.isTranspose){var V=g[L.semanticNoTranspose];_.transpose(k,V)}P.setUniform(x,L.type,L.symbol,k)}M.cullFace!==T&&(T=M.cullFace,x.cullFace(T)),M.frontFace!==A&&(A=M.frontFace,x.frontFace(A)),M.culling!==E&&(E=M.culling,E?x.enable(x.CULL_FACE):x.disable(x.CULL_FACE));var G=M.render(x,e);G&&(i.faceCount+=G.faceCount,i.vertexCount+=G.vertexCount,i.drawCallCount+=G.drawCallCount,i.renderedMeshCount++),this.afterRenderObject(M,G),M.afterRender(x,G)}}return n&&x.depthFunc(x.LESS),i},isFrustumCulled:function(){var t=new o,r=new s;return function(e,n,i,a,o){var s=e.boundingBox||e.geometry.boundingBox;if(r._array=a,t.copy(s),t.applyTransform(r),n&&e.isRenderable()&&e.castShadow&&n.viewBoundingBoxLastFrame.union(t),e.frustumCulling){if(!t.intersectBoundingBox(i.frustum.boundingBox))return!0;r._array=o,t.max._array[2]>0&&t.min._array[2]<0&&(t.max._array[2]=-1e-20),t.applyProjection(r);var u=t.min._array,c=t.max._array;if(c[0]<-1||u[0]>1||c[1]<-1||u[1]>1||c[2]<-1||u[2]>1)return!0}return!1}}(),disposeScene:function(t){this.disposeNode(t,!0,!0),t.dispose()},disposeNode:function(t,r,e){var n={},i=this.gl;t.getParent()&&t.getParent().remove(t),t.traverse(function(t){t.geometry&&r&&t.geometry.dispose(i),t.material&&(n[t.material.__GUID__]=t.material),t.dispose&&t.dispose(i)});for(var a in n){var o=n[a];o.dispose(i,e)}},disposeShader:function(t){t.dispose(this.gl)},disposeGeometry:function(t){t.dispose(this.gl)},disposeTexture:function(t){t.dispose(this.gl)},disposeFrameBuffer:function(t){t.dispose(this.gl)},dispose:function(){i.dispose(this.gl)},screenToNdc:function(t,r,e){e||(e=new h),r=this._height-r;var n=this.viewport,i=e._array;return i[0]=(t-n.x)/n.width,i[0]=2*i[0]-1,i[1]=(r-n.y)/n.height,i[1]=2*i[1]-1,e}});p.opaqueSortFunc=p.prototype.opaqueSortFunc=function(t,r){return t.renderOrder===r.renderOrder?t.material.shader===r.material.shader?t.material===r.material?t.geometry.__GUID__-r.geometry.__GUID__:t.material.__GUID__-r.material.__GUID__:t.material.shader.__GUID__-r.material.shader.__GUID__:t.renderOrder-r.renderOrder},p.transparentSortFunc=p.prototype.transparentSortFunc=function(t,r){return t.renderOrder===r.renderOrder?t.__depth===r.__depth?t.material.shader===r.material.shader?t.material===r.material?t.geometry.__GUID__-r.geometry.__GUID__:t.material.__GUID__-r.material.__GUID__:t.material.shader.__GUID__-r.material.shader.__GUID__:t.__depth-r.__depth:t.renderOrder-r.renderOrder};var g={WORLD:y(),VIEW:y(),PROJECTION:y(),WORLDVIEW:y(),VIEWPROJECTION:y(),WORLDVIEWPROJECTION:y(),WORLDINVERSE:y(),VIEWINVERSE:y(),PROJECTIONINVERSE:y(),WORLDVIEWINVERSE:y(),VIEWPROJECTIONINVERSE:y(),WORLDVIEWPROJECTIONINVERSE:y(),WORLDTRANSPOSE:y(),VIEWTRANSPOSE:y(),PROJECTIONTRANSPOSE:y(),WORLDVIEWTRANSPOSE:y(),VIEWPROJECTIONTRANSPOSE:y(),WORLDVIEWPROJECTIONTRANSPOSE:y(),WORLDINVERSETRANSPOSE:y(),VIEWINVERSETRANSPOSE:y(),PROJECTIONINVERSETRANSPOSE:y(),WORLDVIEWINVERSETRANSPOSE:y(),VIEWPROJECTIONINVERSETRANSPOSE:y(),WORLDVIEWPROJECTIONINVERSETRANSPOSE:y()};p.COLOR_BUFFER_BIT=a.COLOR_BUFFER_BIT,p.DEPTH_BUFFER_BIT=a.DEPTH_BUFFER_BIT,p.STENCIL_BUFFER_BIT=a.STENCIL_BUFFER_BIT,t.exports=p},function(t,r,e){var n=e(27),i=e(12),a=e(5),o=e(80),s=o.isPowerOfTwo,u=n.extend(function(){return{image:null,pixels:null,mipmaps:[]}},{update:function(t){t.bindTexture(t.TEXTURE_2D,this._cache.get("webgl_texture")),this.beforeUpdate(t);var r=this.format,e=this.type;t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this.wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this.wrapT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this.magFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.minFilter);var n=i.getExtension(t,"EXT_texture_filter_anisotropic");if(n&&this.anisotropic>1&&t.texParameterf(t.TEXTURE_2D,n.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),36193===e){var o=i.getExtension(t,"OES_texture_half_float");o||(e=a.FLOAT)}if(this.mipmaps.length)for(var s=this.width,u=this.height,c=0;c<this.mipmaps.length;c++){var h=this.mipmaps[c];this._updateTextureData(t,h,c,s,u,r,e),s/=2,u/=2}else this._updateTextureData(t,this,0,this.width,this.height,r,e),this.useMipmap&&!this.NPOT&&t.generateMipmap(t.TEXTURE_2D);t.bindTexture(t.TEXTURE_2D,null)},_updateTextureData:function(t,r,e,i,a,o,s){r.image?t.texImage2D(t.TEXTURE_2D,e,o,o,s,r.image):o<=n.COMPRESSED_RGBA_S3TC_DXT5_EXT&&o>=n.COMPRESSED_RGB_S3TC_DXT1_EXT?t.compressedTexImage2D(t.TEXTURE_2D,e,o,i,a,0,r.pixels):t.texImage2D(t.TEXTURE_2D,e,o,i,a,0,o,s,r.pixels)},generateMipmap:function(t){this.useMipmap&&!this.NPOT&&(t.bindTexture(t.TEXTURE_2D,this._cache.get("webgl_texture")),t.generateMipmap(t.TEXTURE_2D))},isPowerOfTwo:function(){var t,r;return this.image?(t=this.image.width,r=this.image.height):(t=this.width,r=this.height),s(t)&&s(r)},isRenderable:function(){return this.image?"CANVAS"===this.image.nodeName||"VIDEO"===this.image.nodeName||this.image.complete:!(!this.width||!this.height)},bind:function(t){t.bindTexture(t.TEXTURE_2D,this.getWebGLTexture(t))},unbind:function(t){t.bindTexture(t.TEXTURE_2D,null)},load:function(t){var r=new Image,e=this;return r.onload=function(){e.dirty(),e.trigger("success",e),r.onload=null},r.onerror=function(){e.trigger("error",e),r.onerror=null},r.src=t,this.image=r,this}});t.exports=u},function(t,r,e){"use strict";var n=e(23),i=n.extend({left:-1,right:1,near:-1,far:1,top:1,bottom:-1},{updateProjectionMatrix:function(){this.projectionMatrix.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far)},decomposeProjectionMatrix:function(){var t=this.projectionMatrix._array;this.left=(-1-t[12])/t[0],this.right=(1-t[12])/t[0],this.top=(1-t[13])/t[5],this.bottom=(-1-t[13])/t[5],this.near=-(-1-t[14])/t[10],this.far=-(1-t[14])/t[10]},clone:function(){var t=n.prototype.clone.call(this);return t.left=this.left,t.right=this.right,t.near=this.near,t.far=this.far,t.top=this.top,t.bottom=this.bottom,t}});t.exports=i},function(t,r,e){"use strict";var n=e(23),i=n.extend({fov:50,aspect:1,near:.1,far:2e3},{updateProjectionMatrix:function(){var t=this.fov/180*Math.PI;this.projectionMatrix.perspective(t,this.aspect,this.near,this.far)},decomposeProjectionMatrix:function(){var t=this.projectionMatrix._array,r=2*Math.atan(1/t[5]);this.fov=r/Math.PI*180,this.aspect=t[5]/t[0],this.near=t[14]/(t[10]-1),this.far=t[14]/(t[10]+1)},clone:function(){var t=n.prototype.clone.call(this);return t.fov=this.fov,t.aspect=this.aspect,t.near=this.near,t.far=this.far,t}});t.exports=i},function(t,r){"use strict";function e(t,r,e){"object"==typeof r&&(e=r,r=null);var a,o=this;if(!(t instanceof Function)){a=[];for(var s in t)t.hasOwnProperty(s)&&a.push(s)}var u=function(r){if(o.apply(this,arguments),t instanceof Function?n(this,t.call(this,r)):i(this,t,a),this.constructor===u)for(var e=u.__initializers__,s=0;s<e.length;s++)e[s].apply(this,arguments)};u.__super__=o,o.__initializers__?u.__initializers__=o.__initializers__.slice():u.__initializers__=[],r&&u.__initializers__.push(r);var c=function(){};return c.prototype=o.prototype,u.prototype=new c,u.prototype.constructor=u,n(u.prototype,e),u.extend=o.extend,u.derive=o.extend,u}function n(t,r){if(r)for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])}function i(t,r,e){for(var n=0;n<e.length;n++){var i=e[n];t[i]=r[i]}}t.exports={extend:e,derive:e}},function(t,r){function e(t,r){this.action=t,this.context=r}var n={trigger:function(t){if(this.hasOwnProperty("__handlers__")&&this.__handlers__.hasOwnProperty(t)){var r=this.__handlers__[t],e=r.length,n=-1,i=arguments;switch(i.length){case 1:for(;++n<e;)r[n].action.call(r[n].context);return;case 2:for(;++n<e;)r[n].action.call(r[n].context,i[1]);return;case 3:for(;++n<e;)r[n].action.call(r[n].context,i[1],i[2]);return;case 4:for(;++n<e;)r[n].action.call(r[n].context,i[1],i[2],i[3]);return;case 5:for(;++n<e;)r[n].action.call(r[n].context,i[1],i[2],i[3],i[4]);return;default:for(;++n<e;)r[n].action.apply(r[n].context,Array.prototype.slice.call(i,1));return}}},on:function(t,r,n){if(t&&r){var i=this.__handlers__||(this.__handlers__={});if(i[t]){if(this.has(t,r))return}else i[t]=[];var a=new e(r,n||this);return i[t].push(a),this}},once:function(t,r,e){function n(){i.off(t,n),r.apply(this,arguments)}if(t&&r){var i=this;return this.on(t,n,e)}},before:function(t,r,e){if(t&&r)return t="before"+t,this.on(t,r,e)},after:function(t,r,e){if(t&&r)return t="after"+t,this.on(t,r,e)},success:function(t,r){return this.once("success",t,r)},error:function(t,r){return this.once("error",t,r)},off:function(t,r){var e=this.__handlers__||(this.__handlers__={});if(!r)return void(e[t]=[]);if(e[t]){for(var n=e[t],i=[],a=0;a<n.length;a++)r&&n[a].action!==r&&i.push(n[a]);e[t]=i}return this},has:function(t,r){var e=this.__handlers__;if(!e||!e[t])return!1;for(var n=e[t],i=0;i<n.length;i++)if(n[i].action===r)return!0}};t.exports=n},function(t,r,e){"use strict";function n(t,r,e){h.identity();var n=new a({widthSegments:r,heightSegments:e});switch(t){case"px":o.translate(h,h,s.POSITIVE_X),o.rotateY(h,h,Math.PI/2);break;case"nx":o.translate(h,h,s.NEGATIVE_X),o.rotateY(h,h,-Math.PI/2);break;case"py":o.translate(h,h,s.POSITIVE_Y),o.rotateX(h,h,-Math.PI/2);break;case"ny":o.translate(h,h,s.NEGATIVE_Y),o.rotateX(h,h,Math.PI/2);break;case"pz":o.translate(h,h,s.POSITIVE_Z);break;case"nz":o.translate(h,h,s.NEGATIVE_Z),o.rotateY(h,h,Math.PI)}return n.applyTransform(h),n}var i=e(7),a=e(28),o=e(8),s=e(3),u=e(4),c=e(9),h=new o,f=i.extend({widthSegments:1,heightSegments:1,depthSegments:1,inside:!1},function(){this.build()},{build:function(){var t={px:n("px",this.depthSegments,this.heightSegments),nx:n("nx",this.depthSegments,this.heightSegments),py:n("py",this.widthSegments,this.depthSegments),ny:n("ny",this.widthSegments,this.depthSegments),pz:n("pz",this.widthSegments,this.heightSegments),nz:n("nz",this.widthSegments,this.heightSegments)},r=["position","texcoord0","normal"],e=0,i=0;for(var a in t)e+=t[a].vertexCount,i+=t[a].faces.length;for(var o=0;o<r.length;o++)this.attributes[r[o]].init(e);this.faces=new c.Uint16Array(i);var s=0,h=0;for(var a in t){for(var f=t[a],o=0;o<r.length;o++)for(var l=r[o],_=f.attributes[l].value,d=f.attributes[l].size,y="normal"===l,m=0;m<_.length;m++){var v=_[m];this.inside&&y&&(v=-v),this.attributes[l].value[m+d*h]=v}for(var m=0;m<f.faces.length;m++)this.faces[m+s]=h+f.faces[m];s+=f.faces.length,h+=f.vertexCount}this.boundingBox=new u,this.boundingBox.max.set(1,1,1),this.boundingBox.min.set(-1,-1,-1)}});t.exports=f},function(t,r,e){"use strict";var n=e(7),i=e(1),a=i.vec3,o=i.vec2,s=e(4),u=n.extend({widthSegments:20,heightSegments:20,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI,radius:1},function(){this.build()},{build:function(){var t,r,e,n,i,u,c,h,f=[],l=[],_=[],d=[],y=this.heightSegments,m=this.widthSegments,v=this.radius,p=this.phiStart,g=this.phiLength,E=this.thetaStart,T=this.thetaLength,v=this.radius;for(c=0;c<=y;c++)for(u=0;u<=m;u++)n=u/m,i=c/y,t=-v*Math.cos(p+n*g)*Math.sin(E+i*T),r=v*Math.cos(E+i*T),e=v*Math.sin(p+n*g)*Math.sin(E+i*T),f.push(a.fromValues(t,r,e)),l.push(o.fromValues(n,i)),h=a.fromValues(t,r,e),a.normalize(h,h),_.push(h);var A,b,x,R,I=m+1;for(c=0;c<y;c++)for(u=0;u<m;u++)b=c*I+u,A=c*I+u+1,R=(c+1)*I+u+1,x=(c+1)*I+u,d.push(a.fromValues(A,b,R)),d.push(a.fromValues(b,x,R));var S=this.attributes;S.position.fromArray(f),S.texcoord0.fromArray(l),S.normal.fromArray(_),this.initFaceFromArray(d),this.boundingBox=new s,this.boundingBox.max.set(v,v,v),this.boundingBox.min.set(-v,-v,-v)}});t.exports=u},function(t,r,e){"use strict";var n=e(10),i=n.extend({castShadow:!1},{type:"AMBIENT_LIGHT",uniformTemplates:{ambientLightColor:{type:"3f",value:function(t){var r=t.color,e=t.intensity;return[r[0]*e,r[1]*e,r[2]*e]}}}});t.exports=i},function(t,r,e){"use strict";var n=e(10),i=e(3),a=n.extend({shadowBias:.001,shadowSlopeScale:2,shadowCascade:1,cascadeSplitLogFactor:.2},{type:"DIRECTIONAL_LIGHT",uniformTemplates:{directionalLightDirection:{type:"3f",value:function(t){return t.__dir=t.__dir||new i,t.__dir.copy(t.worldTransform.z).negate()._array}},directionalLightColor:{type:"3f",value:function(t){var r=t.color,e=t.intensity;return[r[0]*e,r[1]*e,r[2]*e]}}},clone:function(){var t=n.prototype.clone.call(this);return t.shadowBias=this.shadowBias,
t.shadowSlopeScale=this.shadowSlopeScale,t}});t.exports=a},function(t,r,e){"use strict";var n=e(10),i=n.extend({range:100,castShadow:!1},{type:"POINT_LIGHT",uniformTemplates:{pointLightPosition:{type:"3f",value:function(t){return t.getWorldPosition()._array}},pointLightRange:{type:"1f",value:function(t){return t.range}},pointLightColor:{type:"3f",value:function(t){var r=t.color,e=t.intensity;return[r[0]*e,r[1]*e,r[2]*e]}}},clone:function(){var t=n.prototype.clone.call(this);return t.range=this.range,t}});t.exports=i},function(t,r,e){"use strict";var n=e(10),i=e(3),a=n.extend({range:20,umbraAngle:30,penumbraAngle:45,falloffFactor:2,shadowBias:2e-4,shadowSlopeScale:2},{type:"SPOT_LIGHT",uniformTemplates:{spotLightPosition:{type:"3f",value:function(t){return t.getWorldPosition()._array}},spotLightRange:{type:"1f",value:function(t){return t.range}},spotLightUmbraAngleCosine:{type:"1f",value:function(t){return Math.cos(t.umbraAngle*Math.PI/180)}},spotLightPenumbraAngleCosine:{type:"1f",value:function(t){return Math.cos(t.penumbraAngle*Math.PI/180)}},spotLightFalloffFactor:{type:"1f",value:function(t){return t.falloffFactor}},spotLightDirection:{type:"3f",value:function(t){return t.__dir=t.__dir||new i,t.__dir.copy(t.worldTransform.z).negate()._array}},spotLightColor:{type:"3f",value:function(t){var r=t.color,e=t.intensity;return[r[0]*e,r[1]*e,r[2]*e]}}},clone:function(){var t=n.prototype.clone.call(this);return t.range=this.range,t.umbraAngle=this.umbraAngle,t.penumbraAngle=this.penumbraAngle,t.falloffFactor=this.falloffFactor,t.shadowBias=this.shadowBias,t.shadowSlopeScale=this.shadowSlopeScale,t}});t.exports=a},function(t,r,e){"use strict";var n=e(1),i=n.mat2,a=function(){this._array=i.create(),this._dirty=!0};a.prototype={constructor:a,setArray:function(t){for(var r=0;r<this._array.length;r++)this._array[r]=t[r];return this._dirty=!0,this},clone:function(){return(new a).copy(this)},copy:function(t){return i.copy(this._array,t._array),this._dirty=!0,this},adjoint:function(){return i.adjoint(this._array,this._array),this._dirty=!0,this},determinant:function(){return i.determinant(this._array)},identity:function(){return i.identity(this._array),this._dirty=!0,this},invert:function(){return i.invert(this._array,this._array),this._dirty=!0,this},mul:function(t){return i.mul(this._array,this._array,t._array),this._dirty=!0,this},mulLeft:function(t){return i.mul(this._array,t._array,this._array),this._dirty=!0,this},multiply:function(t){return i.multiply(this._array,this._array,t._array),this._dirty=!0,this},multiplyLeft:function(t){return i.multiply(this._array,t._array,this._array),this._dirty=!0,this},rotate:function(t){return i.rotate(this._array,this._array,t),this._dirty=!0,this},scale:function(t){return i.scale(this._array,this._array,t._array),this._dirty=!0,this},transpose:function(){return i.transpose(this._array,this._array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this._array)}},a.adjoint=function(t,r){return i.adjoint(t._array,r._array),t._dirty=!0,t},a.copy=function(t,r){return i.copy(t._array,r._array),t._dirty=!0,t},a.determinant=function(t){return i.determinant(t._array)},a.identity=function(t){return i.identity(t._array),t._dirty=!0,t},a.invert=function(t,r){return i.invert(t._array,r._array),t._dirty=!0,t},a.mul=function(t,r,e){return i.mul(t._array,r._array,e._array),t._dirty=!0,t},a.multiply=a.mul,a.rotate=function(t,r,e){return i.rotate(t._array,r._array,e),t._dirty=!0,t},a.scale=function(t,r,e){return i.scale(t._array,r._array,e._array),t._dirty=!0,t},a.transpose=function(t,r){return i.transpose(t._array,r._array),t._dirty=!0,t},t.exports=a},function(t,r,e){"use strict";var n=e(1),i=n.mat2d,a=function(){this._array=i.create(),this._dirty=!0};a.prototype={constructor:a,setArray:function(t){for(var r=0;r<this._array.length;r++)this._array[r]=t[r];return this._dirty=!0,this},clone:function(){return(new a).copy(this)},copy:function(t){return i.copy(this._array,t._array),this._dirty=!0,this},determinant:function(){return i.determinant(this._array)},identity:function(){return i.identity(this._array),this._dirty=!0,this},invert:function(){return i.invert(this._array,this._array),this._dirty=!0,this},mul:function(t){return i.mul(this._array,this._array,t._array),this._dirty=!0,this},mulLeft:function(t){return i.mul(this._array,t._array,this._array),this._dirty=!0,this},multiply:function(t){return i.multiply(this._array,this._array,t._array),this._dirty=!0,this},multiplyLeft:function(t){return i.multiply(this._array,t._array,this._array),this._dirty=!0,this},rotate:function(t){return i.rotate(this._array,this._array,t),this._dirty=!0,this},scale:function(t){return i.scale(this._array,this._array,t._array),this._dirty=!0,this},translate:function(t){return i.translate(this._array,this._array,t._array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this._array)}},a.copy=function(t,r){return i.copy(t._array,r._array),t._dirty=!0,t},a.determinant=function(t){return i.determinant(t._array)},a.identity=function(t){return i.identity(t._array),t._dirty=!0,t},a.invert=function(t,r){return i.invert(t._array,r._array),t._dirty=!0,t},a.mul=function(t,r,e){return i.mul(t._array,r._array,e._array),t._dirty=!0,t},a.multiply=a.mul,a.rotate=function(t,r,e){return i.rotate(t._array,r._array,e),t._dirty=!0,t},a.scale=function(t,r,e){return i.scale(t._array,r._array,e._array),t._dirty=!0,t},a.translate=function(t,r,e){return i.translate(t._array,r._array,e._array),t._dirty=!0,t},t.exports=a},function(t,r,e){"use strict";var n=e(1),i=n.mat3,a=function(){this._array=i.create(),this._dirty=!0};a.prototype={constructor:a,setArray:function(t){for(var r=0;r<this._array.length;r++)this._array[r]=t[r];return this._dirty=!0,this},adjoint:function(){return i.adjoint(this._array,this._array),this._dirty=!0,this},clone:function(){return(new a).copy(this)},copy:function(t){return i.copy(this._array,t._array),this._dirty=!0,this},determinant:function(){return i.determinant(this._array)},fromMat2d:function(t){return i.fromMat2d(this._array,t._array),this._dirty=!0,this},fromMat4:function(t){return i.fromMat4(this._array,t._array),this._dirty=!0,this},fromQuat:function(t){return i.fromQuat(this._array,t._array),this._dirty=!0,this},identity:function(){return i.identity(this._array),this._dirty=!0,this},invert:function(){return i.invert(this._array,this._array),this._dirty=!0,this},mul:function(t){return i.mul(this._array,this._array,t._array),this._dirty=!0,this},mulLeft:function(t){return i.mul(this._array,t._array,this._array),this._dirty=!0,this},multiply:function(t){return i.multiply(this._array,this._array,t._array),this._dirty=!0,this},multiplyLeft:function(t){return i.multiply(this._array,t._array,this._array),this._dirty=!0,this},rotate:function(t){return i.rotate(this._array,this._array,t),this._dirty=!0,this},scale:function(t){return i.scale(this._array,this._array,t._array),this._dirty=!0,this},translate:function(t){return i.translate(this._array,this._array,t._array),this._dirty=!0,this},normalFromMat4:function(t){return i.normalFromMat4(this._array,t._array),this._dirty=!0,this},transpose:function(){return i.transpose(this._array,this._array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this._array)}},a.adjoint=function(t,r){return i.adjoint(t._array,r._array),t._dirty=!0,t},a.copy=function(t,r){return i.copy(t._array,r._array),t._dirty=!0,t},a.determinant=function(t){return i.determinant(t._array)},a.identity=function(t){return i.identity(t._array),t._dirty=!0,t},a.invert=function(t,r){return i.invert(t._array,r._array),t},a.mul=function(t,r,e){return i.mul(t._array,r._array,e._array),t._dirty=!0,t},a.multiply=a.mul,a.fromMat2d=function(t,r){return i.fromMat2d(t._array,r._array),t._dirty=!0,t},a.fromMat4=function(t,r){return i.fromMat4(t._array,r._array),t._dirty=!0,t},a.fromQuat=function(t,r){return i.fromQuat(t._array,r._array),t._dirty=!0,t},a.normalFromMat4=function(t,r){return i.normalFromMat4(t._array,r._array),t._dirty=!0,t},a.rotate=function(t,r,e){return i.rotate(t._array,r._array,e),t._dirty=!0,t},a.scale=function(t,r,e){return i.scale(t._array,r._array,e._array),t._dirty=!0,t},a.transpose=function(t,r){return i.transpose(t._array,r._array),t._dirty=!0,t},a.translate=function(t,r,e){return i.translate(t._array,r._array,e._array),t._dirty=!0,t},t.exports=a},function(t,r,e){"use strict";var n=e(1),i=n.vec4,a=function(t,r,e,n){t=t||0,r=r||0,e=e||0,n=n||0,this._array=i.fromValues(t,r,e,n),this._dirty=!0};a.prototype={constructor:a,add:function(t){return i.add(this._array,this._array,t._array),this._dirty=!0,this},set:function(t,r,e,n){return this._array[0]=t,this._array[1]=r,this._array[2]=e,this._array[3]=n,this._dirty=!0,this},setArray:function(t){return this._array[0]=t[0],this._array[1]=t[1],this._array[2]=t[2],this._array[3]=t[3],this._dirty=!0,this},clone:function(){return new a(this.x,this.y,this.z,this.w)},copy:function(t){return i.copy(this._array,t._array),this._dirty=!0,this},dist:function(t){return i.dist(this._array,t._array)},distance:function(t){return i.distance(this._array,t._array)},div:function(t){return i.div(this._array,this._array,t._array),this._dirty=!0,this},divide:function(t){return i.divide(this._array,this._array,t._array),this._dirty=!0,this},dot:function(t){return i.dot(this._array,t._array)},len:function(){return i.len(this._array)},length:function(){return i.length(this._array)},lerp:function(t,r,e){return i.lerp(this._array,t._array,r._array,e),this._dirty=!0,this},min:function(t){return i.min(this._array,this._array,t._array),this._dirty=!0,this},max:function(t){return i.max(this._array,this._array,t._array),this._dirty=!0,this},mul:function(t){return i.mul(this._array,this._array,t._array),this._dirty=!0,this},multiply:function(t){return i.multiply(this._array,this._array,t._array),this._dirty=!0,this},negate:function(){return i.negate(this._array,this._array),this._dirty=!0,this},normalize:function(){return i.normalize(this._array,this._array),this._dirty=!0,this},random:function(t){return i.random(this._array,t),this._dirty=!0,this},scale:function(t){return i.scale(this._array,this._array,t),this._dirty=!0,this},scaleAndAdd:function(t,r){return i.scaleAndAdd(this._array,this._array,t._array,r),this._dirty=!0,this},sqrDist:function(t){return i.sqrDist(this._array,t._array)},squaredDistance:function(t){return i.squaredDistance(this._array,t._array)},sqrLen:function(){return i.sqrLen(this._array)},squaredLength:function(){return i.squaredLength(this._array)},sub:function(t){return i.sub(this._array,this._array,t._array),this._dirty=!0,this},subtract:function(t){return i.subtract(this._array,this._array,t._array),this._dirty=!0,this},transformMat4:function(t){return i.transformMat4(this._array,this._array,t._array),this._dirty=!0,this},transformQuat:function(t){return i.transformQuat(this._array,this._array,t._array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this._array)}};var o=Object.defineProperty;if(o){var s=a.prototype;o(s,"x",{get:function(){return this._array[0]},set:function(t){this._array[0]=t,this._dirty=!0}}),o(s,"y",{get:function(){return this._array[1]},set:function(t){this._array[1]=t,this._dirty=!0}}),o(s,"z",{get:function(){return this._array[2]},set:function(t){this._array[2]=t,this._dirty=!0}}),o(s,"w",{get:function(){return this._array[3]},set:function(t){this._array[3]=t,this._dirty=!0}})}a.add=function(t,r,e){return i.add(t._array,r._array,e._array),t._dirty=!0,t},a.set=function(t,r,e,n,a){i.set(t._array,r,e,n,a),t._dirty=!0},a.copy=function(t,r){return i.copy(t._array,r._array),t._dirty=!0,t},a.dist=function(t,r){return i.distance(t._array,r._array)},a.distance=a.dist,a.div=function(t,r,e){return i.divide(t._array,r._array,e._array),t._dirty=!0,t},a.divide=a.div,a.dot=function(t,r){return i.dot(t._array,r._array)},a.len=function(t){return i.length(t._array)},a.lerp=function(t,r,e,n){return i.lerp(t._array,r._array,e._array,n),t._dirty=!0,t},a.min=function(t,r,e){return i.min(t._array,r._array,e._array),t._dirty=!0,t},a.max=function(t,r,e){return i.max(t._array,r._array,e._array),t._dirty=!0,t},a.mul=function(t,r,e){return i.multiply(t._array,r._array,e._array),t._dirty=!0,t},a.multiply=a.mul,a.negate=function(t,r){return i.negate(t._array,r._array),t._dirty=!0,t},a.normalize=function(t,r){return i.normalize(t._array,r._array),t._dirty=!0,t},a.random=function(t,r){return i.random(t._array,r),t._dirty=!0,t},a.scale=function(t,r,e){return i.scale(t._array,r._array,e),t._dirty=!0,t},a.scaleAndAdd=function(t,r,e,n){return i.scaleAndAdd(t._array,r._array,e._array,n),t._dirty=!0,t},a.sqrDist=function(t,r){return i.sqrDist(t._array,r._array)},a.squaredDistance=a.sqrDist,a.sqrLen=function(t){return i.sqrLen(t._array)},a.squaredLength=a.sqrLen,a.sub=function(t,r,e){return i.subtract(t._array,r._array,e._array),t._dirty=!0,t},a.subtract=a.sub,a.transformMat4=function(t,r,e){return i.transformMat4(t._array,r._array,e._array),t._dirty=!0,t},a.transformQuat=function(t,r,e){return i.transformQuat(t._array,r._array,e._array),t._dirty=!0,t},t.exports=a},function(t,r){var e={};e.isPowerOfTwo=function(t){return 0===(t&t-1)},e.nextPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t},e.nearestPowerOfTwo=function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))},t.exports=e},function(t,r,e){var n=e(6),i=e(21),a=e(14),o=e(3),s=e(8),u=e(26),c=e(7),h=e(5),f=n.extend({scene:null,camera:null,renderer:null},function(){this._ray=new i,this._ndc=new a},{pick:function(t,r){var e=this.pickAll(t,r);return e[0]||null},pickAll:function(t,r,e){return this.renderer.screenToNdc(t,r,this._ndc),this.camera.castRay(this._ndc,this._ray),e=e||[],this._intersectNode(this.scene,e),e.sort(this._intersectionCompareFunc),e},_intersectNode:function(t,r){t instanceof u&&t.isRenderable()&&!t.ignorePicking&&t.geometry.isUseFace()&&this._intersectRenderable(t,r);for(var e=0;e<t._children.length;e++)this._intersectNode(t._children[e],r)},_intersectRenderable:function(){var t=new o,r=new o,e=new o,n=new i,a=new s;return function(i,u){n.copy(this._ray),s.invert(a,i.worldTransform),n.applyTransform(a);var l=i.geometry;if(!l.boundingBox||n.intersectBoundingBox(l.boundingBox)){if(l.pickByRay){var _=l.pickByRay(n);return void(_&&u.push(_))}var d,y=l instanceof c,m=i.cullFace===h.BACK&&i.frontFace===h.CCW||i.cullFace===h.FRONT&&i.frontFace===h.CW;if(y)for(var v=l.faces,p=l.attributes.position.value,g=0;g<v.length;){var E=3*v[g++],T=3*v[g++],A=3*v[g++];if(t._array[0]=p[E],t._array[1]=p[E+1],t._array[2]=p[E+2],r._array[0]=p[T],r._array[1]=p[T+1],r._array[2]=p[T+2],e._array[0]=p[A],e._array[1]=p[A+1],e._array[2]=p[A+2],d=m?n.intersectTriangle(t,r,e,i.culling):n.intersectTriangle(t,e,r,i.culling)){var b=new o;o.transformMat4(b,d,i.worldTransform),u.push(new f.Intersection(d,b,i,[E/3,T/3,A/3],o.dist(b,this._ray.origin)))}}else for(var v=l.faces,p=l.attributes.position.value,g=0;g<v.length;g++){var x=v[g],E=x[0],T=x[1],A=x[2];if(t.setArray(p[E]),r.setArray(p[T]),e.setArray(p[A]),d=m?n.intersectTriangle(t,r,e,i.culling):n.intersectTriangle(t,e,r,i.culling)){var b=new o;o.transformMat4(b,d,i.worldTransform),u.push(new f.Intersection(d,b,i,[E,T,A],o.dist(b,this._ray.origin)))}}}}}(),_intersectionCompareFunc:function(t,r){return t.distance-r.distance}});f.Intersection=function(t,r,e,n,i){this.point=t,this.pointWorld=r,this.target=e,this.face=n,this.distance=i},t.exports=f},function(t,r,e){function n(){this._pool={}}function i(t,r,e){o[t]={vertex:r,fragment:e}}var a=e(17),o=(e(19),{});n.prototype.get=function(t,r){var e=[],n={},i={};"string"==typeof r?e=Array.prototype.slice.call(arguments,1):"[object Object]"==Object.prototype.toString.call(r)?(e=r.textures||[],n=r.vertexDefines||{},i=r.fragmentDefines||{}):r instanceof Array&&(e=r);var s=Object.keys(n),u=Object.keys(i);e.sort(),s.sort(),u.sort();var c=[t];c=c.concat(e);for(var h=0;h<s.length;h++)c.push(s[h],n[s[h]]);for(var h=0;h<u.length;h++)c.push(u[h],i[u[h]]);var f=c.join("_");if(this._pool[f])return this._pool[f];var l=o[t];if(!l)return void console.error('Shader "'+t+'" is not in the library');for(var _=new a({vertex:l.vertex,fragment:l.fragment}),h=0;h<e.length;h++)_.enableTexture(e[h]);for(var t in n)_.define("vertex",t,n[t]);for(var t in i)_.define("fragment",t,i[t]);return this._pool[f]=_,_},n.prototype.clear=function(){this._pool={}};var s=new n;t.exports={createLibrary:function(){return new n},get:function(){return s.get.apply(s,arguments)},template:i,clear:function(){return s.clear()}}},function(t,r){t.exports="vec3 calcAmbientSHLight(int idx, vec3 N) {\n    int offset = 9 * idx;\n\n    // FIXME Index expression must be constant\n    return ambientSHLightCoefficients[0]\n        + ambientSHLightCoefficients[1] * N.x\n        + ambientSHLightCoefficients[2] * N.y\n        + ambientSHLightCoefficients[3] * N.z\n        + ambientSHLightCoefficients[4] * N.x * N.z\n        + ambientSHLightCoefficients[5] * N.z * N.y\n        + ambientSHLightCoefficients[6] * N.y * N.x\n        + ambientSHLightCoefficients[7] * (3.0 * N.z * N.z - 1.0)\n        + ambientSHLightCoefficients[8] * (N.x * N.x - N.y * N.y);\n}"},function(t,r,e){var n="uniform vec3 ",i="uniform float ",a="@export qtek.header.",o="@end",s=":unconfigurable;";t.exports=[a+"directional_light",n+"directionalLightDirection[DIRECTIONAL_LIGHT_COUNT]"+s,n+"directionalLightColor[DIRECTIONAL_LIGHT_COUNT]"+s,o,a+"ambient_light",n+"ambientLightColor[AMBIENT_LIGHT_COUNT]"+s,o,a+"ambient_sh_light",n+"ambientSHLightColor[AMBIENT_SH_LIGHT_COUNT]"+s,n+"ambientSHLightCoefficients[AMBIENT_SH_LIGHT_COUNT * 9]"+s,e(83),o,a+"ambient_cubemap_light",n+"ambientCubemapLightColor[AMBIENT_CUBEMAP_LIGHT_COUNT]"+s,"uniform samplerCube ambientCubemapLightCubemap[AMBIENT_CUBEMAP_LIGHT_COUNT]"+s,"uniform sampler2D ambientCubemapLightBRDFLookup[AMBIENT_CUBEMAP_LIGHT_COUNT]"+s,o,a+"point_light",n+"pointLightPosition[POINT_LIGHT_COUNT]"+s,i+"pointLightRange[POINT_LIGHT_COUNT]"+s,n+"pointLightColor[POINT_LIGHT_COUNT]"+s,o,a+"spot_light",n+"spotLightPosition[SPOT_LIGHT_COUNT]"+s,n+"spotLightDirection[SPOT_LIGHT_COUNT]"+s,i+"spotLightRange[SPOT_LIGHT_COUNT]"+s,i+"spotLightUmbraAngleCosine[SPOT_LIGHT_COUNT]"+s,i+"spotLightPenumbraAngleCosine[SPOT_LIGHT_COUNT]"+s,i+"spotLightFalloffFactor[SPOT_LIGHT_COUNT]"+s,n+"spotLightColor[SPOT_LIGHT_COUNT]"+s,o].join("\n")},function(t,r){t.exports="0.3.0"},function(t,r,e){function n(t,r){return t[r]}function i(t,r,e){t[r]=e}function a(t,r,e){return(r-t)*e+t}function o(t,r,e){return e>.5?r:t}function s(t,r,e,n,i){var o=t.length;if(1==i)for(var s=0;s<o;s++)n[s]=a(t[s],r[s],e);else for(var u=t[0].length,s=0;s<o;s++)for(var c=0;c<u;c++)n[s][c]=a(t[s][c],r[s][c],e)}function u(t,r,e){var n=t.length,i=r.length;if(n!==i){var a=n>i;if(a)t.length=i;else for(var o=n;o<i;o++)t.push(1===e?r[o]:g.call(r[o]))}for(var s=t[0]&&t[0].length,o=0;o<t.length;o++)if(1===e)isNaN(t[o])&&(t[o]=r[o]);else for(var u=0;u<s;u++)isNaN(t[o][u])&&(t[o][u]=r[o][u])}function c(t,r,e){if(t===r)return!0;var n=t.length;if(n!==r.length)return!1;if(1===e){for(var i=0;i<n;i++)if(t[i]!==r[i])return!1}else for(var a=t[0].length,i=0;i<n;i++)for(var o=0;o<a;o++)if(t[i][o]!==r[i][o])return!1;return!0}function h(t,r,e,n,i,a,o,s,u){var c=t.length;if(1==u)for(var h=0;h<c;h++)s[h]=f(t[h],r[h],e[h],n[h],i,a,o);else for(var l=t[0].length,h=0;h<c;h++)for(var _=0;_<l;_++)s[h][_]=f(t[h][_],r[h][_],e[h][_],n[h][_],i,a,o)}function f(t,r,e,n,i,a,o){var s=.5*(e-t),u=.5*(n-r);return(2*(r-e)+s+u)*o+(-3*(r-e)-2*s-u)*a+s*i+r}function l(t){if(p(t)){var r=t.length;if(p(t[0])){for(var e=[],n=0;n<r;n++)e.push(g.call(t[n]));return e}return g.call(t)}return t}function _(t){return t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.floor(t[2]),"rgba("+t.join(",")+")"}function d(t,r,e,n,i){var l=t._getter,d=t._setter,v="spline"===r,g=n.length;if(g){var E,T=n[0].value,A=p(T),b=!1,x=!1,R=A&&p(T[0])?2:1;n.sort(function(t,r){return t.time-r.time}),E=n[g-1].time;for(var I=[],S=[],N=n[0].value,M=!0,w=0;w<g;w++){I.push(n[w].time/E);var O=n[w].value;if(A&&c(O,N,R)||!A&&O===N||(M=!1),N=O,"string"==typeof O){var L=m.parse(O);L?(O=L,b=!0):x=!0}S.push(O)}if(!M){for(var C=S[g-1],w=0;w<g-1;w++)A?u(S[w],C,R):!isNaN(S[w])||isNaN(C)||x||b||(S[w]=C);A&&u(l(t._target,i),C,R);var P,D,U,F,B,k,V=0,G=0;if(b)var W=[0,0,0,0];var X=function(t,r){var e;if(r<0)e=0;else if(r<G){for(P=Math.min(V+1,g-1),e=P;e>=0&&!(I[e]<=r);e--);e=Math.min(e,g-2)}else{for(e=V;e<g&&!(I[e]>r);e++);e=Math.min(e-1,g-2)}V=e,G=r;var n=I[e+1]-I[e];if(0!==n)if(D=(r-I[e])/n,v)if(F=S[e],U=S[0===e?e:e-1],B=S[e>g-2?g-1:e+1],k=S[e>g-3?g-1:e+2],A)h(U,F,B,k,D,D*D,D*D*D,l(t,i),R);else{var u;if(b)u=h(U,F,B,k,D,D*D,D*D*D,W,1),u=_(W);else{if(x)return o(F,B,D);u=f(U,F,B,k,D,D*D,D*D*D)}d(t,i,u)}else if(A)s(S[e],S[e+1],D,l(t,i),R);else{var u;if(b)s(S[e],S[e+1],D,W,1),u=_(W);else{if(x)return o(S[e],S[e+1],D);u=a(S[e],S[e+1],D)}d(t,i,u)}},z=new y({target:t._target,life:E,loop:t._loop,delay:t._delay,onframe:X,ondestroy:e});return r&&"spline"!==r&&(z.easing=r),z}}}var y=e(87),m=e(94),v=e(13),p=v.isArrayLike,g=Array.prototype.slice,E=function(t,r,e,a){this._tracks={},this._target=t,this._loop=r||!1,this._getter=e||n,this._setter=a||i,this._clipCount=0,this._delay=0,this._doneList=[],this._onframeList=[],this._clipList=[]};E.prototype={when:function(t,r){var e=this._tracks;for(var n in r)if(r.hasOwnProperty(n)){if(!e[n]){e[n]=[];var i=this._getter(this._target,n);if(null==i)continue;0!==t&&e[n].push({time:0,value:l(i)})}e[n].push({time:t,value:r[n]})}return this},during:function(t){return this._onframeList.push(t),this},_doneCallback:function(){this._tracks={},this._clipList.length=0;for(var t=this._doneList,r=t.length,e=0;e<r;e++)t[e].call(this)},start:function(t){var r,e=this,n=0,i=function(){n--,n||e._doneCallback()};for(var a in this._tracks)if(this._tracks.hasOwnProperty(a)){var o=d(this,t,i,this._tracks[a],a);o&&(this._clipList.push(o),n++,this.animation&&this.animation.addClip(o),r=o)}if(r){var s=r.onframe;r.onframe=function(t,r){s(t,r);for(var n=0;n<e._onframeList.length;n++)e._onframeList[n](t,r)}}return n||this._doneCallback(),this},stop:function(t){for(var r=this._clipList,e=this.animation,n=0;n<r.length;n++){var i=r[n];t&&i.onframe(this._target,1),e&&e.removeClip(i)}r.length=0},delay:function(t){return this._delay=t,this},done:function(t){return t&&this._doneList.push(t),this},getClips:function(){return this._clipList}},t.exports=E},function(t,r,e){function n(t){this._target=t.target,this._life=t.life||1e3,this._delay=t.delay||0,this._initialized=!1,this.loop=null!=t.loop&&t.loop,this.gap=t.gap||0,this.easing=t.easing||"Linear",this.onframe=t.onframe,this.ondestroy=t.ondestroy,this.onrestart=t.onrestart}var i=e(88);n.prototype={constructor:n,step:function(t){this._initialized||(this._startTime=t+this._delay,this._initialized=!0);var r=(t-this._startTime)/this._life;if(!(r<0)){r=Math.min(r,1);var e=this.easing,n="string"==typeof e?i[e]:e,a="function"==typeof n?n(r):r;return this.fire("frame",a),1==r?this.loop?(this.restart(t),"restart"):(this._needsRemove=!0,"destroy"):null}},restart:function(t){var r=(t-this._startTime)%this._life;this._startTime=t-r+this.gap,this._needsRemove=!1},fire:function(t,r){t="on"+t,this[t]&&this[t](this._target,r)}},t.exports=n},function(t,r){var e={linear:function(t){return t},quadraticIn:function(t){return t*t},quadraticOut:function(t){return t*(2-t)},quadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quarticIn:function(t){return t*t*t*t},quarticOut:function(t){return 1- --t*t*t*t},quarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quinticIn:function(t){return t*t*t*t*t},quinticOut:function(t){return--t*t*t*t*t+1},quinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sinusoidalIn:function(t){return 1-Math.cos(t*Math.PI/2)},sinusoidalOut:function(t){return Math.sin(t*Math.PI/2)},sinusoidalInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},exponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},exponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},exponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)},circularIn:function(t){return 1-Math.sqrt(1-t*t)},circularOut:function(t){return Math.sqrt(1- --t*t)},circularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var r,e=.1,n=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,r=n/4):r=n*Math.asin(1/e)/(2*Math.PI),-(e*Math.pow(2,10*(t-=1))*Math.sin((t-r)*(2*Math.PI)/n)))},elasticOut:function(t){var r,e=.1,n=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,r=n/4):r=n*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-r)*(2*Math.PI)/n)+1)},elasticInOut:function(t){var r,e=.1,n=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,r=n/4):r=n*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?-.5*(e*Math.pow(2,10*(t-=1))*Math.sin((t-r)*(2*Math.PI)/n)):e*Math.pow(2,-10*(t-=1))*Math.sin((t-r)*(2*Math.PI)/n)*.5+1)},backIn:function(t){var r=1.70158;return t*t*((r+1)*t-r)},backOut:function(t){var r=1.70158;return--t*t*((r+1)*t+r)+1},backInOut:function(t){var r=2.5949095;return(t*=2)<1?.5*(t*t*((r+1)*t-r)):.5*((t-=2)*t*((r+1)*t+r)+2)},bounceIn:function(t){return 1-e.bounceOut(1-t)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return t<.5?.5*e.bounceIn(2*t):.5*e.bounceOut(2*t-1)+.5}};t.exports=e},function(t,r,e){function n(t,r){var e=t+":"+r;if(u[e])return u[e];for(var n=(t+"").split("\n"),i=0,a=0,o=n.length;a<o;a++)i=Math.max(d.measureText(n[a],r).width,i);return c>h&&(c=0,u={}),c++,u[e]=i,i}function i(t,r,e,i){var a=((t||"")+"").split("\n").length,o=n(t,r),s=n("国",r),u=a*s,c=new l(0,0,o,u);switch(c.lineHeight=s,i){case"bottom":case"alphabetic":c.y-=s;break;case"middle":c.y-=s/2}switch(e){case"end":case"right":c.x-=c.width;break;case"center":c.x-=c.width/2}return c}function a(t,r,e,n){var i=r.x,a=r.y,o=r.height,s=r.width,u=e.height,c=o/2-u/2,h="left";switch(t){case"left":i-=n,a+=c,h="right";break;case"right":i+=n+s,a+=c,h="left";break;case"top":i+=s/2,a-=n+u,h="center";break;case"bottom":i+=s/2,a+=o+n,h="center";break;case"inside":i+=s/2,a+=c,h="center";break;case"insideLeft":i+=n,a+=c,h="left";break;case"insideRight":i+=s-n,a+=c,h="right";break;case"insideTop":i+=s/2,a+=n,h="center";break;case"insideBottom":i+=s/2,a+=o-u-n,h="center";break;case"insideTopLeft":i+=n,a+=n,h="left";break;case"insideTopRight":i+=s-n,a+=n,h="right";break;case"insideBottomLeft":i+=n,a+=o-u-n;break;case"insideBottomRight":i+=s-n,a+=o-u-n,h="right"}return{x:i,y:a,textAlign:h,textBaseline:"top"}}function o(t,r,e,i,a){if(!r)return"";a=a||{},i=_(i,"...");for(var o=_(a.maxIterations,2),u=_(a.minChar,0),c=n("国",e),h=n("a",e),f=_(a.placeholder,""),l=r=Math.max(0,r-1),d=0;d<u&&l>=h;d++)l-=h;var y=n(i);y>l&&(i="",y=0),l=r-y;for(var m=(t+"").split("\n"),d=0,v=m.length;d<v;d++){var p=m[d],g=n(p,e);if(!(g<=r)){for(var E=0;;E++){if(g<=l||E>=o){p+=i;break}var T=0===E?s(p,l,h,c):g>0?Math.floor(p.length*l/g):0;p=p.substr(0,T),g=n(p,e)}""===p&&(p=f),m[d]=p}}return m.join("\n")}function s(t,r,e,n){for(var i=0,a=0,o=t.length;a<o&&i<r;a++){var s=t.charCodeAt(a);i+=0<=s&&s<=127?e:n}return a}var u={},c=0,h=5e3,f=e(13),l=e(31),_=f.retrieve,d={getWidth:n,getBoundingRect:i,adjustTextPositionOnRect:a,truncateText:o,measureText:function(t,r){var e=f.getContext();return e.font=r||"12px sans-serif",e.measureText(t)}};t.exports=d},function(t,r){var e=function(){this.head=null,this.tail=null,this._len=0},n=e.prototype;n.insert=function(t){var r=new i(t);return this.insertEntry(r),r},n.insertEntry=function(t){this.head?(this.tail.next=t,t.prev=this.tail,this.tail=t):this.head=this.tail=t,this._len++},n.remove=function(t){var r=t.prev,e=t.next;r?r.next=e:this.head=e,e?e.prev=r:this.tail=r,t.next=t.prev=null,this._len--},n.len=function(){return this._len};var i=function(t){this.value=t,this.next,this.prev},a=function(t){this._list=new e,this._map={},this._maxSize=t||10},o=a.prototype;o.put=function(t,r){var e=this._list,n=this._map;if(null==n[t]){var i=e.len();if(i>=this._maxSize&&i>0){var a=e.head;e.remove(a),delete n[a.key]}var o=e.insert(r);o.key=t,n[t]=o}},o.get=function(t){var r=this._map[t],e=this._list;if(null!=r)return r!==e.tail&&(e.remove(r),e.insertEntry(r)),r.value},o.clear=function(){this._list.clear(),this._map={}},t.exports=a},function(t,r){var e="undefined"==typeof Float32Array?Array:Float32Array,n={create:function(){var t=new e(6);return n.identity(t),t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},copy:function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t},mul:function(t,r,e){var n=r[0]*e[0]+r[2]*e[1],i=r[1]*e[0]+r[3]*e[1],a=r[0]*e[2]+r[2]*e[3],o=r[1]*e[2]+r[3]*e[3],s=r[0]*e[4]+r[2]*e[5]+r[4],u=r[1]*e[4]+r[3]*e[5]+r[5];return t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t},translate:function(t,r,e){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4]+e[0],t[5]=r[5]+e[1],t},rotate:function(t,r,e){var n=r[0],i=r[2],a=r[4],o=r[1],s=r[3],u=r[5],c=Math.sin(e),h=Math.cos(e);return t[0]=n*h+o*c,t[1]=-n*c+o*h,t[2]=i*h+s*c,t[3]=-i*c+h*s,t[4]=h*a+c*u,t[5]=h*u-c*a,t},scale:function(t,r,e){var n=e[0],i=e[1];return t[0]=r[0]*n,t[1]=r[1]*i,t[2]=r[2]*n,t[3]=r[3]*i,t[4]=r[4]*n,t[5]=r[5]*i,t},invert:function(t,r){var e=r[0],n=r[2],i=r[4],a=r[1],o=r[3],s=r[5],u=e*o-a*n;return u?(u=1/u,t[0]=o*u,t[1]=-a*u,t[2]=-n*u,t[3]=e*u,t[4]=(n*s-o*i)*u,t[5]=(a*i-e*s)*u,t):null}};t.exports=n},function(t,r){var e="undefined"==typeof Float32Array?Array:Float32Array,n={create:function(t,r){var n=new e(2);return null==t&&(t=0),null==r&&(r=0),n[0]=t,n[1]=r,n},copy:function(t,r){return t[0]=r[0],t[1]=r[1],t},clone:function(t){var r=new e(2);return r[0]=t[0],r[1]=t[1],r},set:function(t,r,e){return t[0]=r,t[1]=e,t},add:function(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t},scaleAndAdd:function(t,r,e,n){return t[0]=r[0]+e[0]*n,t[1]=r[1]+e[1]*n,t},sub:function(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t},len:function(t){return Math.sqrt(this.lenSquare(t))},lenSquare:function(t){return t[0]*t[0]+t[1]*t[1]},mul:function(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t},div:function(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t},dot:function(t,r){return t[0]*r[0]+t[1]*r[1]},scale:function(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t},normalize:function(t,r){var e=n.len(r);return 0===e?(t[0]=0,t[1]=0):(t[0]=r[0]/e,t[1]=r[1]/e),t},distance:function(t,r){return Math.sqrt((t[0]-r[0])*(t[0]-r[0])+(t[1]-r[1])*(t[1]-r[1]))},distanceSquare:function(t,r){return(t[0]-r[0])*(t[0]-r[0])+(t[1]-r[1])*(t[1]-r[1])},negate:function(t,r){return t[0]=-r[0],t[1]=-r[1],t},lerp:function(t,r,e,n){return t[0]=r[0]+n*(e[0]-r[0]),t[1]=r[1]+n*(e[1]-r[1]),t},applyTransform:function(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[2]*i+e[4],t[1]=e[1]*n+e[3]*i+e[5],t},min:function(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t},max:function(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t}};n.length=n.len,n.lengthSquare=n.lenSquare,n.dist=n.distance,n.distSquare=n.distanceSquare,t.exports=n},function(t,r){var e=Array.prototype.slice,n=function(){this._$handlers={}};n.prototype={constructor:n,one:function(t,r,e){var n=this._$handlers;if(!r||!t)return this;n[t]||(n[t]=[]);for(var i=0;i<n[t].length;i++)if(n[t][i].h===r)return this;return n[t].push({h:r,one:!0,ctx:e||this}),this},on:function(t,r,e){var n=this._$handlers;
if(!r||!t)return this;n[t]||(n[t]=[]);for(var i=0;i<n[t].length;i++)if(n[t][i].h===r)return this;return n[t].push({h:r,one:!1,ctx:e||this}),this},isSilent:function(t){var r=this._$handlers;return r[t]&&r[t].length},off:function(t,r){var e=this._$handlers;if(!t)return this._$handlers={},this;if(r){if(e[t]){for(var n=[],i=0,a=e[t].length;i<a;i++)e[t][i].h!=r&&n.push(e[t][i]);e[t]=n}e[t]&&0===e[t].length&&delete e[t]}else delete e[t];return this},trigger:function(t){if(this._$handlers[t]){var r=arguments,n=r.length;n>3&&(r=e.call(r,1));for(var i=this._$handlers[t],a=i.length,o=0;o<a;){switch(n){case 1:i[o].h.call(i[o].ctx);break;case 2:i[o].h.call(i[o].ctx,r[1]);break;case 3:i[o].h.call(i[o].ctx,r[1],r[2]);break;default:i[o].h.apply(i[o].ctx,r)}i[o].one?(i.splice(o,1),a--):o++}}return this},triggerWithContext:function(t){if(this._$handlers[t]){var r=arguments,n=r.length;n>4&&(r=e.call(r,1,r.length-1));for(var i=r[r.length-1],a=this._$handlers[t],o=a.length,s=0;s<o;){switch(n){case 1:a[s].h.call(i);break;case 2:a[s].h.call(i,r[1]);break;case 3:a[s].h.call(i,r[1],r[2]);break;default:a[s].h.apply(i,r)}a[s].one?(a.splice(s,1),o--):s++}}return this}},t.exports=n},function(t,r){function e(t){return t=Math.round(t),t<0?0:t>255?255:t}function n(t){return t=Math.round(t),t<0?0:t>360?360:t}function i(t){return t<0?0:t>1?1:t}function a(t){return e(t.length&&"%"===t.charAt(t.length-1)?parseFloat(t)/100*255:parseInt(t,10))}function o(t){return i(t.length&&"%"===t.charAt(t.length-1)?parseFloat(t)/100:parseFloat(t))}function s(t,r,e){return e<0?e+=1:e>1&&(e-=1),6*e<1?t+(r-t)*e*6:2*e<1?r:3*e<2?t+(r-t)*(2/3-e)*6:t}function u(t,r,e){return t+(r-t)*e}function c(t){if(t){t+="";var r=t.replace(/ /g,"").toLowerCase();if(r in g)return g[r].slice();if("#"!==r.charAt(0)){var e=r.indexOf("("),n=r.indexOf(")");if(e!==-1&&n+1===r.length){var i=r.substr(0,e),s=r.substr(e+1,n-(e+1)).split(","),u=1;switch(i){case"rgba":if(4!==s.length)return;u=o(s.pop());case"rgb":if(3!==s.length)return;return[a(s[0]),a(s[1]),a(s[2]),u];case"hsla":if(4!==s.length)return;return s[3]=o(s[3]),h(s);case"hsl":if(3!==s.length)return;return h(s);default:return}}}else{if(4===r.length){var c=parseInt(r.substr(1),16);if(!(c>=0&&c<=4095))return;return[(3840&c)>>4|(3840&c)>>8,240&c|(240&c)>>4,15&c|(15&c)<<4,1]}if(7===r.length){var c=parseInt(r.substr(1),16);if(!(c>=0&&c<=16777215))return;return[(16711680&c)>>16,(65280&c)>>8,255&c,1]}}}}function h(t){var r=(parseFloat(t[0])%360+360)%360/360,n=o(t[1]),i=o(t[2]),a=i<=.5?i*(n+1):i+n-i*n,u=2*i-a,c=[e(255*s(u,a,r+1/3)),e(255*s(u,a,r)),e(255*s(u,a,r-1/3))];return 4===t.length&&(c[3]=t[3]),c}function f(t){if(t){var r,e,n=t[0]/255,i=t[1]/255,a=t[2]/255,o=Math.min(n,i,a),s=Math.max(n,i,a),u=s-o,c=(s+o)/2;if(0===u)r=0,e=0;else{e=c<.5?u/(s+o):u/(2-s-o);var h=((s-n)/6+u/2)/u,f=((s-i)/6+u/2)/u,l=((s-a)/6+u/2)/u;n===s?r=l-f:i===s?r=1/3+h-l:a===s&&(r=2/3+f-h),r<0&&(r+=1),r>1&&(r-=1)}var _=[360*r,e,c];return null!=t[3]&&_.push(t[3]),_}}function l(t,r){var e=c(t);if(e){for(var n=0;n<3;n++)r<0?e[n]=e[n]*(1-r)|0:e[n]=(255-e[n])*r+e[n]|0;return p(e,4===e.length?"rgba":"rgb")}}function _(t,r){var e=c(t);if(e)return((1<<24)+(e[0]<<16)+(e[1]<<8)+ +e[2]).toString(16).slice(1)}function d(t,r,n){if(r&&r.length&&t>=0&&t<=1){n=n||[0,0,0,0];var i=t*(r.length-1),a=Math.floor(i),o=Math.ceil(i),s=r[a],c=r[o],h=i-a;return n[0]=e(u(s[0],c[0],h)),n[1]=e(u(s[1],c[1],h)),n[2]=e(u(s[2],c[2],h)),n[3]=e(u(s[3],c[3],h)),n}}function y(t,r,n){if(r&&r.length&&t>=0&&t<=1){var a=t*(r.length-1),o=Math.floor(a),s=Math.ceil(a),h=c(r[o]),f=c(r[s]),l=a-o,_=p([e(u(h[0],f[0],l)),e(u(h[1],f[1],l)),e(u(h[2],f[2],l)),i(u(h[3],f[3],l))],"rgba");return n?{color:_,leftIndex:o,rightIndex:s,value:a}:_}}function m(t,r,e,i){if(t=c(t))return t=f(t),null!=r&&(t[0]=n(r)),null!=e&&(t[1]=o(e)),null!=i&&(t[2]=o(i)),p(h(t),"rgba")}function v(t,r){if(t=c(t),t&&null!=r)return t[3]=i(r),p(t,"rgba")}function p(t,r){var e=t[0]+","+t[1]+","+t[2];return"rgba"!==r&&"hsva"!==r&&"hsla"!==r||(e+=","+t[3]),r+"("+e+")"}var g={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};t.exports={parse:c,lift:l,toHex:_,fastMapToColor:d,mapToColor:y,modifyHSL:m,modifyAlpha:v,stringify:p}}])});